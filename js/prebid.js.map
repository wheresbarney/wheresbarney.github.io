{"version":3,"sources":["webpack:/webpack/bootstrap 049816b144b21da7fad5","webpack:///src/utils.js","webpack:///src/adaptermanager.js","webpack:///src/bidmanager.js","webpack:///src/bidfactory.js","webpack:///src/constants.json","webpack:///src/adloader.js","webpack:///src/ajax.js","webpack:///src/adapter.js","webpack:///src/config.js","webpack:///src/adapters/bidderFactory.js","webpack:///src/events.js","webpack:///src/url.js","webpack:///src/mediaTypes.js","webpack:///node_modules/core-js/modules/_core.js","webpack:///src/native.js","webpack:///node_modules/core-js/modules/_global.js","webpack:///node_modules/core-js/modules/_export.js","webpack:///node_modules/core-js/modules/_is-object.js","webpack:///src/userSync.js","webpack:///src/Renderer.js","webpack:///src/targeting.js","webpack:///node_modules/core-js/modules/_hide.js","webpack:///node_modules/core-js/modules/_descriptors.js","webpack:///node_modules/core-js/modules/_fails.js","webpack:///node_modules/core-js/modules/_uid.js","webpack:///node_modules/core-js/modules/_iobject.js","webpack:///node_modules/core-js/modules/_add-to-unscopables.js","webpack:///src/cpmBucketManager.js","webpack:///src/video.js","webpack:///(webpack)/buildin/global.js","webpack:///src/prebidGlobal.js","webpack:///node_modules/core-js/modules/_has.js","webpack:///node_modules/core-js/modules/_ctx.js","webpack:///node_modules/core-js/modules/_array-methods.js","webpack:///node_modules/core-js/modules/_cof.js","webpack:///node_modules/core-js/modules/_to-object.js","webpack:///node_modules/core-js/modules/_defined.js","webpack:///node_modules/core-js/modules/_to-length.js","webpack:///node_modules/core-js/modules/_to-integer.js","webpack:///node_modules/core-js/modules/_wks.js","webpack:///node_modules/core-js/modules/_shared.js","webpack:///node_modules/core-js/modules/_array-includes.js","webpack:///node_modules/core-js/modules/_to-iobject.js","webpack:///src/sizeMapping.js","webpack:///src/videoCache.js","webpack:///src/hook.js","webpack:///src/prebid.js","webpack:///src/polyfill.js","webpack:///node_modules/core-js/fn/array/find.js","webpack:///node_modules/core-js/modules/es6.array.find.js","webpack:///node_modules/core-js/modules/_object-dp.js","webpack:///node_modules/core-js/modules/_an-object.js","webpack:///node_modules/core-js/modules/_ie8-dom-define.js","webpack:///node_modules/core-js/modules/_dom-create.js","webpack:///node_modules/core-js/modules/_to-primitive.js","webpack:///node_modules/core-js/modules/_property-desc.js","webpack:///node_modules/core-js/modules/_redefine.js","webpack:///node_modules/core-js/modules/_a-function.js","webpack:///node_modules/core-js/modules/_array-species-create.js","webpack:///node_modules/core-js/modules/_array-species-constructor.js","webpack:///node_modules/core-js/modules/_is-array.js","webpack:///node_modules/core-js/fn/array/find-index.js","webpack:///node_modules/core-js/modules/es6.array.find-index.js","webpack:///node_modules/core-js/fn/array/includes.js","webpack:///node_modules/core-js/modules/es7.array.includes.js","webpack:///node_modules/core-js/modules/_to-absolute-index.js","webpack:///node_modules/core-js/fn/object/assign.js","webpack:///node_modules/core-js/modules/es6.object.assign.js","webpack:///node_modules/core-js/modules/_object-assign.js","webpack:///node_modules/core-js/modules/_object-keys.js","webpack:///node_modules/core-js/modules/_object-keys-internal.js","webpack:///node_modules/core-js/modules/_shared-key.js","webpack:///node_modules/core-js/modules/_enum-bug-keys.js","webpack:///node_modules/core-js/modules/_object-gops.js","webpack:///node_modules/core-js/modules/_object-pie.js","webpack:///src/secureCreatives.js","webpack:///src/adserver.js","webpack:///modules/audienceNetworkBidAdapter.js"],"names":["parseSizesInput","parseGPTSingleSizeArray","uniques","flatten","getBidRequest","getKeys","getValue","getBidderCodes","isGptPubadsDefined","getHighestCpm","shuffle","adUnitsFilter","isSrcdocSupported","cloneJson","inIframe","isSafariBrowser","replaceAuctionPrice","getBidderRequestAllAdUnits","getBidderRequest","cookiesAreEnabled","delayExecution","groupBy","deepAccess","getDefinedParams","isValidMediaTypes","CONSTANTS","require","_loggingChecked","t_Arr","t_Str","t_Fn","t_Numb","toString","Object","prototype","infoLogger","console","info","bind","window","e","exports","replaceTokenInString","str","map","token","_each","value","key","undefined","keyString","toUpperCase","re","RegExp","replace","getIncrementalInteger","count","_getUniqueIdentifierStr","Math","random","substr","getUniqueIdentifierStr","generateUUID","placeholder","getBidIdParameter","paramsObj","tryAppendQueryString","existingUrl","encodeURIComponent","parseQueryStringParameters","queryObj","result","k","hasOwnProperty","transformAdServerTargetingObj","targeting","getOwnPropertyNames","length","join","sizeObj","parsedSizes","sizes","split","sizeRegex","curSizePos","hasOwn","match","push","sizeArrayLength","i","singleSize","isArray","isNaN","getTopWindowLocation","location","top","getTopWindowUrl","href","logWarn","msg","debugTurnedOn","warn","logInfo","args","hasConsoleLogger","logMessage","log","errLogFn","hasLogger","error","getConfig","debug","getParameterByName","DEBUG_MODE","setConfig","logError","code","exception","errCode","createInvisibleIframe","_createInvisibleIframe","f","document","createElement","id","height","width","border","hspace","vspace","marginWidth","marginHeight","style","scrolling","frameBorder","src","display","name","regexS","regex","results","exec","search","decodeURIComponent","hasValidBidRequest","paramObj","requiredParamsArr","adapter","found","findParam","addEventHandler","element","event","func","addEventListener","attachEvent","isA","object","_t","call","isFn","isStr","isNumber","isEmpty","isEmptyStr","fn","forEach","l","contains","a","obj","indexOf","Array","_map","callback","output","objectToCheck","propertyToCheckFor","constructor","insertElement","elm","doc","target","elToAppend","getElementsByTagName","insertBefore","firstChild","triggerPixel","url","img","Image","insertUserSyncIframe","iframeHtml","createTrackPixelIframeHtml","div","innerHTML","iframe","createTrackPixelHtml","escapedUrl","encodeURI","encodeUri","sandbox","getIframeDocument","contentWindow","contentDocument","getValueString","param","val","defaultValue","index","arry","b","concat","pbjs","_bidsRequested","bidSet","bids","find","bid","bidId","keys","adUnits","unit","bidder","reduce","filter","googletag","pubads","getSlots","previous","current","cpm","timeToRespond","array","counter","floor","temp","includes","placementCode","adUnitCode","defaultView","frameElement","test","navigator","userAgent","JSON","parse","stringify","self","request","bidderCode","start","requestId","cookieEnabled","cookie","numRequiredCalls","Error","numCalls","apply","arguments","xs","rv","x","path","String","params","mediaTypes","SUPPORTED_MEDIA_TYPES","SUPPORTED_STREAM_TYPES","types","every","type","video","context","utils","events","s2sTestingModule","_bidderRegistry","bidderRegistry","_s2sConfig","endpoint","S2S","DEFAULT_ENDPOINT","ADAPTER","syncEndpoint","SYNC_ENDPOINT","RANDOM","FIXED","VALID_ORDERS","_analyticsRegistry","_bidderSequence","getBids","bidderRequestId","adUnit","sizeMapping","nativeParams","transactionId","bid_id","callBids","cbTimeout","auctionStart","Date","now","auctionInit","timestamp","timeout","emit","EVENTS","AUCTION_INIT","bidderCodes","s2sAdapter","queueSync","clientTestAdapters","s2sTesting","enabled","testing","getSourceBidderMap","CLIENT","adaptersServerSide","bidders","adUnitsS2SCopy","transformHeightWidth","finalSource","tid","bidderRequest","getTime","SRC","s2sBidRequest","ad_units","_bidderRequests","adUnitsClientCopy","SERVER","bidRequest","BID_REQUESTED","sizesObj","heightWidth","size","parseInt","getSupportedMediaTypes","videoAdapters","registerBidAdapter","bidAdaptor","supportedMediaTypes","aliasBidAdapter","alias","existingAlias","newAdapter","setBidderCode","spec","getSpec","registerAnalyticsAdapter","enableAnalytics","config","adapterConfig","provider","setBidderSequence","order","getBidAdapter","setS2SConfig","setS2STestingModule","module","AUCTION_END","externalCallbacks","byAdUnit","all","oneTime","timer","defaultBidderSettingsMap","getTimedOutBidders","getBidderCode","_bidsReceived","getBidders","bidsBackAdUnit","requested","_adUnitCodes","add","received","bidsBackAll","addBidResponse","isValid","prepareBidForAuction","mediaType","tryAddVideoBid","addBidToAuction","doCallbacksIfNeeded","errorMessage","validBidSize","responseTimestamp","requestTimestamp","parseFloat","BID_ADJUSTMENT","adUnitRenderer","renderer","install","setRender","render","priceStringsObj","pbLg","low","pbMg","med","pbHg","high","pbAg","auto","pbDg","dense","pbCg","custom","keyValues","dealId","getKeyValueTargetingPairs","adserverTargeting","timeoutBuffer","timedOut","executeCallback","BID_RESPONSE","triggerAdUnitCallbacks","cacheIds","videoCacheKey","uuid","vastUrl","custBidObj","bidder_settings","bidderSettings","standardSettings","getStandardBidderSettings","setKeys","JSON_MAPPING","ADSERVER_TARGETING","alwaysUseBid","sendStandardTargeting","getSize","kvPair","suppressEmptyKeys","registerDefaultBidderSetting","defaultSetting","clearTimeout","called","processCallbacks","timedOutBidders","BID_TIMEOUT","clearAuction","externalCallbackReset","singleAdUnitCode","callbackQueue","adUnitCodes","groupByPlacement","bidsByPlacement","addOneTimeCallback","addCallback","cbEvent","CB","TYPE","ALL_BIDS_BACK","AD_UNIT_BIDS_BACK","on","adjustBids","bidPriceAdjusted","bidCpmAdjustment","BD_SETTING_STANDARD","granularity","bidResponse","adId","GRANULARITY_OPTIONS","AUTO","DENSE","LOW","MEDIUM","HIGH","CUSTOM","getStandardBidderAdServerTargeting","Bid","statusCode","_bidId","_statusCode","statusMessage","_getStatus","getStatusCode","createBid","_requestCache","loadScript","tagSrc","cacheRequest","loaded","callbacks","requestResource","jptScript","async","readyState","onreadystatechange","onload","setAjaxTimeout","ajax","XHR_DONE","_timeout","data","options","useXDomainRequest","method","success","XMLHttpRequest","responseType","XDomainRequest","responseText","onerror","ontimeout","onprogress","status","statusText","urlInfo","open","withCredentials","customHeaders","header","setRequestHeader","preflight","contentType","send","Adapter","newConfig","DEFAULT_DEBUG","DEFAULT_BIDDER_TIMEOUT","DEFAULT_PUBLISHER_DOMAIN","origin","DEFAULT_COOKIESYNC_DELAY","DEFAULT_ENABLE_SEND_ALL_BIDS","DEFAULT_USERSYNC","syncEnabled","pixelEnabled","syncsPerBidder","syncDelay","ALL_TOPICS","listeners","_debug","logging","_bidderTimeout","bidderTimeout","_publisherDomain","publisherDomain","_cookieSyncDelay","cookieSyncDelay","_priceGranularity","priceGranularity","validatePriceGranularity","hasGranularity","_customPriceBucket","customPriceBucket","_sendAllBids","enableSendAllBids","bidderSequence","s2sConfig","userSync","option","subscribe","callSubscribers","topic","listener","unsubscribe","splice","TOPICS","registerBidder","newBidder","COMMON_BID_RESPONSE_KEYS","putBidder","aliases","freeze","registerSyncs","adUnitCodesHandled","addBidWithCode","addBid","fillNoBids","newEmptyBid","err","responses","afterAllResponses","validBidRequests","filterAndWarn","bidRequestMap","requests","buildRequests","onResponse","processRequest","onSuccess","onFailure","response","responseObj","body","headers","headerParser","interpretResponse","addBidUsingRequestMap","hasValidKeys","prebidBid","GOOD","xmlHttpResponse","get","getResponseHeader","getUserSyncs","syncs","iframeEnabled","sync","registerSync","isBidRequestValid","bidKeys","NO_BID","slice","allEvents","v","idPaths","EVENT_ID_PATHS","eventsFired","_handlers","_public","_dispatch","eventString","eventPayload","idPath","que","eventKeys","eventType","_checkAvailableEvent","handler","off","_handler","getEvents","arrayCopy","newProp","parseQS","formatQS","format","query","acc","criteria","parsed","noDecodeWholeURL","protocol","hostname","port","pathname","hash","host","NATIVE","VIDEO","BANNER","processNativeAdUnitParams","nativeBidIsValid","fireNativeTrackers","getNativeTargeting","nativeAdapters","NATIVE_KEYS","title","sponsoredBy","image","icon","clickUrl","cta","NATIVE_TARGETING_KEYS","IMAGE","required","SUPPORTED_TYPES","typeIsSupported","nativeAdUnit","nativeBidder","hasNonNativeBidder","requestedAssets","requiredAssets","returnedAssets","asset","message","adObject","trackers","action","clickTrackers","impressionTrackers","newUserSync","userSyncDependencies","publicApi","queue","getDefaultQueue","hasFired","numAdapterBids","usConfig","conf","fireSyncs","browserSupportsCookies","fireImagePixels","loadIframes","bidderName","trackingPixelUrl","iframeUrl","incrementAdapterBids","Number","hasEnabledBidders","enabledBidders","syncUsers","setTimeout","triggerUserSyncs","enableOverride","Renderer","handlers","cmd","process","setEventHandlers","handleVideoEvent","eventName","shift","bidmanager","pbTargetingKeys","resetPresetTargeting","getAdUnitCodes","slot","getAdUnitPath","getSlotElementId","setTargeting","getAllTargeting","getWinningBidTargeting","getAlwaysUseBidTargeting","getBidLandscapeTargeting","targetKey","targetingConfig","getWinningBids","getEmptyBid","setTargetingForAst","getAdserverTargeting","targetId","keywordsObj","input","nKey","substring","apntag","setKeywords","winners","standardKeys","getStandardKeys","winner","TARGETING_KEYS","buckets","bidsByBidder","bucketKey","getTargetingMap","isApntagDefined","_defaultPrecision","_lgPriceConfig","_mgPriceConfig","_hgPriceConfig","_densePriceConfig","_autoPriceConfig","getPriceBucketString","customConfig","granularityMultiplier","cpmFloat","getCpmStringValue","cpmStr","isValidPriceConfig","cap","prev","curr","max","bucket","precision","toFixed","min","getCpmTarget","increment","bucketSize","isValidVideoBid","VIDEO_MEDIA_TYPE","OUTSTREAM","videoAdUnit","nonVideoBidder","hasNonVideoBidder","videoMediaType","vastXml","getGlobal","_win","mapSizes","isSizeMappingValid","getScreenWidth","mapping","minWidth","win","w","d","innerWidth","clientWidth","documentElement","setWindow","store","getCacheUrl","BASE_URL","wrapURI","uri","toStorageRequest","vastValue","shimStorageCallback","done","responseBody","ids","requestData","puts","createHook","hooks","hookName","_hooks","priority","hook","asyncSeries","asyncSeriesNext","methods","addHook","sort","removeHook","removeFn","hookedFn","adaptermanager","bidfactory","adserver","BID_WON","SET_TARGETING","ADD_AD_UNITS","auctionRunning","bidRequestQueue","eventValidators","bidWon","checkDefinedPlacement","_winningBids","_adsReceived","libLoaded","version","placementCodes","clearPlacements","setRenderSize","getAdserverTargetingForAdUnitCodeStr","adunitCode","res","getAdserverTargetingForAdUnitCode","p","c","accumulator","getBidResponses","currentRequestId","getBidResponsesForAdUnitCode","setTargetingForGPTAsync","targetingSet","allBidsAvailable","renderAd","ad","adUrl","write","close","overflow","removeAdUnit","userSyncConfig","requestBids","bidsBackHandler","invalidVideoAdUnits","nonNativeBidders","timeoutCallback","addAdUnits","adUnitArr","onEvent","offEvent","eventStr","removeCallback","bidderAdaptor","bidsAvailableForAdapter","useCache","aliasBidder","setPriceGranularity","getAllWinningBids","buildMasterVideoTagFromAdserverTag","adserverTag","urlComponents","masterTag","toLowerCase","dfpAdserverObj","dfpAdserver","verifyAdserverTag","appendQueryParams","getHighestCpmBids","maxBids","cookieSet","command","processQueue","isInteger","isFinite","listenMessagesFromCreative","receiveMessage","ev","sendAdToCreative","adServerDomain","source","remoteDomain","resizeRemoteCreative","postMessage","getElementById","querySelector","AdServer","attr","getWinningBidByCode","dfpReqParams","dfpParamsWithVariableValue","getCustomParams","description_url","descriptionUrl","cust_params","correlator","currency","netRevenue","hb_bidder","placementId","isVideo","flattenSize","some","isValidSize","sdkVersion","isTestmode","Boolean","createAdHtml","nativeStyle","nativeContainer","placementids","adformats","sdk","requestIds","testmode","pageurl","findIndex","playerwidth","playerheight","ttl","errors","fb_bidid","creativeId","placement_id","bid_price_cents","fb_format","fb_placementid"],"mappings":"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O8K,IAAd;AACD;;;;;;ACRD,uBAAuB;AACvB;AACA;AACA;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU,eAAe;AACzB;AACA;AACA;AACA,wCAAwC;AACxC;AACA,8BAA8B;AAC9B,6BAA6B;AAC7B,+BAA+B;AAC/B,mCAAmC;AACnC,SAAS,iCAAiC;AAC1C;AACA;AACA;AACA;AACA;;;;;;;AC3CA,iBAAiB;;AAEjB;AACA;AACA;;;;;;;ACJA;AACA;AACA;AACA;AACA;;;;;;;ACJA;AACA;AACA;AACA;AACA;;;;;;;ACJA;AACA;AACA;AACA;AACA,2DAA2D;AAC3D;;;;;;;ACLA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACLA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;ACVA;AACA;AACA,kDAAkD;AAClD;AACA,uCAAuC;AACvC;;;;;;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,YAAY,eAAe;AAChC;AACA,KAAK;AACL;AACA;;;;;;;ACtBA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;ACFA;;IAAY6D;;;;AACZ,IAAIqf,aAAJ,EAJA;;;;;AAMA,SAASC,QAAT,CAAkBne,MAAlB,EAA0B;AACxB,MAAI,CAACoe,mBAAmBpe,OAAOC,WAA1B,CAAL,EAA6C;AAC3C,WAAOD,OAAOpN,KAAd;AACD;AACD,MAAM6C,QAAQ4oB,gBAAd;AACA,MAAI,CAAC5oB,KAAL,EAAY;AACV;AACA,QAAM6oB,WAAUte,OAAOC,WAAP,CAAmBtE,MAAnB,CAA0B,UAACohB,IAA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L,CAAW5L,KAAX,MAAsBA,KAFxB;AAGD,CAJD;;;;;;ACTA;AACA;;;;;;;;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,gBAAgB,EAAE;AAC5D;AACA;AACA;AACA;AACA,CAAC;AACD;;;;;;;ACbA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,YAAY;AACf;AACA;AACA;AACA;;;;;;;ACfA;AACA;AACA;AACA;AACA;;;;;;;ACJA;AACA,sEAAsE,mBAAmB,UAAU,EAAE,EAAE;AACvG,CAAC;;;;;;;ACFD;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA,CAAC;AACD;AACA,CAAC;;;;;;;AC9BD;AACA;AACA;AACA;;;;;;;ACHA;AACA;;AAEA;AACA;AACA;;;;;;;ACLA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;;;;;;ACfA;AACA;AACA;AACA;AACA;;;;;;;ACJA;AACA;;;;;;;;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,gBAAgB,EAAE;AAC5D;AACA;AACA;AACA;AACA,CAAC;AACD;;;;;;;ACbA;AACA;;;;;;;;ACDA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,CAAC;;AAED;;;;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACNA;AACA;;;;;;;ACDA;AACA;;AAEA,0CAA0C,mCAAsC;;;;;;;;ACHhF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA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","file":"prebid.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tvar parentJsonpFunction = window[\"pbjsChunk\"];\n \twindow[\"pbjsChunk\"] = function webpackJsonpCallback(chunkIds, moreModules, executeModules) {\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [], result;\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(chunkIds, moreModules, executeModules);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n \t\tif(executeModules) {\n \t\t\tfor(i=0; i < executeModules.length; i++) {\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = executeModules[i]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t};\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// objects to store loaded and loading chunks\n \tvar installedChunks = {\n \t\t110: 0\n \t};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tif(installedChunks[chunkId] === 0)\n \t\t  return callback.call(null, __webpack_require__);\n \t\telse\n \t\t  console.error('webpack chunk not found and jsonp disabled');\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 287);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 049816b144b21da7fad5","import { config } from './config';\nvar CONSTANTS = require('./constants');\n\nvar _loggingChecked = false;\n\nvar t_Arr = 'Array';\nvar t_Str = 'String';\nvar t_Fn = 'Function';\nvar t_Numb = 'Number';\nvar toString = Object.prototype.toString;\nlet infoLogger = null;\ntry {\n  infoLogger = console.info.bind(window.console);\n} catch (e) {\n}\n\n/*\n *   Substitutes into a string from a given map using the token\n *   Usage\n *   var str = 'text %%REPLACE%% this text with %%SOMETHING%%';\n *   var map = {};\n *   map['replace'] = 'it was subbed';\n *   map['something'] = 'something else';\n *   console.log(replaceTokenInString(str, map, '%%')); => \"text it was subbed this text with something else\"\n */\nexports.replaceTokenInString = function (str, map, token) {\n  this._each(map, function (value, key) {\n    value = (value === undefined) ? '' : value;\n\n    var keyString = token + key.toUpperCase() + token;\n    var re = new RegExp(keyString, 'g');\n\n    str = str.replace(re, value);\n  });\n\n  return str;\n};\n\n/* utility method to get incremental integer starting from 1 */\nvar getIncrementalInteger = (function () {\n  var count = 0;\n  return function () {\n    count++;\n    return count;\n  };\n})();\n\nfunction _getUniqueIdentifierStr() {\n  return getIncrementalInteger() + Math.random().toString(16).substr(2);\n}\n\n// generate a random string (to be used as a dynamic JSONP callback)\nexports.getUniqueIdentifierStr = _getUniqueIdentifierStr;\n\n/**\n * Returns a random v4 UUID of the form xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx,\n * where each x is replaced with a random hexadecimal digit from 0 to f,\n * and y is replaced with a random hexadecimal digit from 8 to b.\n * https://gist.github.com/jed/982883 via node-uuid\n */\nexports.generateUUID = function generateUUID(placeholder) {\n  return placeholder\n    ? (placeholder ^ Math.random() * 16 >> placeholder / 4).toString(16)\n    : ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, generateUUID);\n};\n\nexports.getBidIdParameter = function (key, paramsObj) {\n  if (paramsObj && paramsObj[key]) {\n    return paramsObj[key];\n  }\n\n  return '';\n};\n\nexports.tryAppendQueryString = function (existingUrl, key, value) {\n  if (value) {\n    return existingUrl += key + '=' + encodeURIComponent(value) + '&';\n  }\n\n  return existingUrl;\n};\n\n// parse a query string object passed in bid params\n// bid params should be an object such as {key: \"value\", key1 : \"value1\"}\nexports.parseQueryStringParameters = function (queryObj) {\n  var result = '';\n  for (var k in queryObj) {\n    if (queryObj.hasOwnProperty(k)) { result += k + '=' + encodeURIComponent(queryObj[k]) + '&'; }\n  }\n\n  return result;\n};\n\n// transform an AdServer targeting bids into a query string to send to the adserver\nexports.transformAdServerTargetingObj = function (targeting) {\n  // we expect to receive targeting for a single slot at a time\n  if (targeting && Object.getOwnPropertyNames(targeting).length > 0) {\n    return getKeys(targeting)\n      .map(key => `${key}=${encodeURIComponent(getValue(targeting, key))}`).join('&');\n  } else {\n    return '';\n  }\n};\n\n/**\n * Parse a GPT-Style general size Array like `[[300, 250]]` or `\"300x250,970x90\"` into an array of sizes `[\"300x250\"]` or '['300x250', '970x90']'\n * @param  {array[array|number]} sizeObj Input array or double array [300,250] or [[300,250], [728,90]]\n * @return {array[string]}  Array of strings like `[\"300x250\"]` or `[\"300x250\", \"728x90\"]`\n */\nexport function parseSizesInput(sizeObj) {\n  var parsedSizes = [];\n\n  // if a string for now we can assume it is a single size, like \"300x250\"\n  if (typeof sizeObj === 'string') {\n    // multiple sizes will be comma-separated\n    var sizes = sizeObj.split(',');\n\n    // regular expression to match strigns like 300x250\n    // start of line, at least 1 number, an \"x\" , then at least 1 number, and the then end of the line\n    var sizeRegex = /^(\\d)+x(\\d)+$/i;\n    if (sizes) {\n      for (var curSizePos in sizes) {\n        if (hasOwn(sizes, curSizePos) && sizes[curSizePos].match(sizeRegex)) {\n          parsedSizes.push(sizes[curSizePos]);\n        }\n      }\n    }\n  } else if (typeof sizeObj === 'object') {\n    var sizeArrayLength = sizeObj.length;\n\n    // don't process empty array\n    if (sizeArrayLength > 0) {\n      // if we are a 2 item array of 2 numbers, we must be a SingleSize array\n      if (sizeArrayLength === 2 && typeof sizeObj[0] === 'number' && typeof sizeObj[1] === 'number') {\n        parsedSizes.push(parseGPTSingleSizeArray(sizeObj));\n      } else {\n        // otherwise, we must be a MultiSize array\n        for (var i = 0; i < sizeArrayLength; i++) {\n          parsedSizes.push(parseGPTSingleSizeArray(sizeObj[i]));\n        }\n      }\n    }\n  }\n\n  return parsedSizes;\n};\n\n// parse a GPT style sigle size array, (i.e [300,250])\n// into an AppNexus style string, (i.e. 300x250)\nexport function parseGPTSingleSizeArray(singleSize) {\n  // if we aren't exactly 2 items in this array, it is invalid\n  if (exports.isArray(singleSize) && singleSize.length === 2 && (!isNaN(singleSize[0]) && !isNaN(singleSize[1]))) {\n    return singleSize[0] + 'x' + singleSize[1];\n  }\n};\n\nexports.getTopWindowLocation = function () {\n  let location;\n  try {\n    // force an exception in x-domain enviornments. #1509\n    window.top.location.toString();\n    location = window.top.location;\n  } catch (e) {\n    location = window.location;\n  }\n\n  return location;\n};\n\nexports.getTopWindowUrl = function () {\n  let href;\n  try {\n    href = this.getTopWindowLocation().href;\n  } catch (e) {\n    href = '';\n  }\n\n  return href;\n};\n\nexports.logWarn = function (msg) {\n  if (debugTurnedOn() && console.warn) {\n    console.warn('WARNING: ' + msg);\n  }\n};\n\nexports.logInfo = function (msg, args) {\n  if (debugTurnedOn() && hasConsoleLogger()) {\n    if (infoLogger) {\n      if (!args || args.length === 0) {\n        args = '';\n      }\n\n      infoLogger('INFO: ' + msg + ((args === '') ? '' : ' : params : '), args);\n    }\n  }\n};\n\nexports.logMessage = function (msg) {\n  if (debugTurnedOn() && hasConsoleLogger()) {\n    console.log('MESSAGE: ' + msg);\n  }\n};\n\nfunction hasConsoleLogger() {\n  return (window.console && window.console.log);\n}\n\nexports.hasConsoleLogger = hasConsoleLogger;\n\nvar errLogFn = (function (hasLogger) {\n  if (!hasLogger) return '';\n  return window.console.error ? 'error' : 'log';\n}(hasConsoleLogger()));\n\nvar debugTurnedOn = function () {\n  if (config.getConfig('debug') === false && _loggingChecked === false) {\n    const debug = getParameterByName(CONSTANTS.DEBUG_MODE).toUpperCase() === 'TRUE';\n    config.setConfig({ debug });\n    _loggingChecked = true;\n  }\n\n  return !!config.getConfig('debug');\n};\n\nexports.debugTurnedOn = debugTurnedOn;\n\nexports.logError = function (msg, code, exception) {\n  var errCode = code || 'ERROR';\n  if (debugTurnedOn() && hasConsoleLogger()) {\n    console[errLogFn](console, errCode + ': ' + msg, exception || '');\n  }\n};\n\nexports.createInvisibleIframe = function _createInvisibleIframe() {\n  var f = document.createElement('iframe');\n  f.id = _getUniqueIdentifierStr();\n  f.height = 0;\n  f.width = 0;\n  f.border = '0px';\n  f.hspace = '0';\n  f.vspace = '0';\n  f.marginWidth = '0';\n  f.marginHeight = '0';\n  f.style.border = '0';\n  f.scrolling = 'no';\n  f.frameBorder = '0';\n  f.src = 'about:blank';\n  f.style.display = 'none';\n  return f;\n};\n\n/*\n *   Check if a given parameter name exists in query string\n *   and if it does return the value\n */\nvar getParameterByName = function (name) {\n  var regexS = '[\\\\?&]' + name + '=([^&#]*)';\n  var regex = new RegExp(regexS);\n  var results = regex.exec(window.location.search);\n  if (results === null) {\n    return '';\n  }\n\n  return decodeURIComponent(results[1].replace(/\\+/g, ' '));\n};\n\nexports.getParameterByName = getParameterByName;\n\n/**\n * This function validates paramaters.\n * @param  {object[string]} paramObj          [description]\n * @param  {string[]} requiredParamsArr [description]\n * @return {bool}                   Bool if paramaters are valid\n */\nexports.hasValidBidRequest = function (paramObj, requiredParamsArr, adapter) {\n  var found = false;\n\n  function findParam(value, key) {\n    if (key === requiredParamsArr[i]) {\n      found = true;\n    }\n  }\n\n  for (var i = 0; i < requiredParamsArr.length; i++) {\n    found = false;\n\n    this._each(paramObj, findParam);\n\n    if (!found) {\n      this.logError('Params are missing for bid request. One of these required paramaters are missing: ' + requiredParamsArr, adapter);\n      return false;\n    }\n  }\n\n  return true;\n};\n\n// Handle addEventListener gracefully in older browsers\nexports.addEventHandler = function (element, event, func) {\n  if (element.addEventListener) {\n    element.addEventListener(event, func, true);\n  } else if (element.attachEvent) {\n    element.attachEvent('on' + event, func);\n  }\n};\n/**\n * Return if the object is of the\n * given type.\n * @param {*} object to test\n * @param {String} _t type string (e.g., Array)\n * @return {Boolean} if object is of type _t\n */\nexports.isA = function (object, _t) {\n  return toString.call(object) === '[object ' + _t + ']';\n};\n\nexports.isFn = function (object) {\n  return this.isA(object, t_Fn);\n};\n\nexports.isStr = function (object) {\n  return this.isA(object, t_Str);\n};\n\nexports.isArray = function (object) {\n  return this.isA(object, t_Arr);\n};\n\nexports.isNumber = function(object) {\n  return this.isA(object, t_Numb);\n};\n\n/**\n * Return if the object is \"empty\";\n * this includes falsey, no keys, or no items at indices\n * @param {*} object object to test\n * @return {Boolean} if object is empty\n */\nexports.isEmpty = function (object) {\n  if (!object) return true;\n  if (exports.isArray(object) || exports.isStr(object)) {\n    return !(object.length > 0);\n  }\n\n  for (var k in object) {\n    if (hasOwnProperty.call(object, k)) return false;\n  }\n\n  return true;\n};\n\n/**\n * Return if string is empty, null, or undefined\n * @param str string to test\n * @returns {boolean} if string is empty\n */\nexports.isEmptyStr = function(str) {\n  return this.isStr(str) && (!str || str.length === 0);\n};\n\n/**\n * Iterate object with the function\n * falls back to es5 `forEach`\n * @param {Array|Object} object\n * @param {Function(value, key, object)} fn\n */\nexports._each = function (object, fn) {\n  if (this.isEmpty(object)) return;\n  if (this.isFn(object.forEach)) return object.forEach(fn, this);\n\n  var k = 0;\n  var l = object.length;\n\n  if (l > 0) {\n    for (; k < l; k++) fn(object[k], k, object);\n  } else {\n    for (k in object) {\n      if (hasOwnProperty.call(object, k)) fn.call(this, object[k], k);\n    }\n  }\n};\n\nexports.contains = function (a, obj) {\n  if (this.isEmpty(a)) {\n    return false;\n  }\n\n  if (this.isFn(a.indexOf)) {\n    return a.indexOf(obj) !== -1;\n  }\n\n  var i = a.length;\n  while (i--) {\n    if (a[i] === obj) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nexports.indexOf = (function () {\n  if (Array.prototype.indexOf) {\n    return Array.prototype.indexOf;\n  }\n\n  // ie8 no longer supported\n  // return polyfills.indexOf;\n}());\n\n/**\n * Map an array or object into another array\n * given a function\n * @param {Array|Object} object\n * @param {Function(value, key, object)} callback\n * @return {Array}\n */\nexports._map = function (object, callback) {\n  if (this.isEmpty(object)) return [];\n  if (this.isFn(object.map)) return object.map(callback);\n  var output = [];\n  this._each(object, function (value, key) {\n    output.push(callback(value, key, object));\n  });\n\n  return output;\n};\n\nvar hasOwn = function (objectToCheck, propertyToCheckFor) {\n  if (objectToCheck.hasOwnProperty) {\n    return objectToCheck.hasOwnProperty(propertyToCheckFor);\n  } else {\n    return (typeof objectToCheck[propertyToCheckFor] !== 'undefined') && (objectToCheck.constructor.prototype[propertyToCheckFor] !== objectToCheck[propertyToCheckFor]);\n  }\n};\n\nexports.insertElement = function(elm, doc, target) {\n  doc = doc || document;\n  let elToAppend;\n  if (target) {\n    elToAppend = doc.getElementsByTagName(target);\n  } else {\n    elToAppend = doc.getElementsByTagName('head');\n  }\n  try {\n    elToAppend = elToAppend.length ? elToAppend : doc.getElementsByTagName('body');\n    if (elToAppend.length) {\n      elToAppend = elToAppend[0];\n      elToAppend.insertBefore(elm, elToAppend.firstChild);\n    }\n  } catch (e) {}\n};\n\nexports.triggerPixel = function (url) {\n  const img = new Image();\n  img.src = url;\n};\n\n/**\n * Inserts empty iframe with the specified `url` for cookie sync\n * @param  {string} url URL to be requested\n * @param  {string} encodeUri boolean if URL should be encoded before inserted. Defaults to true\n */\nexports.insertUserSyncIframe = function(url) {\n  let iframeHtml = this.createTrackPixelIframeHtml(url, false, 'allow-scripts allow-same-origin');\n  let div = document.createElement('div');\n  div.innerHTML = iframeHtml;\n  let iframe = div.firstChild;\n  exports.insertElement(iframe);\n};\n\n/**\n * Creates a snippet of HTML that retrieves the specified `url`\n * @param  {string} url URL to be requested\n * @return {string}     HTML snippet that contains the img src = set to `url`\n */\nexports.createTrackPixelHtml = function (url) {\n  if (!url) {\n    return '';\n  }\n\n  let escapedUrl = encodeURI(url);\n  let img = '<div style=\"position:absolute;left:0px;top:0px;visibility:hidden;\">';\n  img += '<img src=\"' + escapedUrl + '\"></div>';\n  return img;\n};\n\n/**\n * Creates a snippet of Iframe HTML that retrieves the specified `url`\n * @param  {string} url plain URL to be requested\n * @param  {string} encodeUri boolean if URL should be encoded before inserted. Defaults to true\n * @param  {string} sandbox string if provided the sandbox attribute will be included with the given value\n * @return {string}     HTML snippet that contains the iframe src = set to `url`\n */\nexports.createTrackPixelIframeHtml = function (url, encodeUri = true, sandbox = '') {\n  if (!url) {\n    return '';\n  }\n  if (encodeUri) {\n    url = encodeURI(url);\n  }\n  if (sandbox) {\n    sandbox = `sandbox=\"${sandbox}\"`;\n  }\n\n  return `<iframe ${sandbox} id=\"${exports.getUniqueIdentifierStr()}\"\n      frameborder=\"0\"\n      allowtransparency=\"true\"\n      marginheight=\"0\" marginwidth=\"0\"\n      width=\"0\" hspace=\"0\" vspace=\"0\" height=\"0\"\n      style=\"height:0p;width:0p;display:none;\"\n      scrolling=\"no\"\n      src=\"${url}\">\n    </iframe>`;\n};\n\n/**\n * Returns iframe document in a browser agnostic way\n * @param  {object} iframe reference\n * @return {object}        iframe `document` reference\n */\nexports.getIframeDocument = function (iframe) {\n  if (!iframe) {\n    return;\n  }\n\n  let doc;\n  try {\n    if (iframe.contentWindow) {\n      doc = iframe.contentWindow.document;\n    } else if (iframe.contentDocument.document) {\n      doc = iframe.contentDocument.document;\n    } else {\n      doc = iframe.contentDocument;\n    }\n  } catch (e) {\n    this.logError('Cannot get iframe document', e);\n  }\n\n  return doc;\n};\n\nexports.getValueString = function(param, val, defaultValue) {\n  if (val === undefined || val === null) {\n    return defaultValue;\n  }\n  if (this.isStr(val)) {\n    return val;\n  }\n  if (this.isNumber(val)) {\n    return val.toString();\n  }\n  this.logWarn('Unsuported type for param: ' + param + ' required type: String');\n};\n\nexport function uniques(value, index, arry) {\n  return arry.indexOf(value) === index;\n}\n\nexport function flatten(a, b) {\n  return a.concat(b);\n}\n\nexport function getBidRequest(id) {\n  return pbjs._bidsRequested.map(bidSet => bidSet.bids.find(bid => bid.bidId === id)).find(bid => bid);\n}\n\nexport function getKeys(obj) {\n  return Object.keys(obj);\n}\n\nexport function getValue(obj, key) {\n  return obj[key];\n}\n\nexport function getBidderCodes(adUnits = pbjs.adUnits) {\n  // this could memoize adUnits\n  return adUnits.map(unit => unit.bids.map(bid => bid.bidder)\n    .reduce(flatten, [])).reduce(flatten).filter(uniques);\n}\n\nexport function isGptPubadsDefined() {\n  if (window.googletag && exports.isFn(window.googletag.pubads) && exports.isFn(window.googletag.pubads().getSlots)) {\n    return true;\n  }\n}\n\nexport function getHighestCpm(previous, current) {\n  if (previous.cpm === current.cpm) {\n    return previous.timeToRespond > current.timeToRespond ? current : previous;\n  }\n\n  return previous.cpm < current.cpm ? current : previous;\n}\n\n/**\n * FisherYates shuffle\n * http://stackoverflow.com/a/6274398\n * https://bost.ocks.org/mike/shuffle/\n * istanbul ignore next\n */\nexport function shuffle(array) {\n  let counter = array.length;\n\n  // while there are elements in the array\n  while (counter > 0) {\n    // pick a random index\n    let index = Math.floor(Math.random() * counter);\n\n    // decrease counter by 1\n    counter--;\n\n    // and swap the last element with it\n    let temp = array[counter];\n    array[counter] = array[index];\n    array[index] = temp;\n  }\n\n  return array;\n}\n\nexport function adUnitsFilter(filter, bid) {\n  return filter.includes((bid && bid.placementCode) || (bid && bid.adUnitCode));\n}\n\n/**\n * Check if parent iframe of passed document supports content rendering via 'srcdoc' property\n * @param {HTMLDocument} doc document to check support of 'srcdoc'\n */\nexport function isSrcdocSupported(doc) {\n  // Firefox is excluded due to https://bugzilla.mozilla.org/show_bug.cgi?id=1265961\n  return doc.defaultView && doc.defaultView.frameElement &&\n    'srcdoc' in doc.defaultView.frameElement && !/firefox/i.test(navigator.userAgent);\n}\n\nexport function cloneJson(obj) {\n  return JSON.parse(JSON.stringify(obj));\n}\n\nexport function inIframe() {\n  try {\n    return window.self !== window.top;\n  } catch (e) {\n    return true;\n  }\n}\n\nexport function isSafariBrowser() {\n  return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n}\n\nexport function replaceAuctionPrice(str, cpm) {\n  if (!str) return;\n  return str.replace(/\\$\\{AUCTION_PRICE\\}/g, cpm);\n}\n\nexport function getBidderRequestAllAdUnits(bidder) {\n  return pbjs._bidsRequested.find(request => request.bidderCode === bidder);\n}\n\nexport function getBidderRequest(bidder, adUnitCode) {\n  return pbjs._bidsRequested.find(request => {\n    return request.bids\n      .filter(bid => bid.bidder === bidder && bid.placementCode === adUnitCode).length > 0;\n  }) || { start: null, requestId: null };\n}\n\nexport function cookiesAreEnabled() {\n  if (window.navigator.cookieEnabled || !!document.cookie.length) {\n    return true;\n  }\n  window.document.cookie = 'prebid.cookieTest';\n  return window.document.cookie.indexOf('prebid.cookieTest') != -1;\n}\n\n/**\n * Given a function, return a function which only executes the original after\n * it's been called numRequiredCalls times.\n *\n * Note that the arguments from the previous calls will *not* be forwarded to the original function.\n * Only the final call's arguments matter.\n *\n * @param {function} func The function which should be executed, once the returned function has been executed\n *   numRequiredCalls times.\n * @param {int} numRequiredCalls The number of times which the returned function needs to be called before\n *   func is.\n */\nexport function delayExecution(func, numRequiredCalls) {\n  if (numRequiredCalls < 1) {\n    throw new Error(`numRequiredCalls must be a positive number. Got ${numRequiredCalls}`);\n  }\n  let numCalls = 0;\n  return function () {\n    numCalls++;\n    if (numCalls === numRequiredCalls) {\n      func.apply(null, arguments);\n    }\n  }\n}\n\n/**\n * https://stackoverflow.com/a/34890276/428704\n * @export\n * @param {array} xs\n * @param {string} key\n * @returns {${key_value}: ${groupByArray}, key_value: {groupByArray}}\n */\nexport function groupBy(xs, key) {\n  return xs.reduce(function(rv, x) {\n    (rv[x[key]] = rv[x[key]] || []).push(x);\n    return rv;\n  }, {});\n}\n\n/**\n * deepAccess utility function useful for doing safe access (will not throw exceptions) of deep object paths.\n * @param {object} obj The object containing the values you would like to access.\n * @param {string|number} path Object path to the value you would like to access.  Non-strings are coerced to strings.\n * @returns {*} The value found at the specified object path, or undefined if path is not found.\n */\nexport function deepAccess(obj, path) {\n  path = String(path).split('.');\n  for (let i = 0; i < path.length; i++) {\n    obj = obj[path[i]];\n    if (typeof obj === 'undefined') {\n      return;\n    }\n  }\n  return obj;\n}\n\n/**\n * Build an object consisting of only defined parameters to avoid creating an\n * object with defined keys and undefined values.\n * @param {object} object The object to pick defined params out of\n * @param {string[]} params An array of strings representing properties to look for in the object\n * @returns {object} An object containing all the specified values that are defined\n */\nexport function getDefinedParams(object, params) {\n  return params\n    .filter(param => object[param])\n    .reduce((bid, param) => Object.assign(bid, { [param]: object[param] }), {});\n}\n\n/**\n * @typedef {Object} MediaTypes\n * @property {Object} banner banner configuration\n * @property {Object} native native configuration\n * @property {Object} video video configuration\n */\n\n/**\n * Validates an adunit's `mediaTypes` parameter\n * @param {MediaTypes} mediaTypes mediaTypes parameter to validate\n * @return {boolean} If object is valid\n */\nexport function isValidMediaTypes(mediaTypes) {\n  const SUPPORTED_MEDIA_TYPES = ['banner', 'native', 'video'];\n  const SUPPORTED_STREAM_TYPES = ['instream', 'outstream'];\n\n  const types = Object.keys(mediaTypes);\n\n  if (!types.every(type => SUPPORTED_MEDIA_TYPES.includes(type))) {\n    return false;\n  }\n\n  if (mediaTypes.video && mediaTypes.video.context) {\n    return SUPPORTED_STREAM_TYPES.includes(mediaTypes.video.context);\n  }\n\n  return true;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","/** @module adaptermanger */\n\nimport { flatten, getBidderCodes, getDefinedParams, shuffle } from './utils';\nimport { mapSizes } from './sizeMapping';\nimport { processNativeAdUnitParams, nativeAdapters } from './native';\nimport { newBidder } from './adapters/bidderFactory';\n\nvar utils = require('./utils.js');\nvar CONSTANTS = require('./constants.json');\nvar events = require('./events');\nlet s2sTestingModule; // store s2sTesting module if it's loaded\n\nvar _bidderRegistry = {};\nexports.bidderRegistry = _bidderRegistry;\n\n// create s2s settings objectType_function\nlet _s2sConfig = {\n  endpoint: CONSTANTS.S2S.DEFAULT_ENDPOINT,\n  adapter: CONSTANTS.S2S.ADAPTER,\n  syncEndpoint: CONSTANTS.S2S.SYNC_ENDPOINT\n};\n\nconst RANDOM = 'random';\nconst FIXED = 'fixed';\n\nconst VALID_ORDERS = {};\nVALID_ORDERS[RANDOM] = true;\nVALID_ORDERS[FIXED] = true;\n\nvar _analyticsRegistry = {};\nlet _bidderSequence = RANDOM;\n\nfunction getBids({bidderCode, requestId, bidderRequestId, adUnits}) {\n  return adUnits.map(adUnit => {\n    return adUnit.bids.filter(bid => bid.bidder === bidderCode)\n      .map(bid => {\n        let sizes = adUnit.sizes;\n        if (adUnit.sizeMapping) {\n          let sizeMapping = mapSizes(adUnit);\n          if (sizeMapping === '') {\n            return '';\n          }\n          sizes = sizeMapping;\n        }\n\n        if (adUnit.mediaTypes) {\n          if (utils.isValidMediaTypes(adUnit.mediaTypes)) {\n            bid = Object.assign({}, bid, { mediaTypes: adUnit.mediaTypes });\n          } else {\n            utils.logError(\n              `mediaTypes is not correctly configured for adunit ${adUnit.code}`\n            );\n          }\n        }\n\n        const nativeParams =\n          adUnit.nativeParams || utils.deepAccess(adUnit, 'mediaTypes.native');\n        if (nativeParams) {\n          bid = Object.assign({}, bid, {\n            nativeParams: processNativeAdUnitParams(nativeParams),\n          });\n        }\n\n        bid = Object.assign({}, bid, getDefinedParams(adUnit, [\n          'mediaType',\n          'renderer'\n        ]));\n\n        return Object.assign({}, bid, {\n          placementCode: adUnit.code,\n          transactionId: adUnit.transactionId,\n          sizes: sizes,\n          bidId: bid.bid_id || utils.getUniqueIdentifierStr(),\n          bidderRequestId,\n          requestId\n        });\n      }\n      );\n  }).reduce(flatten, []).filter(val => val !== '');\n}\n\nexports.callBids = ({adUnits, cbTimeout}) => {\n  const requestId = utils.generateUUID();\n  const auctionStart = Date.now();\n\n  const auctionInit = {\n    timestamp: auctionStart,\n    requestId,\n    timeout: cbTimeout\n  };\n  events.emit(CONSTANTS.EVENTS.AUCTION_INIT, auctionInit);\n\n  let bidderCodes = getBidderCodes(adUnits);\n  if (_bidderSequence === RANDOM) {\n    bidderCodes = shuffle(bidderCodes);\n  }\n\n  const s2sAdapter = _bidderRegistry[_s2sConfig.adapter];\n  if (s2sAdapter) {\n    s2sAdapter.setConfig(_s2sConfig);\n    s2sAdapter.queueSync({bidderCodes});\n  }\n\n  let clientTestAdapters = [];\n  let s2sTesting = false;\n  if (_s2sConfig.enabled) {\n    // if s2sConfig.bidderControl testing is turned on\n    s2sTesting = _s2sConfig.testing && typeof s2sTestingModule !== 'undefined';\n    if (s2sTesting) {\n      // get all adapters doing client testing\n      clientTestAdapters = s2sTestingModule.getSourceBidderMap(adUnits)[s2sTestingModule.CLIENT];\n    }\n\n    // these are called on the s2s adapter\n    let adaptersServerSide = _s2sConfig.bidders;\n\n    // don't call these client side (unless client request is needed for testing)\n    bidderCodes = bidderCodes.filter((elm) => {\n      return !adaptersServerSide.includes(elm) || clientTestAdapters.includes(elm);\n    });\n    let adUnitsS2SCopy = utils.cloneJson(adUnits);\n\n    // filter out client side bids\n    adUnitsS2SCopy.forEach((adUnit) => {\n      if (adUnit.sizeMapping) {\n        adUnit.sizes = mapSizes(adUnit);\n        delete adUnit.sizeMapping;\n      }\n      adUnit.sizes = transformHeightWidth(adUnit);\n      adUnit.bids = adUnit.bids.filter((bid) => {\n        return adaptersServerSide.includes(bid.bidder) && (!s2sTesting || bid.finalSource !== s2sTestingModule.CLIENT);\n      }).map((bid) => {\n        bid.bid_id = utils.getUniqueIdentifierStr();\n        return bid;\n      });\n    });\n\n    // don't send empty requests\n    adUnitsS2SCopy = adUnitsS2SCopy.filter(adUnit => {\n      return adUnit.bids.length !== 0;\n    });\n\n    let tid = utils.generateUUID();\n    adaptersServerSide.forEach(bidderCode => {\n      const bidderRequestId = utils.getUniqueIdentifierStr();\n      const bidderRequest = {\n        bidderCode,\n        requestId,\n        bidderRequestId,\n        tid,\n        bids: getBids({bidderCode, requestId, bidderRequestId, 'adUnits': adUnitsS2SCopy}),\n        start: new Date().getTime(),\n        auctionStart: auctionStart,\n        timeout: _s2sConfig.timeout,\n        src: CONSTANTS.S2S.SRC\n      };\n      if (bidderRequest.bids.length !== 0) {\n        pbjs._bidsRequested.push(bidderRequest);\n      }\n    });\n\n    let s2sBidRequest = {tid, 'ad_units': adUnitsS2SCopy};\n    utils.logMessage(`CALLING S2S HEADER BIDDERS ==== ${adaptersServerSide.join(',')}`);\n    if (s2sBidRequest.ad_units.length) {\n      s2sAdapter.callBids(s2sBidRequest);\n    }\n  }\n\n  let _bidderRequests = [];\n  // client side adapters\n  let adUnitsClientCopy = utils.cloneJson(adUnits);\n  // filter out s2s bids\n  adUnitsClientCopy.forEach((adUnit) => {\n    adUnit.bids = adUnit.bids.filter((bid) => {\n      return !s2sTesting || bid.finalSource !== s2sTestingModule.SERVER;\n    })\n  });\n\n  // don't send empty requests\n  adUnitsClientCopy = adUnitsClientCopy.filter(adUnit => {\n    return adUnit.bids.length !== 0;\n  });\n\n  bidderCodes.forEach(bidderCode => {\n    const adapter = _bidderRegistry[bidderCode];\n    if (adapter) {\n      const bidderRequestId = utils.getUniqueIdentifierStr();\n      const bidderRequest = {\n        bidderCode,\n        requestId,\n        bidderRequestId,\n        bids: getBids({bidderCode, requestId, bidderRequestId, 'adUnits': adUnitsClientCopy}),\n        auctionStart: auctionStart,\n        timeout: cbTimeout\n      };\n      if (bidderRequest.bids && bidderRequest.bids.length !== 0) {\n        pbjs._bidsRequested.push(bidderRequest);\n        _bidderRequests.push(bidderRequest);\n      }\n    } else {\n      utils.logError(`Adapter trying to be called which does not exist: ${bidderCode} adaptermanager.callBids`);\n    }\n  });\n\n  _bidderRequests.forEach(bidRequest => {\n    bidRequest.start = new Date().getTime();\n    const adapter = _bidderRegistry[bidRequest.bidderCode];\n    if (bidRequest.bids && bidRequest.bids.length !== 0) {\n      utils.logMessage(`CALLING BIDDER ======= ${bidRequest.bidderCode}`);\n      events.emit(CONSTANTS.EVENTS.BID_REQUESTED, bidRequest);\n      adapter.callBids(bidRequest);\n    }\n  })\n};\n\nfunction transformHeightWidth(adUnit) {\n  let sizesObj = [];\n  let sizes = utils.parseSizesInput(adUnit.sizes);\n  sizes.forEach(size => {\n    let heightWidth = size.split('x');\n    let sizeObj = {\n      'w': parseInt(heightWidth[0]),\n      'h': parseInt(heightWidth[1])\n    };\n    sizesObj.push(sizeObj);\n  });\n  return sizesObj;\n}\n\nfunction getSupportedMediaTypes(bidderCode) {\n  let result = [];\n  if (exports.videoAdapters.includes(bidderCode)) result.push('video');\n  if (nativeAdapters.includes(bidderCode)) result.push('native');\n  return result;\n}\n\nexports.videoAdapters = []; // added by adapterLoader for now\n\nexports.registerBidAdapter = function (bidAdaptor, bidderCode, {supportedMediaTypes = []} = {}) {\n  if (bidAdaptor && bidderCode) {\n    if (typeof bidAdaptor.callBids === 'function') {\n      _bidderRegistry[bidderCode] = bidAdaptor;\n\n      if (supportedMediaTypes.includes('video')) {\n        exports.videoAdapters.push(bidderCode);\n      }\n      if (supportedMediaTypes.includes('native')) {\n        nativeAdapters.push(bidderCode);\n      }\n    } else {\n      utils.logError('Bidder adaptor error for bidder code: ' + bidderCode + 'bidder must implement a callBids() function');\n    }\n  } else {\n    utils.logError('bidAdaptor or bidderCode not specified');\n  }\n};\n\nexports.aliasBidAdapter = function (bidderCode, alias) {\n  var existingAlias = _bidderRegistry[alias];\n\n  if (typeof existingAlias === 'undefined') {\n    var bidAdaptor = _bidderRegistry[bidderCode];\n    if (typeof bidAdaptor === 'undefined') {\n      utils.logError('bidderCode \"' + bidderCode + '\" is not an existing bidder.', 'adaptermanager.aliasBidAdapter');\n    } else {\n      try {\n        let newAdapter;\n        let supportedMediaTypes = getSupportedMediaTypes(bidderCode);\n        // Have kept old code to support backward compatibilitiy.\n        // Remove this if loop when all adapters are supporting bidderFactory. i.e When Prebid.js is 1.0\n        if (bidAdaptor.constructor.prototype != Object.prototype) {\n          newAdapter = new bidAdaptor.constructor();\n          newAdapter.setBidderCode(alias);\n        } else {\n          let spec = bidAdaptor.getSpec();\n          newAdapter = newBidder(Object.assign({}, spec, { code: alias }));\n        }\n        this.registerBidAdapter(newAdapter, alias, {\n          supportedMediaTypes\n        });\n      } catch (e) {\n        utils.logError(bidderCode + ' bidder does not currently support aliasing.', 'adaptermanager.aliasBidAdapter');\n      }\n    }\n  } else {\n    utils.logMessage('alias name \"' + alias + '\" has been already specified.');\n  }\n};\n\nexports.registerAnalyticsAdapter = function ({adapter, code}) {\n  if (adapter && code) {\n    if (typeof adapter.enableAnalytics === 'function') {\n      adapter.code = code;\n      _analyticsRegistry[code] = adapter;\n    } else {\n      utils.logError(`Prebid Error: Analytics adaptor error for analytics \"${code}\"\n        analytics adapter must implement an enableAnalytics() function`);\n    }\n  } else {\n    utils.logError('Prebid Error: analyticsAdapter or analyticsCode not specified');\n  }\n};\n\nexports.enableAnalytics = function (config) {\n  if (!utils.isArray(config)) {\n    config = [config];\n  }\n\n  utils._each(config, adapterConfig => {\n    var adapter = _analyticsRegistry[adapterConfig.provider];\n    if (adapter) {\n      adapter.enableAnalytics(adapterConfig);\n    } else {\n      utils.logError(`Prebid Error: no analytics adapter found in registry for\n        ${adapterConfig.provider}.`);\n    }\n  });\n};\n\nexports.setBidderSequence = function (order) {\n  if (VALID_ORDERS[order]) {\n    _bidderSequence = order;\n  } else {\n    utils.logWarn(`Invalid order: ${order}. Bidder Sequence was not set.`);\n  }\n};\n\nexports.getBidAdapter = function(bidder) {\n  return _bidderRegistry[bidder];\n};\n\nexports.setS2SConfig = function (config) {\n  _s2sConfig = config;\n};\n\n// the s2sTesting module is injected when it's loaded rather than being imported\n// importing it causes the packager to include it even when it's not explicitly included in the build\nexports.setS2STestingModule = function (module) {\n  s2sTestingModule = module;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/adaptermanager.js","import { uniques, flatten, adUnitsFilter, getBidderRequest } from './utils';\nimport { getPriceBucketString } from './cpmBucketManager';\nimport { nativeBidIsValid, getNativeTargeting } from './native';\nimport { isValidVideoBid } from './video';\nimport { getCacheUrl, store } from './videoCache';\nimport { Renderer } from 'src/Renderer';\nimport { config } from 'src/config';\nimport { createHook } from 'src/hook';\n\nvar CONSTANTS = require('./constants.json');\nvar AUCTION_END = CONSTANTS.EVENTS.AUCTION_END;\nvar utils = require('./utils.js');\nvar events = require('./events');\n\nvar externalCallbacks = {byAdUnit: [], all: [], oneTime: null, timer: false};\nvar defaultBidderSettingsMap = {};\n\n/**\n * Returns a list of bidders that we haven't received a response yet\n * @return {array} [description]\n */\nexports.getTimedOutBidders = function () {\n  return pbjs._bidsRequested\n    .map(getBidderCode)\n    .filter(uniques)\n    .filter(bidder => pbjs._bidsReceived\n      .map(getBidders)\n      .filter(uniques)\n      .indexOf(bidder) < 0);\n};\n\nfunction timestamp() { return new Date().getTime(); }\n\nfunction getBidderCode(bidSet) {\n  return bidSet.bidderCode;\n}\n\nfunction getBidders(bid) {\n  return bid.bidder;\n}\n\nfunction bidsBackAdUnit(adUnitCode) {\n  const requested = pbjs._bidsRequested\n    .map(request => request.bids\n      .filter(adUnitsFilter.bind(this, pbjs._adUnitCodes))\n      .filter(bid => bid.placementCode === adUnitCode))\n    .reduce(flatten, [])\n    .map(bid => {\n      return bid.bidder === 'indexExchange'\n        ? bid.sizes.length\n        : 1;\n    }).reduce(add, 0);\n\n  const received = pbjs._bidsReceived.filter(bid => bid.adUnitCode === adUnitCode).length;\n  return requested === received;\n}\n\nfunction add(a, b) {\n  return a + b;\n}\n\nfunction bidsBackAll() {\n  const requested = pbjs._bidsRequested\n    .map(request => request.bids)\n    .reduce(flatten, [])\n    .filter(adUnitsFilter.bind(this, pbjs._adUnitCodes))\n    .map(bid => {\n      return bid.bidder === 'indexExchange'\n        ? bid.sizes.length\n        : 1;\n    }).reduce((a, b) => a + b, 0);\n\n  const received = pbjs._bidsReceived\n    .filter(adUnitsFilter.bind(this, pbjs._adUnitCodes)).length;\n\n  return requested === received;\n}\n\nexports.bidsBackAll = function () {\n  return bidsBackAll();\n};\n\n/*\n *   This function should be called to by the bidder adapter to register a bid response\n */\nexports.addBidResponse = createHook('asyncSeries', function (adUnitCode, bid) {\n  if (isValid()) {\n    prepareBidForAuction();\n\n    if (bid.mediaType === 'video') {\n      tryAddVideoBid(bid);\n    } else {\n      addBidToAuction(bid);\n      doCallbacksIfNeeded();\n    }\n  }\n\n  // Actual method logic is above. Everything below is helper functions.\n\n  // Validate the arguments sent to us by the adapter. If this returns false, the bid should be totally ignored.\n  function isValid() {\n    function errorMessage(msg) {\n      return `Invalid bid from ${bid.bidderCode}. Ignoring bid: ${msg}`;\n    }\n\n    if (!bid) {\n      utils.logError(`Some adapter tried to add an undefined bid for ${adUnitCode}.`);\n      return false;\n    }\n    if (!adUnitCode) {\n      utils.logError(errorMessage('No adUnitCode was supplied to addBidResponse.'));\n      return false;\n    }\n\n    const bidRequest = getBidderRequest(bid.bidderCode, adUnitCode);\n    if (!bidRequest.start) {\n      utils.logError(errorMessage('Cannot find valid matching bid request.'));\n      return false;\n    }\n\n    if (bid.mediaType === 'native' && !nativeBidIsValid(bid)) {\n      utils.logError(errorMessage('Native bid missing some required properties.'));\n      return false;\n    }\n    if (bid.mediaType === 'video' && !isValidVideoBid(bid)) {\n      utils.logError(errorMessage(`Video bid does not have required vastUrl or renderer property`));\n      return false;\n    }\n    if (bid.mediaType === 'banner' && !validBidSize(bid)) {\n      utils.logError(errorMessage(`Banner bids require a width and height`));\n      return false;\n    }\n\n    return true;\n  }\n\n  // check that the bid has a width and height set\n  function validBidSize(bid) {\n    if ((bid.width || bid.width === 0) && (bid.height || bid.height === 0)) {\n      return true;\n    }\n\n    const adUnit = getBidderRequest(bid.bidderCode, adUnitCode);\n    const sizes = adUnit && adUnit.bids && adUnit.bids[0] && adUnit.bids[0].sizes;\n    const parsedSizes = utils.parseSizesInput(sizes);\n\n    // if a banner impression has one valid size, we assign that size to any bid\n    // response that does not explicitly set width or height\n    if (parsedSizes.length === 1) {\n      const [ width, height ] = parsedSizes[0].split('x');\n      bid.width = width;\n      bid.height = height;\n      return true;\n    }\n\n    return false;\n  }\n\n  // Postprocess the bids so that all the universal properties exist, no matter which bidder they came from.\n  // This should be called before addBidToAuction().\n  function prepareBidForAuction() {\n    const bidRequest = getBidderRequest(bid.bidderCode, adUnitCode);\n\n    Object.assign(bid, {\n      requestId: bidRequest.requestId,\n      responseTimestamp: timestamp(),\n      requestTimestamp: bidRequest.start,\n      cpm: parseFloat(bid.cpm) || 0,\n      bidder: bid.bidderCode,\n      adUnitCode\n    });\n\n    bid.timeToRespond = bid.responseTimestamp - bid.requestTimestamp;\n\n    // Let listeners know that now is the time to adjust the bid, if they want to.\n    //\n    // CAREFUL: Publishers rely on certain bid properties to be available (like cpm),\n    // but others to not be set yet (like priceStrings). See #1372 and #1389.\n    events.emit(CONSTANTS.EVENTS.BID_ADJUSTMENT, bid);\n\n    // a publisher-defined renderer can be used to render bids\n    const adUnitRenderer =\n      bidRequest.bids && bidRequest.bids[0] && bidRequest.bids[0].renderer;\n\n    if (adUnitRenderer) {\n      bid.renderer = Renderer.install({ url: adUnitRenderer.url });\n      bid.renderer.setRender(adUnitRenderer.render);\n    }\n\n    const priceStringsObj = getPriceBucketString(\n      bid.cpm,\n      config.getConfig('customPriceBucket'),\n      config.getConfig('currency.granularityMultiplier')\n    );\n    bid.pbLg = priceStringsObj.low;\n    bid.pbMg = priceStringsObj.med;\n    bid.pbHg = priceStringsObj.high;\n    bid.pbAg = priceStringsObj.auto;\n    bid.pbDg = priceStringsObj.dense;\n    bid.pbCg = priceStringsObj.custom;\n\n    // if there is any key value pairs to map do here\n    var keyValues;\n    if (bid.bidderCode && (bid.cpm > 0 || bid.dealId)) {\n      keyValues = getKeyValueTargetingPairs(bid.bidderCode, bid);\n    }\n\n    // use any targeting provided as defaults, otherwise just set from getKeyValueTargetingPairs\n    bid.adserverTargeting = Object.assign(bid.adserverTargeting || {}, keyValues);\n  }\n\n  function doCallbacksIfNeeded() {\n    if (bid.timeToRespond > pbjs.cbTimeout + pbjs.timeoutBuffer) {\n      const timedOut = true;\n      exports.executeCallback(timedOut);\n    }\n  }\n\n  // Add a bid to the auction.\n  function addBidToAuction() {\n    events.emit(CONSTANTS.EVENTS.BID_RESPONSE, bid);\n\n    pbjs._bidsReceived.push(bid);\n\n    if (bid.adUnitCode && bidsBackAdUnit(bid.adUnitCode)) {\n      triggerAdUnitCallbacks(bid.adUnitCode);\n    }\n\n    if (bidsBackAll()) {\n      exports.executeCallback();\n    }\n  }\n\n  // Video bids may fail if the cache is down, or there's trouble on the network.\n  function tryAddVideoBid(bid) {\n    if (config.getConfig('usePrebidCache')) {\n      store([bid], function(error, cacheIds) {\n        if (error) {\n          utils.logWarn(`Failed to save to the video cache: ${error}. Video bid must be discarded.`);\n        } else {\n          bid.videoCacheKey = cacheIds[0].uuid;\n          if (!bid.vastUrl) {\n            bid.vastUrl = getCacheUrl(bid.videoCacheKey);\n          }\n          addBidToAuction(bid);\n        }\n        doCallbacksIfNeeded();\n      });\n    } else {\n      addBidToAuction(bid);\n      doCallbacksIfNeeded();\n    }\n  }\n});\n\nfunction getKeyValueTargetingPairs(bidderCode, custBidObj) {\n  var keyValues = {};\n  var bidder_settings = pbjs.bidderSettings;\n\n  // 1) set the keys from \"standard\" setting or from prebid defaults\n  if (custBidObj && bidder_settings) {\n    // initialize default if not set\n    const standardSettings = getStandardBidderSettings();\n    setKeys(keyValues, standardSettings, custBidObj);\n  }\n\n  if (bidderCode && custBidObj && bidder_settings && bidder_settings[bidderCode] && bidder_settings[bidderCode][CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING]) {\n    // 2) set keys from specific bidder setting override if they exist\n    setKeys(keyValues, bidder_settings[bidderCode], custBidObj);\n    custBidObj.alwaysUseBid = bidder_settings[bidderCode].alwaysUseBid;\n    custBidObj.sendStandardTargeting = bidder_settings[bidderCode].sendStandardTargeting;\n  } else if (defaultBidderSettingsMap[bidderCode]) {\n    // 2) set keys from standard setting. NOTE: this API doesn't seem to be in use by any Adapter\n    setKeys(keyValues, defaultBidderSettingsMap[bidderCode], custBidObj);\n    custBidObj.alwaysUseBid = defaultBidderSettingsMap[bidderCode].alwaysUseBid;\n    custBidObj.sendStandardTargeting = defaultBidderSettingsMap[bidderCode].sendStandardTargeting;\n  }\n\n  if (custBidObj['native']) {\n    keyValues = Object.assign({}, keyValues, getNativeTargeting(custBidObj));\n  }\n\n  return keyValues;\n}\n\nexports.getKeyValueTargetingPairs = function() {\n  return getKeyValueTargetingPairs(...arguments);\n};\n\nfunction setKeys(keyValues, bidderSettings, custBidObj) {\n  var targeting = bidderSettings[CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING];\n  custBidObj.size = custBidObj.getSize();\n\n  utils._each(targeting, function (kvPair) {\n    var key = kvPair.key;\n    var value = kvPair.val;\n\n    if (keyValues[key]) {\n      utils.logWarn('The key: ' + key + ' is getting ovewritten');\n    }\n\n    if (utils.isFn(value)) {\n      try {\n        value = value(custBidObj);\n      } catch (e) {\n        utils.logError('bidmanager', 'ERROR', e);\n      }\n    }\n\n    if (\n      ((typeof bidderSettings.suppressEmptyKeys !== 'undefined' && bidderSettings.suppressEmptyKeys === true) ||\n      key === 'hb_deal') && // hb_deal is suppressed automatically if not set\n      (\n        utils.isEmptyStr(value) ||\n        value === null ||\n        value === undefined\n      )\n    ) {\n      utils.logInfo(\"suppressing empty key '\" + key + \"' from adserver targeting\");\n    } else {\n      keyValues[key] = value;\n    }\n  });\n\n  return keyValues;\n}\n\nexports.registerDefaultBidderSetting = function (bidderCode, defaultSetting) {\n  defaultBidderSettingsMap[bidderCode] = defaultSetting;\n};\n\nexports.executeCallback = function (timedOut) {\n  // if there's still a timeout running, clear it now\n  if (!timedOut && externalCallbacks.timer) {\n    clearTimeout(externalCallbacks.timer);\n  }\n\n  if (externalCallbacks.all.called !== true) {\n    processCallbacks(externalCallbacks.all);\n    externalCallbacks.all.called = true;\n\n    if (timedOut) {\n      const timedOutBidders = exports.getTimedOutBidders();\n\n      if (timedOutBidders.length) {\n        events.emit(CONSTANTS.EVENTS.BID_TIMEOUT, timedOutBidders);\n      }\n    }\n  }\n\n  // execute one time callback\n  if (externalCallbacks.oneTime) {\n    events.emit(AUCTION_END);\n    try {\n      processCallbacks([externalCallbacks.oneTime]);\n    } catch (e) {\n      utils.logError('Error executing bidsBackHandler', null, e);\n    } finally {\n      externalCallbacks.oneTime = null;\n      externalCallbacks.timer = false;\n      pbjs.clearAuction();\n    }\n  }\n};\n\nexports.externalCallbackReset = function () {\n  externalCallbacks.all.called = false;\n};\n\nfunction triggerAdUnitCallbacks(adUnitCode) {\n  // todo : get bid responses and send in args\n  var singleAdUnitCode = [adUnitCode];\n  processCallbacks(externalCallbacks.byAdUnit, singleAdUnitCode);\n}\n\nfunction processCallbacks(callbackQueue, singleAdUnitCode) {\n  if (utils.isArray(callbackQueue)) {\n    callbackQueue.forEach(callback => {\n      const adUnitCodes = singleAdUnitCode || pbjs._adUnitCodes;\n      const bids = [pbjs._bidsReceived\n        .filter(adUnitsFilter.bind(this, adUnitCodes))\n        .reduce(groupByPlacement, {})];\n\n      callback.apply(pbjs, bids);\n    });\n  }\n}\n\n/**\n * groupByPlacement is a reduce function that converts an array of Bid objects\n * to an object with placement codes as keys, with each key representing an object\n * with an array of `Bid` objects for that placement\n * @returns {*} as { [adUnitCode]: { bids: [Bid, Bid, Bid] } }\n */\nfunction groupByPlacement(bidsByPlacement, bid) {\n  if (!bidsByPlacement[bid.adUnitCode]) { bidsByPlacement[bid.adUnitCode] = { bids: [] }; }\n\n  bidsByPlacement[bid.adUnitCode].bids.push(bid);\n\n  return bidsByPlacement;\n}\n\n/**\n * Add a one time callback, that is discarded after it is called\n * @param {Function} callback\n * @param timer Timer to clear if callback is triggered before timer time's out\n */\nexports.addOneTimeCallback = function (callback, timer) {\n  externalCallbacks.oneTime = callback;\n  externalCallbacks.timer = timer;\n};\n\nexports.addCallback = function (id, callback, cbEvent) {\n  callback.id = id;\n  if (CONSTANTS.CB.TYPE.ALL_BIDS_BACK === cbEvent) {\n    externalCallbacks.all.push(callback);\n  } else if (CONSTANTS.CB.TYPE.AD_UNIT_BIDS_BACK === cbEvent) {\n    externalCallbacks.byAdUnit.push(callback);\n  }\n};\n\n// register event for bid adjustment\nevents.on(CONSTANTS.EVENTS.BID_ADJUSTMENT, function (bid) {\n  adjustBids(bid);\n});\n\nfunction adjustBids(bid) {\n  var code = bid.bidderCode;\n  var bidPriceAdjusted = bid.cpm;\n  let bidCpmAdjustment;\n  if (pbjs.bidderSettings) {\n    if (code && pbjs.bidderSettings[code] && typeof pbjs.bidderSettings[code].bidCpmAdjustment === 'function') {\n      bidCpmAdjustment = pbjs.bidderSettings[code].bidCpmAdjustment;\n    } else if (pbjs.bidderSettings[CONSTANTS.JSON_MAPPING.BD_SETTING_STANDARD] && typeof pbjs.bidderSettings[CONSTANTS.JSON_MAPPING.BD_SETTING_STANDARD].bidCpmAdjustment === 'function') {\n      bidCpmAdjustment = pbjs.bidderSettings[CONSTANTS.JSON_MAPPING.BD_SETTING_STANDARD].bidCpmAdjustment;\n    }\n    if (bidCpmAdjustment) {\n      try {\n        bidPriceAdjusted = bidCpmAdjustment(bid.cpm, Object.assign({}, bid));\n      } catch (e) {\n        utils.logError('Error during bid adjustment', 'bidmanager.js', e);\n      }\n    }\n  }\n\n  if (bidPriceAdjusted >= 0) {\n    bid.cpm = bidPriceAdjusted;\n  }\n}\n\nexports.adjustBids = function() {\n  return adjustBids(...arguments);\n};\n\nfunction getStandardBidderSettings() {\n  let granularity = config.getConfig('priceGranularity');\n  let bidder_settings = pbjs.bidderSettings;\n  if (!bidder_settings[CONSTANTS.JSON_MAPPING.BD_SETTING_STANDARD]) {\n    bidder_settings[CONSTANTS.JSON_MAPPING.BD_SETTING_STANDARD] = {};\n  }\n  if (!bidder_settings[CONSTANTS.JSON_MAPPING.BD_SETTING_STANDARD][CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING]) {\n    bidder_settings[CONSTANTS.JSON_MAPPING.BD_SETTING_STANDARD][CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING] = [\n      {\n        key: 'hb_bidder',\n        val: function (bidResponse) {\n          return bidResponse.bidderCode;\n        }\n      }, {\n        key: 'hb_adid',\n        val: function (bidResponse) {\n          return bidResponse.adId;\n        }\n      }, {\n        key: 'hb_pb',\n        val: function (bidResponse) {\n          if (granularity === CONSTANTS.GRANULARITY_OPTIONS.AUTO) {\n            return bidResponse.pbAg;\n          } else if (granularity === CONSTANTS.GRANULARITY_OPTIONS.DENSE) {\n            return bidResponse.pbDg;\n          } else if (granularity === CONSTANTS.GRANULARITY_OPTIONS.LOW) {\n            return bidResponse.pbLg;\n          } else if (granularity === CONSTANTS.GRANULARITY_OPTIONS.MEDIUM) {\n            return bidResponse.pbMg;\n          } else if (granularity === CONSTANTS.GRANULARITY_OPTIONS.HIGH) {\n            return bidResponse.pbHg;\n          } else if (granularity === CONSTANTS.GRANULARITY_OPTIONS.CUSTOM) {\n            return bidResponse.pbCg;\n          }\n        }\n      }, {\n        key: 'hb_size',\n        val: function (bidResponse) {\n          return bidResponse.size;\n        }\n      }, {\n        key: 'hb_deal',\n        val: function (bidResponse) {\n          return bidResponse.dealId;\n        }\n      }\n    ];\n  }\n  return bidder_settings[CONSTANTS.JSON_MAPPING.BD_SETTING_STANDARD];\n}\n\nfunction getStandardBidderAdServerTargeting() {\n  return getStandardBidderSettings()[CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING];\n}\n\nexports.getStandardBidderAdServerTargeting = getStandardBidderAdServerTargeting;\n\n\n\n// WEBPACK FOOTER //\n// ./src/bidmanager.js","var utils = require('./utils.js');\n\n/**\n Required paramaters\n bidderCode,\n height,\n width,\n statusCode\n Optional paramaters\n adId,\n cpm,\n ad,\n adUrl,\n dealId,\n priceKeyString;\n */\nfunction Bid(statusCode, bidRequest) {\n  var _bidId = (bidRequest && bidRequest.bidId) || utils.getUniqueIdentifierStr();\n  var _statusCode = statusCode || 0;\n\n  this.bidderCode = (bidRequest && bidRequest.bidder) || '';\n  this.width = 0;\n  this.height = 0;\n  this.statusMessage = _getStatus();\n  this.adId = _bidId;\n  this.mediaType = 'banner';\n\n  function _getStatus() {\n    switch (_statusCode) {\n      case 0:\n        return 'Pending';\n      case 1:\n        return 'Bid available';\n      case 2:\n        return 'Bid returned empty or error response';\n      case 3:\n        return 'Bid timed out';\n    }\n  }\n\n  this.getStatusCode = function () {\n    return _statusCode;\n  };\n\n  // returns the size of the bid creative. Concatenation of width and height by x.\n  this.getSize = function () {\n    return this.width + 'x' + this.height;\n  };\n}\n\n// Bid factory function.\nexports.createBid = function (statusCode, bidRequest) {\n  return new Bid(statusCode, bidRequest);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/bidfactory.js","module.exports = {\"JSON_MAPPING\":{\"PL_CODE\":\"code\",\"PL_SIZE\":\"sizes\",\"PL_BIDS\":\"bids\",\"BD_BIDDER\":\"bidder\",\"BD_ID\":\"paramsd\",\"BD_PL_ID\":\"placementId\",\"ADSERVER_TARGETING\":\"adserverTargeting\",\"BD_SETTING_STANDARD\":\"standard\"},\"REPO_AND_VERSION\":\"prebid_prebid_0.33.0-pre\",\"DEBUG_MODE\":\"pbjs_debug\",\"STATUS\":{\"GOOD\":1,\"NO_BID\":2},\"CB\":{\"TYPE\":{\"ALL_BIDS_BACK\":\"allRequestedBidsBack\",\"AD_UNIT_BIDS_BACK\":\"adUnitBidsBack\",\"BID_WON\":\"bidWon\",\"REQUEST_BIDS\":\"requestBids\"}},\"EVENTS\":{\"AUCTION_INIT\":\"auctionInit\",\"AUCTION_END\":\"auctionEnd\",\"BID_ADJUSTMENT\":\"bidAdjustment\",\"BID_TIMEOUT\":\"bidTimeout\",\"BID_REQUESTED\":\"bidRequested\",\"BID_RESPONSE\":\"bidResponse\",\"BID_WON\":\"bidWon\",\"SET_TARGETING\":\"setTargeting\",\"REQUEST_BIDS\":\"requestBids\",\"ADD_AD_UNITS\":\"addAdUnits\"},\"EVENT_ID_PATHS\":{\"bidWon\":\"adUnitCode\"},\"GRANULARITY_OPTIONS\":{\"LOW\":\"low\",\"MEDIUM\":\"medium\",\"HIGH\":\"high\",\"AUTO\":\"auto\",\"DENSE\":\"dense\",\"CUSTOM\":\"custom\"},\"TARGETING_KEYS\":[\"hb_bidder\",\"hb_adid\",\"hb_pb\",\"hb_size\",\"hb_deal\"],\"S2S\":{\"DEFAULT_ENDPOINT\":\"https://prebid.adnxs.com/pbs/v1/auction\",\"SRC\":\"s2s\",\"ADAPTER\":\"prebidServer\",\"SYNC_ENDPOINT\":\"https://prebid.adnxs.com/pbs/v1/cookie_sync\",\"SYNCED_BIDDERS_KEY\":\"pbjsSyncs\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/constants.json\n// module id = 4\n// module chunks = 110","var utils = require('./utils');\nlet _requestCache = {};\n\n// add a script tag to the page, used to add /jpt call to page\nexports.loadScript = function (tagSrc, callback, cacheRequest) {\n  // var noop = () => {};\n  //\n  // callback = callback || noop;\n  if (!tagSrc) {\n    utils.logError('Error attempting to request empty URL', 'adloader.js:loadScript');\n    return;\n  }\n\n  if (cacheRequest) {\n    if (_requestCache[tagSrc]) {\n      if (callback && typeof callback === 'function') {\n        if (_requestCache[tagSrc].loaded) {\n          // invokeCallbacks immediately\n          callback();\n        } else {\n          // queue the callback\n          _requestCache[tagSrc].callbacks.push(callback);\n        }\n      }\n    } else {\n      _requestCache[tagSrc] = {\n        loaded: false,\n        callbacks: []\n      };\n      if (callback && typeof callback === 'function') {\n        _requestCache[tagSrc].callbacks.push(callback);\n      }\n\n      requestResource(tagSrc, function () {\n        _requestCache[tagSrc].loaded = true;\n        try {\n          for (let i = 0; i < _requestCache[tagSrc].callbacks.length; i++) {\n            _requestCache[tagSrc].callbacks[i]();\n          }\n        } catch (e) {\n          utils.logError('Error executing callback', 'adloader.js:loadScript', e);\n        }\n      });\n    }\n  } else {\n    // trigger one time request\n    requestResource(tagSrc, callback);\n  }\n};\n\nfunction requestResource(tagSrc, callback) {\n  var jptScript = document.createElement('script');\n  jptScript.type = 'text/javascript';\n  jptScript.async = true;\n\n  // Execute a callback if necessary\n  if (callback && typeof callback === 'function') {\n    if (jptScript.readyState) {\n      jptScript.onreadystatechange = function () {\n        if (jptScript.readyState === 'loaded' || jptScript.readyState === 'complete') {\n          jptScript.onreadystatechange = null;\n          callback();\n        }\n      };\n    } else {\n      jptScript.onload = function () {\n        callback();\n      };\n    }\n  }\n\n  jptScript.src = tagSrc;\n\n  // add the new script tag to the page\n  var elToAppend = document.getElementsByTagName('head');\n  elToAppend = elToAppend.length ? elToAppend : document.getElementsByTagName('body');\n  if (elToAppend.length) {\n    elToAppend = elToAppend[0];\n    elToAppend.insertBefore(jptScript, elToAppend.firstChild);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/adloader.js","import {parse as parseURL, format as formatURL} from './url';\n\nvar utils = require('./utils');\n\nconst XHR_DONE = 4;\nlet _timeout = 3000;\n\n/**\n * Simple IE9+ and cross-browser ajax request function\n * Note: x-domain requests in IE9 do not support the use of cookies\n *\n * @param url string url\n * @param callback {object | function} callback\n * @param data mixed data\n * @param options object\n */\nexport function setAjaxTimeout(timeout) {\n  _timeout = timeout;\n}\n\nexport function ajax(url, callback, data, options = {}) {\n  try {\n    let x;\n    let useXDomainRequest = false;\n    let method = options.method || (data ? 'POST' : 'GET');\n\n    let callbacks = typeof callback === 'object' ? callback : {\n      success: function() {\n        utils.logMessage('xhr success');\n      },\n      error: function(e) {\n        utils.logError('xhr error', null, e);\n      }\n    };\n\n    if (typeof callback === 'function') {\n      callbacks.success = callback;\n    }\n\n    if (!window.XMLHttpRequest) {\n      useXDomainRequest = true;\n    } else {\n      x = new window.XMLHttpRequest();\n      if (x.responseType === undefined) {\n        useXDomainRequest = true;\n      }\n    }\n\n    if (useXDomainRequest) {\n      x = new window.XDomainRequest();\n      x.onload = function () {\n        callbacks.success(x.responseText, x);\n      };\n\n      // http://stackoverflow.com/questions/15786966/xdomainrequest-aborts-post-on-ie-9\n      x.onerror = function () {\n        callbacks.error('error', x);\n      };\n      x.ontimeout = function () {\n        callbacks.error('timeout', x);\n      };\n      x.onprogress = function() {\n        utils.logMessage('xhr onprogress');\n      };\n    } else {\n      x.onreadystatechange = function () {\n        if (x.readyState === XHR_DONE) {\n          let status = x.status;\n          if ((status >= 200 && status < 300) || status === 304) {\n            callbacks.success(x.responseText, x);\n          } else {\n            callbacks.error(x.statusText, x);\n          }\n        }\n      };\n    }\n\n    if (method === 'GET' && data) {\n      let urlInfo = parseURL(url, options);\n      Object.assign(urlInfo.search, data);\n      url = formatURL(urlInfo);\n    }\n\n    x.open(method, url);\n    // IE needs timoeut to be set after open - see #1410\n    x.timeout = _timeout;\n\n    if (!useXDomainRequest) {\n      if (options.withCredentials) {\n        x.withCredentials = true;\n      }\n      utils._each(options.customHeaders, (value, header) => {\n        x.setRequestHeader(header, value);\n      });\n      if (options.preflight) {\n        x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n      }\n      x.setRequestHeader('Content-Type', options.contentType || 'text/plain');\n    }\n    x.send(method === 'POST' && data);\n  } catch (error) {\n    utils.logError('xhr construction', error);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ajax.js","export default function Adapter(code) {\n  var bidderCode = code;\n\n  function setBidderCode(code) {\n    bidderCode = code;\n  }\n\n  function getBidderCode() {\n    return bidderCode;\n  }\n\n  function callBids() {\n  }\n\n  return {\n    callBids: callBids,\n    setBidderCode: setBidderCode,\n    getBidderCode: getBidderCode\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/adapter.js","/*\n * Module for getting and setting Prebid configuration.\n *\n * Prebid previously defined these properties directly on the global object:\n * pbjs.logging = true;\n *\n * Defining and access properties in this way is now deprecated, but these will\n * continue to work during a deprecation window.\n */\nimport { isValidPriceConfig } from './cpmBucketManager';\nconst utils = require('./utils');\n\nconst DEFAULT_DEBUG = false;\nconst DEFAULT_BIDDER_TIMEOUT = 3000;\nconst DEFAULT_PUBLISHER_DOMAIN = window.location.origin;\nconst DEFAULT_COOKIESYNC_DELAY = 100;\nconst DEFAULT_ENABLE_SEND_ALL_BIDS = false;\nconst DEFAULT_USERSYNC = {\n  syncEnabled: true,\n  pixelEnabled: true,\n  syncsPerBidder: 5,\n  syncDelay: 3000\n};\n\nconst GRANULARITY_OPTIONS = {\n  LOW: 'low',\n  MEDIUM: 'medium',\n  HIGH: 'high',\n  AUTO: 'auto',\n  DENSE: 'dense',\n  CUSTOM: 'custom'\n};\n\nconst ALL_TOPICS = '*';\n\n/**\n * @typedef {object} PrebidConfig\n *\n * @property {bool} usePrebidCache True if we should use prebid-cache to store video bids before adding\n *   bids to the auction, and false otherwise. **NOTE** This must be true if you want to use the\n *   dfpAdServerVideo module.\n */\n\nexport function newConfig() {\n  let listeners = [];\n\n  let config = {\n    // `debug` is equivalent to legacy `pbjs.logging` property\n    _debug: DEFAULT_DEBUG,\n    get debug() {\n      if (pbjs.logging || pbjs.logging === false) {\n        return pbjs.logging;\n      }\n      return this._debug;\n    },\n    set debug(val) {\n      this._debug = val;\n    },\n\n    // default timeout for all bids\n    _bidderTimeout: DEFAULT_BIDDER_TIMEOUT,\n    get bidderTimeout() {\n      return pbjs.bidderTimeout || this._bidderTimeout;\n    },\n    set bidderTimeout(val) {\n      this._bidderTimeout = val;\n    },\n\n    // domain where prebid is running for cross domain iframe communication\n    _publisherDomain: DEFAULT_PUBLISHER_DOMAIN,\n    get publisherDomain() {\n      return pbjs.publisherDomain || this._publisherDomain;\n    },\n    set publisherDomain(val) {\n      this._publisherDomain = val;\n    },\n\n    // delay to request cookie sync to stay out of critical path\n    _cookieSyncDelay: DEFAULT_COOKIESYNC_DELAY,\n    get cookieSyncDelay() {\n      return pbjs.cookieSyncDelay || this._cookieSyncDelay;\n    },\n    set cookieSyncDelay(val) {\n      this._cookieSyncDelay = val;\n    },\n\n    // calls existing function which may be moved after deprecation\n    _priceGranularity: GRANULARITY_OPTIONS.MEDIUM,\n    set priceGranularity(val) {\n      if (validatePriceGranularity(val)) {\n        if (typeof val === 'string') {\n          this._priceGranularity = (hasGranularity(val)) ? val : GRANULARITY_OPTIONS.MEDIUM;\n        } else if (typeof val === 'object') {\n          this._customPriceBucket = val;\n          this._priceGranularity = GRANULARITY_OPTIONS.CUSTOM;\n          utils.logMessage('Using custom price granularity');\n        }\n      }\n    },\n    get priceGranularity() {\n      return this._priceGranularity;\n    },\n\n    _customPriceBucket: {},\n    get customPriceBucket() {\n      return this._customPriceBucket;\n    },\n\n    _sendAllBids: DEFAULT_ENABLE_SEND_ALL_BIDS,\n    get enableSendAllBids() {\n      return this._sendAllBids;\n    },\n    set enableSendAllBids(val) {\n      this._sendAllBids = val;\n    },\n\n    // calls existing function which may be moved after deprecation\n    set bidderSequence(val) {\n      pbjs.setBidderSequence(val);\n    },\n\n    // calls existing function which may be moved after deprecation\n    set s2sConfig(val) {\n      pbjs.setS2SConfig(val);\n    },\n\n    // userSync defaults\n    userSync: DEFAULT_USERSYNC\n  };\n\n  function hasGranularity(val) {\n    return Object.keys(GRANULARITY_OPTIONS).find(option => val === GRANULARITY_OPTIONS[option]);\n  }\n\n  function validatePriceGranularity(val) {\n    if (!val) {\n      utils.logError('Prebid Error: no value passed to `setPriceGranularity()`');\n      return false;\n    }\n    if (typeof val === 'string') {\n      if (!hasGranularity(val)) {\n        utils.logWarn('Prebid Warning: setPriceGranularity was called with invalid setting, using `medium` as default.');\n      }\n    } else if (typeof val === 'object') {\n      if (!isValidPriceConfig(val)) {\n        utils.logError('Invalid custom price value passed to `setPriceGranularity()`');\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /*\n   * Returns configuration object if called without parameters,\n   * or single configuration property if given a string matching a configuration\n   * property name.  Allows deep access e.g. getConfig('currency.adServerCurrency')\n   *\n   * If called with callback parameter, or a string and a callback parameter,\n   * subscribes to configuration updates. See `subscribe` function for usage.\n   */\n  function getConfig(...args) {\n    if (args.length <= 1 && typeof args[0] !== 'function') {\n      const option = args[0];\n      return option ? utils.deepAccess(config, option) : config;\n    }\n\n    return subscribe(...args);\n  }\n\n  /*\n   * Sets configuration given an object containing key-value pairs and calls\n   * listeners that were added by the `subscribe` function\n   */\n  function setConfig(options) {\n    if (typeof options !== 'object') {\n      utils.logError('setConfig options must be an object');\n      return;\n    }\n\n    Object.assign(config, options);\n    callSubscribers(options);\n  }\n\n  /*\n   * Adds a function to a set of listeners that are invoked whenever `setConfig`\n   * is called. The subscribed function will be passed the options object that\n   * was used in the `setConfig` call. Topics can be subscribed to to only get\n   * updates when specific properties are updated by passing a topic string as\n   * the first parameter.\n   *\n   * Returns an `unsubscribe` function for removing the subscriber from the\n   * set of listeners\n   *\n   * Example use:\n   * // subscribe to all configuration changes\n   * subscribe((config) => console.log('config set:', config));\n   *\n   * // subscribe to only 'logging' changes\n   * subscribe('logging', (config) => console.log('logging set:', config));\n   *\n   * // unsubscribe\n   * const unsubscribe = subscribe(...);\n   * unsubscribe(); // no longer listening\n   */\n  function subscribe(topic, listener) {\n    let callback = listener;\n\n    if (typeof topic !== 'string') {\n      // first param should be callback function in this case,\n      // meaning it gets called for any config change\n      callback = topic;\n      topic = ALL_TOPICS;\n    }\n\n    if (typeof callback !== 'function') {\n      utils.logError('listener must be a function');\n      return;\n    }\n\n    listeners.push({ topic, callback });\n\n    // save and call this function to remove the listener\n    return function unsubscribe() {\n      listeners.splice(listeners.indexOf(listener), 1);\n    };\n  }\n\n  /*\n   * Calls listeners that were added by the `subscribe` function\n   */\n  function callSubscribers(options) {\n    const TOPICS = Object.keys(options);\n\n    // call subscribers of a specific topic, passing only that configuration\n    listeners\n      .filter(listener => TOPICS.includes(listener.topic))\n      .forEach(listener => {\n        listener.callback({ [listener.topic]: options[listener.topic] });\n      });\n\n    // call subscribers that didn't give a topic, passing everything that was set\n    listeners\n      .filter(listener => listener.topic === ALL_TOPICS)\n      .forEach(listener => listener.callback(options));\n  }\n\n  return {\n    getConfig,\n    setConfig\n  };\n}\n\nexport const config = newConfig();\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","import Adapter from 'src/adapter';\nimport adaptermanager from 'src/adaptermanager';\nimport { config } from 'src/config';\nimport { ajax } from 'src/ajax';\nimport bidmanager from 'src/bidmanager';\nimport bidfactory from 'src/bidfactory';\nimport { STATUS } from 'src/constants';\nimport { userSync } from 'src/userSync';\n\nimport { logWarn, logError, parseQueryStringParameters, delayExecution } from 'src/utils';\n\n/**\n * This file aims to support Adapters during the Prebid 0.x -> 1.x transition.\n *\n * Prebid 1.x and Prebid 0.x will be in separate branches--perhaps for a long time.\n * This function defines an API for adapter construction which is compatible with both versions.\n * Adapters which use it can maintain their code in master, and only this file will need to change\n * in the 1.x branch.\n *\n * Typical usage looks something like:\n *\n * const adapter = registerBidder({\n *   code: 'myBidderCode',\n *   aliases: ['alias1', 'alias2'],\n *   supportedMediaTypes: ['video', 'native'],\n *   isBidRequestValid: function(paramsObject) { return true/false },\n *   buildRequests: function(bidRequests, bidderRequest) { return some ServerRequest(s) },\n *   interpretResponse: function(oneServerResponse) { return some Bids, or throw an error. }\n * });\n *\n * @see BidderSpec for the full API and more thorough descriptions.\n */\n\n/**\n * @typedef {object} BidderSpec An object containing the adapter-specific functions needed to\n * make a Bidder.\n *\n * @property {string} code A code which will be used to uniquely identify this bidder. This should be the same\n *   one as is used in the call to registerBidAdapter\n * @property {string[]} [aliases] A list of aliases which should also resolve to this bidder.\n * @property {MediaType[]} [supportedMediaTypes]: A list of Media Types which the adapter supports.\n * @property {function(object): boolean} isBidRequestValid Determines whether or not the given bid has all the params\n *   needed to make a valid request.\n * @property {function(BidRequest[], bidderRequest): ServerRequest|ServerRequest[]} buildRequests Build the request to the Server\n *   which requests Bids for the given array of Requests. Each BidRequest in the argument array is guaranteed to have\n *   passed the isBidRequestValid() test.\n * @property {function(ServerResponse, BidRequest): Bid[]} interpretResponse Given a successful response from the Server,\n *   interpret it and return the Bid objects. This function will be run inside a try/catch.\n *   If it throws any errors, your bids will be discarded.\n * @property {function(SyncOptions, ServerResponse[]): UserSync[]} [getUserSyncs] Given an array of all the responses\n *   from the server, determine which user syncs should occur. The argument array will contain every element\n *   which has been sent through to interpretResponse. The order of syncs in this array matters. The most\n *   important ones should come first, since publishers may limit how many are dropped on their page.\n */\n\n/**\n * @typedef {object} BidRequest\n *\n * @property {string} bidId A string which uniquely identifies this BidRequest in the current Auction.\n * @property {object} params Any bidder-specific params which the publisher used in their bid request.\n */\n\n/**\n * @typedef {object} ServerRequest\n *\n * @property {('GET'|'POST')} method The type of request which this is.\n * @property {string} url The endpoint for the request. For example, \"//bids.example.com\".\n * @property {string|object} data Data to be sent in the request.\n * @property {object} options Content-Type set in the header of the bid request, overrides default 'text/plain'.\n *   If this is a GET request, they'll become query params. If it's a POST request, they'll be added to the body.\n *   Strings will be added as-is. Objects will be unpacked into query params based on key/value mappings, or\n *   JSON-serialized into the Request body.\n */\n\n/**\n * @typedef {object} ServerResponse\n *\n * @property {*} body The response body. If this is legal JSON, then it will be parsed. Otherwise it'll be a\n *   string with the body's content.\n * @property {{get: function(string): string} headers The response headers.\n *   Call this like `ServerResponse.headers.get(\"Content-Type\")`\n */\n\n/**\n * @typedef {object} Bid\n *\n * @property {string} requestId The specific BidRequest which this bid is aimed at.\n *   This should match the BidRequest.bidId which this Bid targets.\n * @property {string} ad A URL which can be used to load this ad, if it's chosen by the publisher.\n * @property {string} currency The currency code for the cpm value\n * @property {number} cpm The bid price, in US cents per thousand impressions.\n * @property {number} ttl Time-to-live - how long (in seconds) Prebid can use this bid.\n * @property {boolean} netRevenue Boolean defining whether the bid is Net or Gross.  The default is true (Net).\n * @property {number} height The height of the ad, in pixels.\n * @property {number} width The width of the ad, in pixels.\n *\n * @property [Renderer] renderer A Renderer which can be used as a default for this bid,\n *   if the publisher doesn't override it. This is only relevant for Outstream Video bids.\n */\n\n/**\n * @typedef {Object} SyncOptions\n *\n * An object containing information about usersyncs which the adapter should obey.\n *\n * @property {boolean} iframeEnabled True if iframe usersyncs are allowed, and false otherwise\n * @property {boolean} pixelEnabled True if image usersyncs are allowed, and false otherwise\n */\n\n/**\n * TODO: Move this to the UserSync module after that PR is merged.\n *\n * @typedef {object} UserSync\n *\n * @property {('image'|'iframe')} type The type of user sync to be done.\n * @property {string} url The URL which makes the sync happen.\n */\n\n// common params for all mediaTypes\nconst COMMON_BID_RESPONSE_KEYS = ['requestId', 'cpm', 'ttl', 'creativeId', 'netRevenue', 'currency'];\n\n/**\n * Register a bidder with prebid, using the given spec.\n *\n * If possible, Adapter modules should use this function instead of adaptermanager.registerBidAdapter().\n *\n * @param {BidderSpec} spec An object containing the bare-bones functions we need to make a Bidder.\n */\nexport function registerBidder(spec) {\n  const mediaTypes = Array.isArray(spec.supportedMediaTypes)\n    ? { supportedMediaTypes: spec.supportedMediaTypes }\n    : undefined;\n  function putBidder(spec) {\n    const bidder = newBidder(spec);\n    adaptermanager.registerBidAdapter(bidder, spec.code, mediaTypes);\n  }\n\n  putBidder(spec);\n  if (Array.isArray(spec.aliases)) {\n    spec.aliases.forEach(alias => {\n      putBidder(Object.assign({}, spec, { code: alias }));\n    });\n  }\n}\n\n/**\n * Make a new bidder from the given spec. This is exported mainly for testing.\n * Adapters will probably find it more convenient to use registerBidder instead.\n *\n * @param {BidderSpec} spec\n */\nexport function newBidder(spec) {\n  return Object.assign(new Adapter(spec.code), {\n    getSpec: function() {\n      return Object.freeze(spec);\n    },\n    registerSyncs,\n    callBids: function(bidderRequest) {\n      if (!Array.isArray(bidderRequest.bids)) {\n        return;\n      }\n\n      // callBids must add a NO_BID response for _every_ AdUnit code, in order for the auction to\n      // end properly. This map stores placement codes which we've made _real_ bids on.\n      //\n      // As we add _real_ bids to the bidmanager, we'll log the ad unit codes here too. Once all the real\n      // bids have been added, fillNoBids() can be called to add NO_BID bids for any extra ad units, which\n      // will end the auction.\n      //\n      // In Prebid 1.0, this will be simplified to use the `addBidResponse` and `done` callbacks.\n      const adUnitCodesHandled = {};\n      function addBidWithCode(adUnitCode, bid) {\n        adUnitCodesHandled[adUnitCode] = true;\n        addBid(adUnitCode, bid);\n      }\n      function fillNoBids() {\n        bidderRequest.bids\n          .map(bidRequest => bidRequest.placementCode)\n          .forEach(adUnitCode => {\n            if (adUnitCode && !adUnitCodesHandled[adUnitCode]) {\n              addBid(adUnitCode, newEmptyBid());\n            }\n          });\n      }\n\n      function addBid(code, bid) {\n        try {\n          bidmanager.addBidResponse(code, bid);\n        } catch (err) {\n          logError('Error adding bid', code, err);\n        }\n      }\n\n      // After all the responses have come back, fill up the \"no bid\" bids and\n      // register any required usersync pixels.\n      const responses = [];\n      function afterAllResponses() {\n        fillNoBids();\n        registerSyncs(responses);\n      }\n\n      const validBidRequests = bidderRequest.bids.filter(filterAndWarn);\n      if (validBidRequests.length === 0) {\n        afterAllResponses();\n        return;\n      }\n      const bidRequestMap = {};\n      validBidRequests.forEach(bid => {\n        bidRequestMap[bid.bidId] = bid;\n        // Delete this once we are 1.0\n        if (!bid.adUnitCode) {\n          bid.adUnitCode = bid.placementCode\n        }\n      });\n\n      let requests = spec.buildRequests(validBidRequests, bidderRequest);\n      if (!requests || requests.length === 0) {\n        afterAllResponses();\n        return;\n      }\n      if (!Array.isArray(requests)) {\n        requests = [requests];\n      }\n\n      // Callbacks don't compose as nicely as Promises. We should call fillNoBids() once _all_ the\n      // Server requests have returned and been processed. Since `ajax` accepts a single callback,\n      // we need to rig up a function which only executes after all the requests have been responded.\n      const onResponse = delayExecution(afterAllResponses, requests.length)\n      requests.forEach(processRequest);\n\n      function processRequest(request) {\n        switch (request.method) {\n          case 'GET':\n            ajax(\n              `${request.url}?${typeof request.data === 'object' ? parseQueryStringParameters(request.data) : request.data}`,\n              {\n                success: onSuccess,\n                error: onFailure\n              },\n              undefined,\n              Object.assign({\n                method: 'GET',\n                withCredentials: true\n              }, request.options)\n            );\n            break;\n          case 'POST':\n            ajax(\n              request.url,\n              {\n                success: onSuccess,\n                error: onFailure\n              },\n              typeof request.data === 'string' ? request.data : JSON.stringify(request.data),\n              Object.assign({\n                method: 'POST',\n                contentType: 'text/plain',\n                withCredentials: true\n              }, request.options)\n            );\n            break;\n          default:\n            logWarn(`Skipping invalid request from ${spec.code}. Request type ${request.type} must be GET or POST`);\n            onResponse();\n        }\n\n        // If the server responds successfully, use the adapter code to unpack the Bids from it.\n        // If the adapter code fails, no bids should be added. After all the bids have been added, make\n        // sure to call the `onResponse` function so that we're one step closer to calling fillNoBids().\n        function onSuccess(response, responseObj) {\n          try {\n            response = JSON.parse(response);\n          } catch (e) { /* response might not be JSON... that's ok. */ }\n\n          // Make response headers available for #1742. These are lazy-loaded because most adapters won't need them.\n          response = {\n            body: response,\n            headers: headerParser(responseObj)\n          };\n          responses.push(response);\n\n          let bids;\n          try {\n            bids = spec.interpretResponse(response, request);\n          } catch (err) {\n            logError(`Bidder ${spec.code} failed to interpret the server's response. Continuing without bids`, null, err);\n            onResponse();\n            return;\n          }\n\n          if (bids) {\n            if (bids.forEach) {\n              bids.forEach(addBidUsingRequestMap);\n            } else {\n              addBidUsingRequestMap(bids);\n            }\n          }\n          onResponse();\n\n          function addBidUsingRequestMap(bid) {\n            // In Prebid 1.0 all the validation logic from bidmanager will move here, as of now we are only validating new params so that adapters dont miss adding them.\n            if (hasValidKeys(bid)) {\n              const bidRequest = bidRequestMap[bid.requestId];\n              if (bidRequest) {\n                const prebidBid = Object.assign(bidfactory.createBid(STATUS.GOOD, bidRequest), bid);\n                addBidWithCode(bidRequest.placementCode, prebidBid);\n              } else {\n                logWarn(`Bidder ${spec.code} made bid for unknown request ID: ${bid.requestId}. Ignoring.`);\n              }\n            } else {\n              logError(`Bidder ${spec.code} is missing required params. Check http://prebid.org/dev-docs/bidder-adapter-1.html for list of params.`);\n            }\n          }\n\n          function headerParser(xmlHttpResponse) {\n            return {\n              get: responseObj.getResponseHeader.bind(responseObj)\n            };\n          }\n        }\n\n        // If the server responds with an error, there's not much we can do. Log it, and make sure to\n        // call onResponse() so that we're one step closer to calling fillNoBids().\n        function onFailure(err) {\n          logError(`Server call for ${spec.code} failed: ${err}. Continuing without bids.`);\n          onResponse();\n        }\n      }\n    }\n  });\n\n  function registerSyncs(responses) {\n    if (spec.getUserSyncs) {\n      let syncs = spec.getUserSyncs({\n        iframeEnabled: config.getConfig('userSync.iframeEnabled'),\n        pixelEnabled: config.getConfig('userSync.pixelEnabled'),\n      }, responses);\n      if (syncs) {\n        if (!Array.isArray(syncs)) {\n          syncs = [syncs];\n        }\n        syncs.forEach((sync) => {\n          userSync.registerSync(sync.type, spec.code, sync.url)\n        });\n      }\n    }\n  }\n\n  function filterAndWarn(bid) {\n    if (!spec.isBidRequestValid(bid)) {\n      logWarn(`Invalid bid sent to bidder ${spec.code}: ${JSON.stringify(bid)}`);\n      return false;\n    }\n    return true;\n  }\n\n  function hasValidKeys(bid) {\n    let bidKeys = Object.keys(bid);\n    return COMMON_BID_RESPONSE_KEYS.every(key => bidKeys.includes(key));\n  }\n\n  function newEmptyBid() {\n    const bid = bidfactory.createBid(STATUS.NO_BID);\n    bid.code = spec.code;\n    bid.bidderCode = spec.code;\n    return bid;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/adapters/bidderFactory.js","/**\n * events.js\n */\nvar utils = require('./utils');\nvar CONSTANTS = require('./constants');\nvar slice = Array.prototype.slice;\nvar push = Array.prototype.push;\n\n// define entire events\n// var allEvents = ['bidRequested','bidResponse','bidWon','bidTimeout'];\nvar allEvents = utils._map(CONSTANTS.EVENTS, function (v) {\n  return v;\n});\n\nvar idPaths = CONSTANTS.EVENT_ID_PATHS;\n\n// keep a record of all events fired\nvar eventsFired = [];\n\nmodule.exports = (function () {\n  var _handlers = {};\n  var _public = {};\n\n  /**\n   *\n   * @param {String} eventString  The name of the event.\n   * @param {Array} args  The payload emitted with the event.\n   * @private\n   */\n  function _dispatch(eventString, args) {\n    utils.logMessage('Emitting event for: ' + eventString);\n\n    var eventPayload = args[0] || {};\n    var idPath = idPaths[eventString];\n    var key = eventPayload[idPath];\n    var event = _handlers[eventString] || { que: [] };\n    var eventKeys = utils._map(event, function (v, k) {\n      return k;\n    });\n\n    var callbacks = [];\n\n    // record the event:\n    eventsFired.push({\n      eventType: eventString,\n      args: eventPayload,\n      id: key\n    });\n\n    /** Push each specific callback to the `callbacks` array.\n     * If the `event` map has a key that matches the value of the\n     * event payload id path, e.g. `eventPayload[idPath]`, then apply\n     * each function in the `que` array as an argument to push to the\n     * `callbacks` array\n     * */\n    if (key && utils.contains(eventKeys, key)) {\n      push.apply(callbacks, event[key].que);\n    }\n\n    /** Push each general callback to the `callbacks` array. */\n    push.apply(callbacks, event.que);\n\n    /** call each of the callbacks */\n    utils._each(callbacks, function (fn) {\n      if (!fn) return;\n      try {\n        fn.apply(null, args);\n      } catch (e) {\n        utils.logError('Error executing handler:', 'events.js', e);\n      }\n    });\n  }\n\n  function _checkAvailableEvent(event) {\n    return utils.contains(allEvents, event);\n  }\n\n  _public.on = function (eventString, handler, id) {\n    // check whether available event or not\n    if (_checkAvailableEvent(eventString)) {\n      var event = _handlers[eventString] || { que: [] };\n\n      if (id) {\n        event[id] = event[id] || { que: [] };\n        event[id].que.push(handler);\n      } else {\n        event.que.push(handler);\n      }\n\n      _handlers[eventString] = event;\n    } else {\n      utils.logError('Wrong event name : ' + eventString + ' Valid event names :' + allEvents);\n    }\n  };\n\n  _public.emit = function (event) {\n    var args = slice.call(arguments, 1);\n    _dispatch(event, args);\n  };\n\n  _public.off = function (eventString, handler, id) {\n    var event = _handlers[eventString];\n\n    if (utils.isEmpty(event) || (utils.isEmpty(event.que) && utils.isEmpty(event[id]))) {\n      return;\n    }\n\n    if (id && (utils.isEmpty(event[id]) || utils.isEmpty(event[id].que))) {\n      return;\n    }\n\n    if (id) {\n      utils._each(event[id].que, function (_handler) {\n        var que = event[id].que;\n        if (_handler === handler) {\n          que.splice(utils.indexOf.call(que, _handler), 1);\n        }\n      });\n    } else {\n      utils._each(event.que, function (_handler) {\n        var que = event.que;\n        if (_handler === handler) {\n          que.splice(utils.indexOf.call(que, _handler), 1);\n        }\n      });\n    }\n\n    _handlers[eventString] = event;\n  };\n\n  _public.get = function () {\n    return _handlers;\n  };\n\n  /**\n   * This method can return a copy of all the events fired\n   * @return {Array} array of events fired\n   */\n  _public.getEvents = function () {\n    var arrayCopy = [];\n    utils._each(eventsFired, function (value) {\n      var newProp = Object.assign({}, value);\n      arrayCopy.push(newProp);\n    });\n\n    return arrayCopy;\n  };\n\n  return _public;\n}());\n\n\n\n// WEBPACK FOOTER //\n// ./src/events.js","export function parseQS(query) {\n  return !query ? {} : query\n    .replace(/^\\?/, '')\n    .split('&')\n    .reduce((acc, criteria) => {\n      let [k, v] = criteria.split('=');\n      if (/\\[\\]$/.test(k)) {\n        k = k.replace('[]', '');\n        acc[k] = acc[k] || [];\n        acc[k].push(v);\n      } else {\n        acc[k] = v || '';\n      }\n      return acc;\n    }, {});\n}\n\nexport function formatQS(query) {\n  return Object\n    .keys(query)\n    .map(k => Array.isArray(query[k])\n      ? query[k].map(v => `${k}[]=${v}`).join('&')\n      : `${k}=${query[k]}`)\n    .join('&');\n}\n\nexport function parse(url, options) {\n  let parsed = document.createElement('a');\n  if (options && 'noDecodeWholeURL' in options && options.noDecodeWholeURL) {\n    parsed.href = url;\n  } else {\n    parsed.href = decodeURIComponent(url);\n  }\n  return {\n    protocol: (parsed.protocol || '').replace(/:$/, ''),\n    hostname: parsed.hostname,\n    port: +parsed.port,\n    pathname: parsed.pathname.replace(/^(?!\\/)/, '/'),\n    search: parseQS(parsed.search || ''),\n    hash: (parsed.hash || '').replace(/^#/, ''),\n    host: parsed.host || window.location.host\n  };\n}\n\nexport function format(obj) {\n  return (obj.protocol || 'http') + '://' +\n         (obj.host ||\n          obj.hostname + (obj.port ? `:${obj.port}` : '')) +\n         (obj.pathname || '') +\n         (obj.search ? `?${formatQS(obj.search || '')}` : '') +\n         (obj.hash ? `#${obj.hash}` : '');\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/url.js","/**\n * This file contains the valid Media Types in Prebid.\n *\n * All adapters are assumed to support banner ads. Other media types are specified by Adapters when they\n * register themselves with prebid-core.\n */\n\n/**\n * @typedef {('native'|'video'|'banner')} MediaType\n */\n\n/** @type MediaType */\nexport const NATIVE = 'native';\n/** @type MediaType */\nexport const VIDEO = 'video';\n/** @type MediaType */\nexport const BANNER = 'banner';\n\n\n\n// WEBPACK FOOTER //\n// ./src/mediaTypes.js","var core = module.exports = { version: '2.5.1' };\nif (typeof __e == 'number') __e = core; // eslint-disable-line no-undef\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_core.js\n// module id = 14\n// module chunks = 110","import { deepAccess, getBidRequest, logError, triggerPixel } from './utils';\n\nexport const nativeAdapters = [];\n\nexport const NATIVE_KEYS = {\n  title: 'hb_native_title',\n  body: 'hb_native_body',\n  sponsoredBy: 'hb_native_brand',\n  image: 'hb_native_image',\n  icon: 'hb_native_icon',\n  clickUrl: 'hb_native_linkurl',\n  cta: 'hb_native_cta',\n};\n\nexport const NATIVE_TARGETING_KEYS = Object.keys(NATIVE_KEYS).map(\n  key => NATIVE_KEYS[key]\n);\n\nconst IMAGE = {\n  image: { required: true },\n  title: { required: true },\n  sponsoredBy: { required: true },\n  clickUrl: { required: true },\n  body: { required: false },\n  icon: { required: false },\n};\n\nconst SUPPORTED_TYPES = {\n  image: IMAGE\n};\n\n/**\n * Recieves nativeParams from an adUnit. If the params were not of type 'type',\n * passes them on directly. If they were of type 'type', translate\n * them into the predefined specific asset requests for that type of native ad.\n */\nexport function processNativeAdUnitParams(params) {\n  if (params && params.type && typeIsSupported(params.type)) {\n    return SUPPORTED_TYPES[params.type];\n  }\n\n  return params;\n}\n\n/**\n * Check if the native type specified in the adUnit is supported by Prebid.\n */\nfunction typeIsSupported(type) {\n  if (!(type && Object.keys(SUPPORTED_TYPES).includes(type))) {\n    logError(`${type} nativeParam is not supported`);\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Helper functions for working with native-enabled adUnits\n * TODO: abstract this and the video helper functions into general\n * adunit validation helper functions\n */\nexport const nativeAdUnit = adUnit => {\n  const mediaType = adUnit.mediaType === 'native';\n  const mediaTypes = deepAccess(adUnit, 'mediaTypes.native');\n  return mediaType || mediaTypes;\n}\nexport const nativeBidder = bid => nativeAdapters.includes(bid.bidder);\nexport const hasNonNativeBidder = adUnit =>\n  adUnit.bids.filter(bid => !nativeBidder(bid)).length;\n\n/*\n * Validate that the native assets on this bid contain all assets that were\n * marked as required in the adUnit configuration.\n */\nexport function nativeBidIsValid(bid) {\n  const bidRequest = getBidRequest(bid.adId);\n  if (!bidRequest) {\n    return false;\n  }\n\n  // all native bid responses must define a landing page url\n  if (!deepAccess(bid, 'native.clickUrl')) {\n    return false;\n  }\n\n  const requestedAssets = bidRequest.nativeParams;\n  if (!requestedAssets) {\n    return true;\n  }\n\n  const requiredAssets = Object.keys(requestedAssets).filter(\n    key => requestedAssets[key].required\n  );\n  const returnedAssets = Object.keys(bid['native']).filter(\n    key => bid['native'][key]\n  );\n\n  return requiredAssets.every(asset => returnedAssets.includes(asset));\n}\n\n/*\n * Native responses may have associated impression or click trackers.\n * This retrieves the appropriate tracker urls for the given ad object and\n * fires them. As a native creatives may be in a cross-origin frame, it may be\n * necessary to invoke this function via postMessage. secureCreatives is\n * configured to fire this function when it receives a `message` of 'Prebid Native'\n * and an `adId` with the value of the `bid.adId`. When a message is posted with\n * these parameters, impression trackers are fired. To fire click trackers, the\n * message should contain an `action` set to 'click'.\n *\n * // Native creative template example usage\n * <a href=\"%%CLICK_URL_UNESC%%%%PATTERN:hb_native_linkurl%%\"\n *    target=\"_blank\"\n *    onclick=\"fireTrackers('click')\">\n *    %%PATTERN:hb_native_title%%\n * </a>\n *\n * <script>\n *   function fireTrackers(action) {\n *     var message = {message: 'Prebid Native', adId: '%%PATTERN:hb_adid%%'};\n *     if (action === 'click') {message.action = 'click';} // fires click trackers\n *     window.parent.postMessage(JSON.stringify(message), '*');\n *   }\n *   fireTrackers(); // fires impressions when creative is loaded\n * </script>\n */\nexport function fireNativeTrackers(message, adObject) {\n  let trackers;\n\n  if (message.action === 'click') {\n    trackers = adObject['native'] && adObject['native'].clickTrackers;\n  } else {\n    trackers = adObject['native'] && adObject['native'].impressionTrackers;\n  }\n\n  (trackers || []).forEach(triggerPixel);\n}\n\n/**\n * Gets native targeting key-value paris\n * @param {Object} bid\n * @return {Object} targeting\n */\nexport function getNativeTargeting(bid) {\n  let keyValues = {};\n\n  Object.keys(bid['native']).forEach(asset => {\n    const key = NATIVE_KEYS[asset];\n    const value = bid['native'][asset];\n    if (key) {\n      keyValues[key] = value;\n    }\n  });\n\n  return keyValues;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/native.js","// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nvar global = module.exports = typeof window != 'undefined' && window.Math == Math\n  ? window : typeof self != 'undefined' && self.Math == Math ? self\n  // eslint-disable-next-line no-new-func\n  : Function('return this')();\nif (typeof __g == 'number') __g = global; // eslint-disable-line no-undef\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_global.js\n// module id = 16\n// module chunks = 110","var global = require('./_global');\nvar core = require('./_core');\nvar hide = require('./_hide');\nvar redefine = require('./_redefine');\nvar ctx = require('./_ctx');\nvar PROTOTYPE = 'prototype';\n\nvar $export = function (type, name, source) {\n  var IS_FORCED = type & $export.F;\n  var IS_GLOBAL = type & $export.G;\n  var IS_STATIC = type & $export.S;\n  var IS_PROTO = type & $export.P;\n  var IS_BIND = type & $export.B;\n  var target = IS_GLOBAL ? global : IS_STATIC ? global[name] || (global[name] = {}) : (global[name] || {})[PROTOTYPE];\n  var exports = IS_GLOBAL ? core : core[name] || (core[name] = {});\n  var expProto = exports[PROTOTYPE] || (exports[PROTOTYPE] = {});\n  var key, own, out, exp;\n  if (IS_GLOBAL) source = name;\n  for (key in source) {\n    // contains in native\n    own = !IS_FORCED && target && target[key] !== undefined;\n    // export native or passed\n    out = (own ? target : source)[key];\n    // bind timers to global for call from export context\n    exp = IS_BIND && own ? ctx(out, global) : IS_PROTO && typeof out == 'function' ? ctx(Function.call, out) : out;\n    // extend global\n    if (target) redefine(target, key, out, type & $export.U);\n    // export\n    if (exports[key] != out) hide(exports, key, exp);\n    if (IS_PROTO && expProto[key] != out) expProto[key] = out;\n  }\n};\nglobal.core = core;\n// type bitmap\n$export.F = 1;   // forced\n$export.G = 2;   // global\n$export.S = 4;   // static\n$export.P = 8;   // proto\n$export.B = 16;  // bind\n$export.W = 32;  // wrap\n$export.U = 64;  // safe\n$export.R = 128; // real proto method for `library`\nmodule.exports = $export;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_export.js\n// module id = 17\n// module chunks = 110","module.exports = function (it) {\n  return typeof it === 'object' ? it !== null : typeof it === 'function';\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_is-object.js\n// module id = 18\n// module chunks = 110","import * as utils from 'src/utils';\nimport { config } from 'src/config';\n\n/**\n * Factory function which creates a new UserSyncPool.\n *\n * @param {UserSyncDependencies} userSyncDependencies Configuration options and dependencies which the\n *   UserSync object needs in order to behave properly.\n */\nexport function newUserSync(userSyncDependencies) {\n  let publicApi = {};\n  // A queue of user syncs for each adapter\n  // Let getDefaultQueue() set the defaults\n  let queue = getDefaultQueue();\n\n  // Whether or not user syncs have been trigger on this page load\n  let hasFired = false;\n  // How many bids for each adapter\n  let numAdapterBids = {};\n\n  // Use what is in config by default\n  let usConfig = userSyncDependencies.config;\n  // Update if it's (re)set\n  config.getConfig('userSync', (conf) => {\n    usConfig = Object.assign(usConfig, conf.userSync);\n  });\n\n  /**\n   * @function getDefaultQueue\n   * @summary Returns the default empty queue\n   * @private\n   * @return {object} A queue with no syncs\n   */\n  function getDefaultQueue() {\n    return {\n      image: [],\n      iframe: []\n    };\n  }\n\n  /**\n   * @function fireSyncs\n   * @summary Trigger all user syncs in the queue\n   * @private\n   */\n  function fireSyncs() {\n    if (!usConfig.syncEnabled || !userSyncDependencies.browserSupportsCookies || hasFired) {\n      return;\n    }\n\n    try {\n      // Image pixels\n      fireImagePixels();\n      // Iframe syncs\n      loadIframes();\n    } catch (e) {\n      return utils.logError('Error firing user syncs', e);\n    }\n    // Reset the user sync queue\n    queue = getDefaultQueue();\n    hasFired = true;\n  }\n\n  /**\n   * @function fireImagePixels\n   * @summary Loops through user sync pixels and fires each one\n   * @private\n   */\n  function fireImagePixels() {\n    if (!usConfig.pixelEnabled) {\n      return;\n    }\n    // Randomize the order of the pixels before firing\n    // This is to avoid giving any bidder who has registered multiple syncs\n    // any preferential treatment and balancing them out\n    utils.shuffle(queue.image).forEach((sync) => {\n      let [bidderName, trackingPixelUrl] = sync;\n      utils.logMessage(`Invoking image pixel user sync for bidder: ${bidderName}`);\n      // Create image object and add the src url\n      utils.triggerPixel(trackingPixelUrl);\n    });\n  }\n\n  /**\n   * @function loadIframes\n   * @summary Loops through iframe syncs and loads an iframe element into the page\n   * @private\n   */\n  function loadIframes() {\n    if (!usConfig.iframeEnabled) {\n      return;\n    }\n    // Randomize the order of these syncs just like the pixels above\n    utils.shuffle(queue.iframe).forEach((sync) => {\n      let [bidderName, iframeUrl] = sync;\n      utils.logMessage(`Invoking iframe user sync for bidder: ${bidderName}`);\n      // Insert iframe into DOM\n      utils.insertUserSyncIframe(iframeUrl);\n    });\n  }\n\n  /**\n   * @function incrementAdapterBids\n   * @summary Increment the count of user syncs queue for the adapter\n   * @private\n   * @params {object} numAdapterBids The object contain counts for all adapters\n   * @params {string} bidder The name of the bidder adding a sync\n   * @returns {object} The updated version of numAdapterBids\n   */\n  function incrementAdapterBids(numAdapterBids, bidder) {\n    if (!numAdapterBids[bidder]) {\n      numAdapterBids[bidder] = 1;\n    } else {\n      numAdapterBids[bidder] += 1;\n    }\n    return numAdapterBids;\n  }\n\n  /**\n   * @function registerSync\n   * @summary Add sync for this bidder to a queue to be fired later\n   * @public\n   * @params {string} type The type of the sync including image, iframe\n   * @params {string} bidder The name of the adapter. e.g. \"rubicon\"\n   * @params {string} url Either the pixel url or iframe url depending on the type\n\n   * @example <caption>Using Image Sync</caption>\n   * // registerSync(type, adapter, pixelUrl)\n   * userSync.registerSync('image', 'rubicon', 'http://example.com/pixel')\n   */\n  publicApi.registerSync = (type, bidder, url) => {\n    if (!usConfig.syncEnabled || !utils.isArray(queue[type])) {\n      return utils.logWarn(`User sync type \"${type}\" not supported`);\n    }\n    if (!bidder) {\n      return utils.logWarn(`Bidder is required for registering sync`);\n    }\n    if (Number(numAdapterBids[bidder]) >= usConfig.syncsPerBidder) {\n      return utils.logWarn(`Number of user syncs exceeded for \"{$bidder}\"`);\n    }\n    // All bidders are enabled by default. If specified only register for enabled bidders.\n    let hasEnabledBidders = usConfig.enabledBidders && usConfig.enabledBidders.length;\n    if (hasEnabledBidders && usConfig.enabledBidders.indexOf(bidder) < 0) {\n      return utils.logWarn(`Bidder \"${bidder}\" not supported`);\n    }\n    queue[type].push([bidder, url]);\n    numAdapterBids = incrementAdapterBids(numAdapterBids, bidder);\n  };\n\n  /**\n   * @function syncUsers\n   * @summary Trigger all the user syncs based on publisher-defined timeout\n   * @public\n   * @params {int} timeout The delay in ms before syncing data - default 0\n   */\n  publicApi.syncUsers = (timeout = 0) => {\n    if (timeout) {\n      return window.setTimeout(fireSyncs, Number(timeout));\n    }\n    fireSyncs();\n  };\n\n  /**\n   * @function triggerUserSyncs\n   * @summary A `syncUsers` wrapper for determining if enableOverride has been turned on\n   * @public\n   */\n  publicApi.triggerUserSyncs = () => {\n    if (usConfig.enableOverride) {\n      publicApi.syncUsers();\n    }\n  };\n\n  return publicApi;\n}\n\nconst browserSupportsCookies = !utils.isSafariBrowser() && utils.cookiesAreEnabled();\n\nexport const userSync = newUserSync({\n  config: config.getConfig('userSync'),\n  browserSupportsCookies: browserSupportsCookies\n});\n\n/**\n * @typedef {Object} UserSyncDependencies\n *\n * @property {UserSyncConfig} config\n * @property {boolean} browserSupportsCookies True if the current browser supports cookies, and false otherwise.\n */\n\n/**\n * @typedef {Object} UserSyncConfig\n *\n * @property {boolean} enableOverride\n * @property {boolean} syncEnabled\n * @property {boolean} pixelEnabled\n * @property {boolean} iframeEnabled\n * @property {int} syncsPerBidder\n * @property {string[]} enabledBidders\n */\n\n\n\n// WEBPACK FOOTER //\n// ./src/userSync.js","import { loadScript } from './adloader';\nimport * as utils from './utils';\n\n/**\n * @typedef {object} Renderer\n *\n * A Renderer stores some functions which are used to render a particular Bid.\n * These are used in Outstream Video Bids, returned on the Bid by the adapter, and will\n * be used to render that bid unless the Publisher overrides them.\n */\n\nexport function Renderer(options) {\n  const { url, config, id, callback, loaded } = options;\n  this.url = url;\n  this.config = config;\n  this.handlers = {};\n  this.id = id;\n\n  // a renderer may push to the command queue to delay rendering until the\n  // render function is loaded by loadScript, at which point the the command\n  // queue will be processed\n  this.loaded = loaded;\n  this.cmd = [];\n  this.push = func => {\n    if (typeof func !== 'function') {\n      utils.logError('Commands given to Renderer.push must be wrapped in a function');\n      return;\n    }\n    this.loaded ? func.call() : this.cmd.push(func);\n  };\n\n  // bidders may override this with the `callback` property given to `install`\n  this.callback = callback || (() => {\n    this.loaded = true;\n    this.process();\n  });\n\n  // we expect to load a renderer url once only so cache the request to load script\n  loadScript(url, this.callback, true);\n}\n\nRenderer.install = function({ url, config, id, callback, loaded }) {\n  return new Renderer({ url, config, id, callback, loaded });\n};\n\nRenderer.prototype.getConfig = function() {\n  return this.config;\n};\n\nRenderer.prototype.setRender = function(fn) {\n  this.render = fn;\n};\n\nRenderer.prototype.setEventHandlers = function(handlers) {\n  this.handlers = handlers;\n};\n\nRenderer.prototype.handleVideoEvent = function({ id, eventName }) {\n  if (typeof this.handlers[eventName] === 'function') {\n    this.handlers[eventName]();\n  }\n\n  utils.logMessage(`Prebid Renderer event for id ${id} type ${eventName}`);\n};\n\n/*\n * Calls functions that were pushed to the command queue before the\n * renderer was loaded by `loadScript`\n */\nRenderer.prototype.process = function() {\n  while (this.cmd.length > 0) {\n    try {\n      this.cmd.shift().call();\n    } catch (error) {\n      utils.logError('Error processing Renderer command: ', error);\n    }\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/Renderer.js","import { uniques, isGptPubadsDefined, getHighestCpm, adUnitsFilter, groupBy } from './utils';\nimport { config } from './config';\nimport { NATIVE_TARGETING_KEYS } from './native';\nconst bidmanager = require('./bidmanager');\nconst utils = require('./utils');\nvar CONSTANTS = require('./constants');\n\nvar targeting = exports;\nvar pbTargetingKeys = [];\n\ntargeting.resetPresetTargeting = function(adUnitCode) {\n  if (isGptPubadsDefined()) {\n    const adUnitCodes = getAdUnitCodes(adUnitCode);\n    const adUnits = pbjs.adUnits.filter(adUnit => adUnitCodes.includes(adUnit.code));\n    window.googletag.pubads().getSlots().forEach(slot => {\n      pbTargetingKeys.forEach(function(key) {\n        // reset only registered adunits\n        adUnits.forEach(function(unit) {\n          if (unit.code === slot.getAdUnitPath() ||\n              unit.code === slot.getSlotElementId()) {\n            slot.setTargeting(key, null);\n          }\n        });\n      });\n    });\n  }\n};\n\ntargeting.getAllTargeting = function(adUnitCode) {\n  const adUnitCodes = getAdUnitCodes(adUnitCode);\n\n  // Get targeting for the winning bid. Add targeting for any bids that have\n  // `alwaysUseBid=true`. If sending all bids is enabled, add targeting for losing bids.\n  var targeting = getWinningBidTargeting(adUnitCodes)\n    .concat(getAlwaysUseBidTargeting(adUnitCodes))\n    .concat(config.getConfig('enableSendAllBids') ? getBidLandscapeTargeting(adUnitCodes) : []);\n\n  // store a reference of the targeting keys\n  targeting.map(adUnitCode => {\n    Object.keys(adUnitCode).map(key => {\n      adUnitCode[key].map(targetKey => {\n        if (pbTargetingKeys.indexOf(Object.keys(targetKey)[0]) === -1) {\n          pbTargetingKeys = Object.keys(targetKey).concat(pbTargetingKeys);\n        }\n      });\n    });\n  });\n  return targeting;\n};\n\ntargeting.setTargeting = function(targetingConfig) {\n  window.googletag.pubads().getSlots().forEach(slot => {\n    targetingConfig.filter(targeting => Object.keys(targeting)[0] === slot.getAdUnitPath() ||\n      Object.keys(targeting)[0] === slot.getSlotElementId())\n      .forEach(targeting => targeting[Object.keys(targeting)[0]]\n        .forEach(key => {\n          key[Object.keys(key)[0]]\n            .map((value) => {\n              utils.logMessage(`Attempting to set key value for slot: ${slot.getSlotElementId()} key: ${Object.keys(key)[0]} value: ${value}`);\n              return value;\n            })\n            .forEach(value => {\n              slot.setTargeting(Object.keys(key)[0], value);\n            });\n        }));\n  });\n};\n\n/**\n * normlizes input to a `adUnit.code` array\n * @param  {(string|string[])} adUnitCode [description]\n * @return {string[]}     AdUnit code array\n */\nfunction getAdUnitCodes(adUnitCode) {\n  if (typeof adUnitCode === 'string') {\n    return [adUnitCode];\n  } else if (utils.isArray(adUnitCode)) {\n    return adUnitCode;\n  }\n  return pbjs._adUnitCodes || [];\n}\n\n/**\n * Returns top bids for a given adUnit or set of adUnits.\n * @param  {(string|string[])} adUnitCode adUnitCode or array of adUnitCodes\n * @return {[type]}            [description]\n */\ntargeting.getWinningBids = function(adUnitCode) {\n  const adUnitCodes = getAdUnitCodes(adUnitCode);\n\n  return pbjs._bidsReceived\n    .filter(bid => adUnitCodes.includes(bid.adUnitCode))\n    .filter(bid => bid.cpm > 0)\n    .map(bid => bid.adUnitCode)\n    .filter(uniques)\n    .map(adUnitCode => pbjs._bidsReceived\n      .filter(bid => bid.adUnitCode === adUnitCode ? bid : null)\n      .reduce(getHighestCpm, getEmptyBid(adUnitCode)));\n};\n\ntargeting.setTargetingForAst = function() {\n  let targeting = pbjs.getAdserverTargeting();\n  Object.keys(targeting).forEach(targetId =>\n    Object.keys(targeting[targetId]).forEach(key => {\n      utils.logMessage(`Attempting to set targeting for targetId: ${targetId} key: ${key} value: ${targeting[targetId][key]}`);\n      // setKeywords supports string and array as value\n      if (utils.isStr(targeting[targetId][key]) || utils.isArray(targeting[targetId][key])) {\n        let keywordsObj = {};\n        let input = 'hb_adid';\n        let nKey = (key.substring(0, input.length) === input) ? key.toUpperCase() : key;\n        keywordsObj[nKey] = targeting[targetId][key];\n        window.apntag.setKeywords(targetId, keywordsObj);\n      }\n    })\n  );\n};\n\nfunction getWinningBidTargeting(adUnitCodes) {\n  let winners = targeting.getWinningBids(adUnitCodes);\n  let standardKeys = getStandardKeys();\n\n  winners = winners.map(winner => {\n    return {\n      [winner.adUnitCode]: Object.keys(winner.adserverTargeting)\n        .filter(key =>\n          typeof winner.sendStandardTargeting === 'undefined' ||\n          winner.sendStandardTargeting ||\n          standardKeys.indexOf(key) === -1)\n        .map(key => ({ [key.substring(0, 20)]: [winner.adserverTargeting[key]] }))\n    };\n  });\n\n  return winners;\n}\n\nfunction getStandardKeys() {\n  return bidmanager.getStandardBidderAdServerTargeting() // in case using a custom standard key set\n    .map(targeting => targeting.key)\n    .concat(CONSTANTS.TARGETING_KEYS).filter(uniques); // standard keys defined in the library.\n}\n\n/**\n * Get custom targeting keys for bids that have `alwaysUseBid=true`.\n */\nfunction getAlwaysUseBidTargeting(adUnitCodes) {\n  let standardKeys = getStandardKeys();\n  return pbjs._bidsReceived\n    .filter(adUnitsFilter.bind(this, adUnitCodes))\n    .map(bid => {\n      if (bid.alwaysUseBid) {\n        return {\n          [bid.adUnitCode]: Object.keys(bid.adserverTargeting).map(key => {\n            // Get only the non-standard keys of the losing bids, since we\n            // don't want to override the standard keys of the winning bid.\n            if (standardKeys.indexOf(key) > -1) {\n              return;\n            }\n\n            return { [key.substring(0, 20)]: [bid.adserverTargeting[key]] };\n          }).filter(key => key) // remove empty elements\n        };\n      }\n    })\n    .filter(bid => bid); // removes empty elements in array;\n}\n\nfunction getBidLandscapeTargeting(adUnitCodes) {\n  const standardKeys = CONSTANTS.TARGETING_KEYS.concat(NATIVE_TARGETING_KEYS);\n  const bids = [];\n  // bucket by adUnitcode\n  let buckets = groupBy(pbjs._bidsReceived, 'adUnitCode');\n  // filter top bid for each bucket by bidder\n  Object.keys(buckets).forEach(bucketKey => {\n    let bidsByBidder = groupBy(buckets[bucketKey], 'bidderCode');\n    Object.keys(bidsByBidder).forEach(key => bids.push(bidsByBidder[key].reduce(getHighestCpm, getEmptyBid())));\n  });\n  // populate targeting keys for the remaining bids\n  return bids.map(bid => {\n    if (bid.adserverTargeting) {\n      return {\n        [bid.adUnitCode]: getTargetingMap(bid, standardKeys.filter(\n          key => typeof bid.adserverTargeting[key] !== 'undefined')\n        )\n      };\n    }\n  }).filter(bid => bid); // removes empty elements in array\n}\n\nfunction getTargetingMap(bid, keys) {\n  return keys.map(key => {\n    return {\n      [`${key}_${bid.bidderCode}`.substring(0, 20)]: [bid.adserverTargeting[key]]\n    };\n  });\n}\n\ntargeting.isApntagDefined = function() {\n  if (window.apntag && utils.isFn(window.apntag.setKeywords)) {\n    return true;\n  }\n};\n\nfunction getEmptyBid(adUnitCode) {\n  return {\n    adUnitCode: adUnitCode,\n    cpm: 0,\n    adserverTargeting: {},\n    timeToRespond: 0\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/targeting.js","var dP = require('./_object-dp');\nvar createDesc = require('./_property-desc');\nmodule.exports = require('./_descriptors') ? function (object, key, value) {\n  return dP.f(object, key, createDesc(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_hide.js\n// module id = 22\n// module chunks = 110","// Thank's IE8 for his funny defineProperty\nmodule.exports = !require('./_fails')(function () {\n  return Object.defineProperty({}, 'a', { get: function () { return 7; } }).a != 7;\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_descriptors.js\n// module id = 23\n// module chunks = 110","module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (e) {\n    return true;\n  }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_fails.js\n// module id = 24\n// module chunks = 110","var id = 0;\nvar px = Math.random();\nmodule.exports = function (key) {\n  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_uid.js\n// module id = 25\n// module chunks = 110","// fallback for non-array-like ES3 and non-enumerable old V8 strings\nvar cof = require('./_cof');\n// eslint-disable-next-line no-prototype-builtins\nmodule.exports = Object('z').propertyIsEnumerable(0) ? Object : function (it) {\n  return cof(it) == 'String' ? it.split('') : Object(it);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_iobject.js\n// module id = 26\n// module chunks = 110","// 22.1.3.31 Array.prototype[@@unscopables]\nvar UNSCOPABLES = require('./_wks')('unscopables');\nvar ArrayProto = Array.prototype;\nif (ArrayProto[UNSCOPABLES] == undefined) require('./_hide')(ArrayProto, UNSCOPABLES, {});\nmodule.exports = function (key) {\n  ArrayProto[UNSCOPABLES][key] = true;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_add-to-unscopables.js\n// module id = 27\n// module chunks = 110","const utils = require('src/utils');\n\nconst _defaultPrecision = 2;\nconst _lgPriceConfig = {\n  'buckets': [{\n    'min': 0,\n    'max': 5,\n    'increment': 0.5\n  }]\n};\nconst _mgPriceConfig = {\n  'buckets': [{\n    'min': 0,\n    'max': 20,\n    'increment': 0.1\n  }]\n};\nconst _hgPriceConfig = {\n  'buckets': [{\n    'min': 0,\n    'max': 20,\n    'increment': 0.01\n  }]\n};\nconst _densePriceConfig = {\n  'buckets': [{\n    'min': 0,\n    'max': 3,\n    'increment': 0.01\n  },\n  {\n    'min': 3,\n    'max': 8,\n    'increment': 0.05\n  },\n  {\n    'min': 8,\n    'max': 20,\n    'increment': 0.5\n  }]\n};\nconst _autoPriceConfig = {\n  'buckets': [{\n    'min': 0,\n    'max': 5,\n    'increment': 0.05\n  },\n  {\n    'min': 5,\n    'max': 10,\n    'increment': 0.1\n  },\n  {\n    'min': 10,\n    'max': 20,\n    'increment': 0.5\n  }]\n};\n\nfunction getPriceBucketString(cpm, customConfig, granularityMultiplier = 1) {\n  let cpmFloat = parseFloat(cpm);\n  if (isNaN(cpmFloat)) {\n    cpmFloat = '';\n  }\n\n  return {\n    low: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _lgPriceConfig, granularityMultiplier),\n    med: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _mgPriceConfig, granularityMultiplier),\n    high: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _hgPriceConfig, granularityMultiplier),\n    auto: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _autoPriceConfig, granularityMultiplier),\n    dense: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _densePriceConfig, granularityMultiplier),\n    custom: (cpmFloat === '') ? '' : getCpmStringValue(cpm, customConfig, granularityMultiplier)\n  };\n}\n\nfunction getCpmStringValue(cpm, config, granularityMultiplier) {\n  let cpmStr = '';\n  if (!isValidPriceConfig(config)) {\n    return cpmStr;\n  }\n  const cap = config.buckets.reduce((prev, curr) => {\n    if (prev.max > curr.max) {\n      return prev;\n    }\n    return curr;\n  }, {\n    'max': 0,\n  });\n  let bucket = config.buckets.find(bucket => {\n    if (cpm > cap.max * granularityMultiplier) {\n      // cpm exceeds cap, just return the cap.\n      let precision = bucket.precision;\n      if (typeof precision === 'undefined') {\n        precision = _defaultPrecision;\n      }\n      cpmStr = (bucket.max * granularityMultiplier).toFixed(precision);\n    } else if (cpm <= bucket.max * granularityMultiplier && cpm >= bucket.min * granularityMultiplier) {\n      return bucket;\n    }\n  });\n  if (bucket) {\n    cpmStr = getCpmTarget(cpm, bucket.increment, bucket.precision, granularityMultiplier);\n  }\n  return cpmStr;\n}\n\nfunction isValidPriceConfig(config) {\n  if (utils.isEmpty(config) || !config.buckets || !Array.isArray(config.buckets)) {\n    return false;\n  }\n  let isValid = true;\n  config.buckets.forEach(bucket => {\n    if (typeof bucket.min === 'undefined' || !bucket.max || !bucket.increment) {\n      isValid = false;\n    }\n  });\n  return isValid;\n}\n\nfunction getCpmTarget(cpm, increment, precision, granularityMultiplier) {\n  if (typeof precision === 'undefined') {\n    precision = _defaultPrecision;\n  }\n  let bucketSize = 1 / (increment * granularityMultiplier);\n  return (Math.floor(cpm * bucketSize) / bucketSize).toFixed(precision);\n}\n\nexport { getPriceBucketString, isValidPriceConfig };\n\n\n\n// WEBPACK FOOTER //\n// ./src/cpmBucketManager.js","import { videoAdapters } from './adaptermanager';\nimport { getBidRequest, deepAccess, logError } from './utils';\nimport { config } from '../src/config';\n\nconst VIDEO_MEDIA_TYPE = 'video';\nconst OUTSTREAM = 'outstream';\n\n/**\n * Helper functions for working with video-enabled adUnits\n */\nexport const videoAdUnit = adUnit => adUnit.mediaType === VIDEO_MEDIA_TYPE;\nconst nonVideoBidder = bid => !videoAdapters.includes(bid.bidder);\nexport const hasNonVideoBidder = adUnit =>\n  adUnit.bids.filter(nonVideoBidder).length;\n\n/**\n * @typedef {object} VideoBid\n * @property {string} adId id of the bid\n */\n\n/**\n * Validate that the assets required for video context are present on the bid\n * @param {VideoBid} bid video bid to validate\n * @return {boolean} If object is valid\n */\nexport function isValidVideoBid(bid) {\n  const bidRequest = getBidRequest(bid.adId);\n\n  const videoMediaType =\n    bidRequest && deepAccess(bidRequest, 'mediaTypes.video');\n  const context = videoMediaType && deepAccess(videoMediaType, 'context');\n\n  // if context not defined assume default 'instream' for video bids\n  // instream bids require a vast url or vast xml content\n  if (!bidRequest || (videoMediaType && context !== OUTSTREAM)) {\n    // xml-only video bids require prebid-cache to be enabled\n    if (!config.getConfig('usePrebidCache') && bid.vastXml && !bid.vastUrl) {\n      logError(`\n        This bid contains only vastXml and will not work when prebid-cache is disabled.\n        Try enabling prebid-cache with pbjs.setConfig({ usePrebidCache: true });\n      `);\n      return false;\n    }\n\n    return !!(bid.vastUrl || bid.vastXml);\n  }\n\n  // outstream bids require a renderer on the bid or pub-defined on adunit\n  if (context === OUTSTREAM) {\n    return !!(bid.renderer || bidRequest.renderer);\n  }\n\n  return true;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/video.js","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 30\n// module chunks = 110","// if pbjs already exists in global document scope, use it, if not, create the object\n// global defination should happen BEFORE imports to avoid global undefined errors.\nwindow.pbjs = (window.pbjs || {});\nwindow.pbjs.cmd = window.pbjs.cmd || [];\nwindow.pbjs.que = window.pbjs.que || [];\n\nexport function getGlobal() {\n  return window.pbjs;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/prebidGlobal.js","var hasOwnProperty = {}.hasOwnProperty;\nmodule.exports = function (it, key) {\n  return hasOwnProperty.call(it, key);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_has.js\n// module id = 32\n// module chunks = 110","// optional / simple context binding\nvar aFunction = require('./_a-function');\nmodule.exports = function (fn, that, length) {\n  aFunction(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_ctx.js\n// module id = 33\n// module chunks = 110","// 0 -> Array#forEach\n// 1 -> Array#map\n// 2 -> Array#filter\n// 3 -> Array#some\n// 4 -> Array#every\n// 5 -> Array#find\n// 6 -> Array#findIndex\nvar ctx = require('./_ctx');\nvar IObject = require('./_iobject');\nvar toObject = require('./_to-object');\nvar toLength = require('./_to-length');\nvar asc = require('./_array-species-create');\nmodule.exports = function (TYPE, $create) {\n  var IS_MAP = TYPE == 1;\n  var IS_FILTER = TYPE == 2;\n  var IS_SOME = TYPE == 3;\n  var IS_EVERY = TYPE == 4;\n  var IS_FIND_INDEX = TYPE == 6;\n  var NO_HOLES = TYPE == 5 || IS_FIND_INDEX;\n  var create = $create || asc;\n  return function ($this, callbackfn, that) {\n    var O = toObject($this);\n    var self = IObject(O);\n    var f = ctx(callbackfn, that, 3);\n    var length = toLength(self.length);\n    var index = 0;\n    var result = IS_MAP ? create($this, length) : IS_FILTER ? create($this, 0) : undefined;\n    var val, res;\n    for (;length > index; index++) if (NO_HOLES || index in self) {\n      val = self[index];\n      res = f(val, index, O);\n      if (TYPE) {\n        if (IS_MAP) result[index] = res;   // map\n        else if (res) switch (TYPE) {\n          case 3: return true;             // some\n          case 5: return val;              // find\n          case 6: return index;            // findIndex\n          case 2: result.push(val);        // filter\n        } else if (IS_EVERY) return false; // every\n      }\n    }\n    return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : result;\n  };\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_array-methods.js\n// module id = 34\n// module chunks = 110","var toString = {}.toString;\n\nmodule.exports = function (it) {\n  return toString.call(it).slice(8, -1);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_cof.js\n// module id = 35\n// module chunks = 110","// 7.1.13 ToObject(argument)\nvar defined = require('./_defined');\nmodule.exports = function (it) {\n  return Object(defined(it));\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_to-object.js\n// module id = 36\n// module chunks = 110","// 7.2.1 RequireObjectCoercible(argument)\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on  \" + it);\n  return it;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_defined.js\n// module id = 37\n// module chunks = 110","// 7.1.15 ToLength\nvar toInteger = require('./_to-integer');\nvar min = Math.min;\nmodule.exports = function (it) {\n  return it > 0 ? min(toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_to-length.js\n// module id = 38\n// module chunks = 110","// 7.1.4 ToInteger\nvar ceil = Math.ceil;\nvar floor = Math.floor;\nmodule.exports = function (it) {\n  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_to-integer.js\n// module id = 39\n// module chunks = 110","var store = require('./_shared')('wks');\nvar uid = require('./_uid');\nvar Symbol = require('./_global').Symbol;\nvar USE_SYMBOL = typeof Symbol == 'function';\n\nvar $exports = module.exports = function (name) {\n  return store[name] || (store[name] =\n    USE_SYMBOL && Symbol[name] || (USE_SYMBOL ? Symbol : uid)('Symbol.' + name));\n};\n\n$exports.store = store;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_wks.js\n// module id = 40\n// module chunks = 110","var global = require('./_global');\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || (global[SHARED] = {});\nmodule.exports = function (key) {\n  return store[key] || (store[key] = {});\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_shared.js\n// module id = 41\n// module chunks = 110","// false -> Array#indexOf\n// true  -> Array#includes\nvar toIObject = require('./_to-iobject');\nvar toLength = require('./_to-length');\nvar toAbsoluteIndex = require('./_to-absolute-index');\nmodule.exports = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIObject($this);\n    var length = toLength(O.length);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) if (IS_INCLUDES || index in O) {\n      if (O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_array-includes.js\n// module id = 42\n// module chunks = 110","// to indexed object, toObject with fallback for non-array-like ES3 strings\nvar IObject = require('./_iobject');\nvar defined = require('./_defined');\nmodule.exports = function (it) {\n  return IObject(defined(it));\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_to-iobject.js\n// module id = 43\n// module chunks = 110","/**\n * @module sizeMapping\n */\nimport * as utils from './utils';\nlet _win;\n\nfunction mapSizes(adUnit) {\n  if (!isSizeMappingValid(adUnit.sizeMapping)) {\n    return adUnit.sizes;\n  }\n  const width = getScreenWidth();\n  if (!width) {\n    // size not detected - get largest value set for desktop\n    const mapping = adUnit.sizeMapping.reduce((prev, curr) => {\n      return prev.minWidth < curr.minWidth ? curr : prev;\n    });\n    if (mapping.sizes && mapping.sizes.length) {\n      return mapping.sizes;\n    }\n    return adUnit.sizes;\n  }\n  let sizes = '';\n  const mapping = adUnit.sizeMapping.find(sizeMapping => {\n    return width >= sizeMapping.minWidth;\n  });\n  if (mapping && mapping.sizes && mapping.sizes.length) {\n    sizes = mapping.sizes;\n    utils.logMessage(`AdUnit : ${adUnit.code} resized based on device width to : ${sizes}`);\n  } else {\n    utils.logMessage(`AdUnit : ${adUnit.code} not mapped to any sizes for device width. This request will be suppressed.`);\n  }\n  return sizes;\n}\n\nfunction isSizeMappingValid(sizeMapping) {\n  if (utils.isArray(sizeMapping) && sizeMapping.length > 0) {\n    return true;\n  }\n  utils.logInfo('No size mapping defined');\n  return false;\n}\n\nfunction getScreenWidth(win) {\n  var w = win || _win || window;\n  var d = w.document;\n\n  if (w.innerWidth) {\n    return w.innerWidth;\n  } else if (d.body.clientWidth) {\n    return d.body.clientWidth;\n  } else if (d.documentElement.clientWidth) {\n    return d.documentElement.clientWidth;\n  }\n  return 0;\n}\n\nfunction setWindow(win) {\n  _win = win;\n}\n\nexport { mapSizes, getScreenWidth, setWindow };\n\n\n\n// WEBPACK FOOTER //\n// ./src/sizeMapping.js","/**\n * This module interacts with the server used to cache video ad content to be restored later.\n * At a high level, the expected workflow goes like this:\n *\n *   - Request video ads from Bidders\n *   - Generate IDs for each valid bid, and cache the key/value pair on the server.\n *   - Return these IDs so that publishers can use them to fetch the bids later.\n *\n * This trickery helps integrate with ad servers, which set character limits on request params.\n */\n\nimport { ajax } from './ajax';\n\nconst BASE_URL = 'https://prebid.adnxs.com/pbc/v1/cache'\n\n/**\n * @typedef {object} CacheableUrlBid\n * @property {string} vastUrl A URL which loads some valid VAST XML.\n */\n\n/**\n * @typedef {object} CacheablePayloadBid\n * @property {string} vastXml Some VAST XML which loads an ad in a video player.\n */\n\n/**\n * A CacheableBid describes the types which the videoCache can store.\n *\n * @typedef {CacheableUrlBid|CacheablePayloadBid} CacheableBid\n */\n\n/**\n * Function which wraps a URI that serves VAST XML, so that it can be loaded.\n *\n * @param {string} uri The URI where the VAST content can be found.\n * @return A VAST URL which loads XML from the given URI.\n */\nfunction wrapURI(uri) {\n  // Technically, this is vulnerable to cross-script injection by sketchy vastUrl bids.\n  // We could make sure it's a valid URI... but since we're loading VAST XML from the\n  // URL they provide anyway, that's probably not a big deal.\n  return `<VAST version=\"3.0\">\n    <Ad>\n      <Wrapper>\n        <AdSystem>prebid.org wrapper</AdSystem>\n        <VASTAdTagURI><![CDATA[${uri}]]></VASTAdTagURI>\n        <Impression></Impression>\n        <Creatives></Creatives>\n      </Wrapper>\n    </Ad>\n  </VAST>`;\n}\n\n/**\n * Wraps a bid in the format expected by the prebid-server endpoints, or returns null if\n * the bid can't be converted cleanly.\n *\n * @param {CacheableBid} bid\n */\nfunction toStorageRequest(bid) {\n  const vastValue = bid.vastXml ? bid.vastXml : wrapURI(bid.vastUrl);\n  return {\n    type: 'xml',\n    value: vastValue\n  };\n}\n\n/**\n * A function which should be called with the results of the storage operation.\n *\n * @callback videoCacheStoreCallback\n *\n * @param {Error} [error] The error, if one occurred.\n * @param {?string[]} uuids An array of unique IDs. The array will have one element for each bid we were asked\n *   to store. It may include null elements if some of the bids were malformed, or an error occurred.\n *   Each non-null element in this array is a valid input into the retrieve function, which will fetch\n *   some VAST XML which can be used to render this bid's ad.\n */\n\n/**\n * A function which bridges the APIs between the videoCacheStoreCallback and our ajax function's API.\n *\n * @param {videoCacheStoreCallback} done A callback to the \"store\" function.\n * @return {Function} A callback which interprets the cache server's responses, and makes up the right\n *   arguments for our callback.\n */\nfunction shimStorageCallback(done) {\n  return {\n    success: function(responseBody) {\n      let ids;\n      try {\n        ids = JSON.parse(responseBody).responses\n      } catch (e) {\n        done(e, []);\n        return;\n      }\n\n      if (ids) {\n        done(null, ids);\n      } else {\n        done(new Error(\"The cache server didn't respond with a responses property.\"), []);\n      }\n    },\n    error: function(statusText, responseBody) {\n      done(new Error(`Error storing video ad in the cache: ${statusText}: ${JSON.stringify(responseBody)}`), []);\n    }\n  }\n}\n\n/**\n * If the given bid is for a Video ad, generate a unique ID and cache it somewhere server-side.\n *\n * @param {CacheableBid[]} bids A list of bid objects which should be cached.\n * @param {videoCacheStoreCallback} [done] An optional callback which should be executed after\n *   the data has been stored in the cache.\n */\nexport function store(bids, done) {\n  const requestData = {\n    puts: bids.map(toStorageRequest)\n  };\n\n  ajax(BASE_URL, shimStorageCallback(done), JSON.stringify(requestData), {\n    contentType: 'text/plain',\n    withCredentials: true\n  });\n}\n\nexport function getCacheUrl(id) {\n  return `${BASE_URL}?uuid=${id}`;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/videoCache.js","\n/**\n * @typedef {function} HookedFunction\n * @property {function(function(), [number])} addHook A method that takes a new function to attach as a hook\n *  to the HookedFunction\n * @property {function(function())} removeHook A method to remove attached hooks\n */\n\n/**\n * A map of global hook methods to allow easy extension of hooked functions that are intended to be extended globally\n * @type {{}}\n */\nexport const hooks = {};\n\n/**\n * A utility function for allowing a regular function to be extensible with additional hook functions\n * @param {string} type The method for applying all attached hooks when this hooked function is called\n * @param {function()} fn The function to make hookable\n * @param {string} hookName If provided this allows you to register a name for a global hook to have easy access to\n *  the addHook and removeHook methods for that hook (which are usually accessed as methods on the function itself)\n * @returns {HookedFunction} A new function that implements the HookedFunction interface\n */\nexport function createHook(type, fn, hookName) {\n  let _hooks = [{fn, priority: 0}];\n\n  let types = {\n    sync: function(...args) {\n      _hooks.forEach(hook => {\n        hook.fn.apply(this, args);\n      });\n    },\n    asyncSeries: function(...args) {\n      let curr = 0;\n\n      const asyncSeriesNext = (...args) => {\n        let hook = _hooks[++curr];\n        if (typeof hook === 'object' && typeof hook.fn === 'function') {\n          return hook.fn.apply(this, args.concat(asyncSeriesNext))\n        }\n      };\n\n      return _hooks[curr].fn.apply(this, args.concat(asyncSeriesNext));\n    }\n  };\n\n  if (!types[type]) {\n    throw 'invalid hook type';\n  }\n\n  let methods = {\n    addHook: function(fn, priority = 10) {\n      if (typeof fn === 'function') {\n        _hooks.push({\n          fn,\n          priority: priority\n        });\n\n        _hooks.sort((a, b) => b.priority - a.priority);\n      }\n    },\n    removeHook: function(removeFn) {\n      _hooks = _hooks.filter(hook => hook.fn === fn || hook.fn !== removeFn);\n    }\n  };\n\n  if (typeof hookName === 'string') {\n    hooks[hookName] = methods;\n  }\n\n  function hookedFn(...args) {\n    if (_hooks.length === 0) {\n      return fn.apply(this, args);\n    }\n    return types[type].apply(this, args);\n  }\n\n  return Object.assign(hookedFn, methods);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/hook.js","/** @module pbjs */\n\nimport { getGlobal } from './prebidGlobal';\nimport { flatten, uniques, isGptPubadsDefined, adUnitsFilter } from './utils';\nimport { videoAdUnit, hasNonVideoBidder } from './video';\nimport { nativeAdUnit, nativeBidder, hasNonNativeBidder } from './native';\nimport './polyfill';\nimport { parse as parseURL, format as formatURL } from './url';\nimport { listenMessagesFromCreative } from './secureCreatives';\nimport { userSync } from 'src/userSync.js';\nimport { loadScript } from './adloader';\nimport { setAjaxTimeout } from './ajax';\nimport { config } from './config';\n\nvar pbjs = getGlobal();\n\nvar CONSTANTS = require('./constants.json');\nvar utils = require('./utils.js');\nvar bidmanager = require('./bidmanager.js');\nvar adaptermanager = require('./adaptermanager');\nvar bidfactory = require('./bidfactory');\nvar events = require('./events');\nvar adserver = require('./adserver.js');\nvar targeting = require('./targeting.js');\nconst { syncUsers, triggerUserSyncs } = userSync;\n\n/* private variables */\n\nvar BID_WON = CONSTANTS.EVENTS.BID_WON;\nvar SET_TARGETING = CONSTANTS.EVENTS.SET_TARGETING;\nvar ADD_AD_UNITS = CONSTANTS.EVENTS.ADD_AD_UNITS;\n\nvar auctionRunning = false;\nvar bidRequestQueue = [];\n\nvar eventValidators = {\n  bidWon: checkDefinedPlacement\n};\n\n/* Public vars */\n\npbjs._bidsRequested = [];\npbjs._bidsReceived = [];\n// _adUnitCodes stores the current filter to use for adUnits as an array of adUnitCodes\npbjs._adUnitCodes = [];\npbjs._winningBids = [];\npbjs._adsReceived = [];\n\npbjs.bidderSettings = pbjs.bidderSettings || {};\n\n/** @deprecated - use pbjs.setConfig({ bidderTimeout: <timeout> }) */\npbjs.bidderTimeout = pbjs.bidderTimeout;\n\n// current timeout set in `requestBids` or to default `bidderTimeout`\npbjs.cbTimeout = pbjs.cbTimeout || 200;\n\n// timeout buffer to adjust for bidder CDN latency\npbjs.timeoutBuffer = 200;\n\n/** @deprecated - use pbjs.setConfig({ debug: <true|false> }) */\npbjs.logging = pbjs.logging;\n\n/** @deprecated - use pbjs.setConfig({ publisherDomain: <domain> ) */\npbjs.publisherDomain = pbjs.publisherDomain;\n\n// let the world know we are loaded\npbjs.libLoaded = true;\n\n// version auto generated from build\npbjs.version = 'v0.33.0-pre';\nutils.logInfo('Prebid.js v0.33.0-pre loaded');\n\n// create adUnit array\npbjs.adUnits = pbjs.adUnits || [];\n\n// Allow publishers who enable user sync override to trigger their sync\npbjs.triggerUserSyncs = triggerUserSyncs;\n\nfunction checkDefinedPlacement(id) {\n  var placementCodes = pbjs._bidsRequested.map(bidSet => bidSet.bids.map(bid => bid.placementCode))\n    .reduce(flatten)\n    .filter(uniques);\n\n  if (!utils.contains(placementCodes, id)) {\n    utils.logError('The \"' + id + '\" placement is not defined.');\n    return;\n  }\n\n  return true;\n}\n\n/**\n * When a request for bids is made any stale bids remaining will be cleared for\n * a placement included in the outgoing bid request.\n */\nfunction clearPlacements() {\n  pbjs._bidsRequested = [];\n\n  // leave bids received for ad slots not in this bid request\n  pbjs._bidsReceived = pbjs._bidsReceived\n    .filter(bid => !pbjs._adUnitCodes.includes(bid.adUnitCode));\n}\n\nfunction setRenderSize(doc, width, height) {\n  if (doc.defaultView && doc.defaultView.frameElement) {\n    doc.defaultView.frameElement.width = width;\n    doc.defaultView.frameElement.height = height;\n  }\n}\n\n/// ///////////////////////////////\n//                              //\n//    Start Public APIs         //\n//                              //\n/// ///////////////////////////////\n\n/**\n * This function returns the query string targeting parameters available at this moment for a given ad unit. Note that some bidder's response may not have been received if you call this function too quickly after the requests are sent.\n * @param  {string} [adunitCode] adUnitCode to get the bid responses for\n * @alias module:pbjs.getAdserverTargetingForAdUnitCodeStr\n * @return {Array}  returnObj return bids array\n */\npbjs.getAdserverTargetingForAdUnitCodeStr = function (adunitCode) {\n  utils.logInfo('Invoking pbjs.getAdserverTargetingForAdUnitCodeStr', arguments);\n\n  // call to retrieve bids array\n  if (adunitCode) {\n    var res = pbjs.getAdserverTargetingForAdUnitCode(adunitCode);\n    return utils.transformAdServerTargetingObj(res);\n  } else {\n    utils.logMessage('Need to call getAdserverTargetingForAdUnitCodeStr with adunitCode');\n  }\n};\n\n/**\n * This function returns the query string targeting parameters available at this moment for a given ad unit. Note that some bidder's response may not have been received if you call this function too quickly after the requests are sent.\n * @param adUnitCode {string} adUnitCode to get the bid responses for\n * @alias module:pbjs.getAdserverTargetingForAdUnitCode\n * @returns {Object}  returnObj return bids\n */\npbjs.getAdserverTargetingForAdUnitCode = function(adUnitCode) {\n  return pbjs.getAdserverTargeting(adUnitCode)[adUnitCode];\n};\n\n/**\n * returns all ad server targeting for all ad units\n * @return {Object} Map of adUnitCodes and targeting values []\n * @alias module:pbjs.getAdserverTargeting\n */\n\npbjs.getAdserverTargeting = function (adUnitCode) {\n  utils.logInfo('Invoking pbjs.getAdserverTargeting', arguments);\n  return targeting.getAllTargeting(adUnitCode)\n    .map(targeting => {\n      return {\n        [Object.keys(targeting)[0]]: targeting[Object.keys(targeting)[0]]\n          .map(target => {\n            return {\n              [Object.keys(target)[0]]: target[Object.keys(target)[0]].join(', ')\n            };\n          }).reduce((p, c) => Object.assign(c, p), {})\n      };\n    })\n    .reduce(function (accumulator, targeting) {\n      var key = Object.keys(targeting)[0];\n      accumulator[key] = Object.assign({}, accumulator[key], targeting[key]);\n      return accumulator;\n    }, {});\n};\n\n/**\n * This function returns the bid responses at the given moment.\n * @alias module:pbjs.getBidResponses\n * @return {Object}            map | object that contains the bidResponses\n */\n\npbjs.getBidResponses = function () {\n  utils.logInfo('Invoking pbjs.getBidResponses', arguments);\n  const responses = pbjs._bidsReceived\n    .filter(adUnitsFilter.bind(this, pbjs._adUnitCodes));\n\n  // find the last requested id to get responses for most recent auction only\n  const currentRequestId = responses && responses.length && responses[responses.length - 1].requestId;\n\n  return responses.map(bid => bid.adUnitCode)\n    .filter(uniques).map(adUnitCode => responses\n      .filter(bid => bid.requestId === currentRequestId && bid.adUnitCode === adUnitCode))\n    .filter(bids => bids && bids[0] && bids[0].adUnitCode)\n    .map(bids => {\n      return {\n        [bids[0].adUnitCode]: { bids: bids }\n      };\n    })\n    .reduce((a, b) => Object.assign(a, b), {});\n};\n\n/**\n * Returns bidResponses for the specified adUnitCode\n * @param  {string} adUnitCode adUnitCode\n * @alias module:pbjs.getBidResponsesForAdUnitCode\n * @return {Object}            bidResponse object\n */\n\npbjs.getBidResponsesForAdUnitCode = function (adUnitCode) {\n  const bids = pbjs._bidsReceived.filter(bid => bid.adUnitCode === adUnitCode);\n  return {\n    bids: bids\n  };\n};\n\n/**\n * Set query string targeting on one or more GPT ad units.\n * @param {(string|string[])} adUnit a single `adUnit.code` or multiple.\n * @alias module:pbjs.setTargetingForGPTAsync\n */\npbjs.setTargetingForGPTAsync = function (adUnit) {\n  utils.logInfo('Invoking pbjs.setTargetingForGPTAsync', arguments);\n  if (!isGptPubadsDefined()) {\n    utils.logError('window.googletag is not defined on the page');\n    return;\n  }\n\n  // get our ad unit codes\n  var targetingSet = targeting.getAllTargeting(adUnit);\n\n  // first reset any old targeting\n  targeting.resetPresetTargeting(adUnit);\n\n  // now set new targeting keys\n  targeting.setTargeting(targetingSet);\n\n  // emit event\n  events.emit(SET_TARGETING);\n};\n\n/**\n * Set query string targeting on all AST (AppNexus Seller Tag) ad units. Note that this function has to be called after all ad units on page are defined. For working example code, see [Using Prebid.js with AppNexus Publisher Ad Server](http://prebid.org/dev-docs/examples/use-prebid-with-appnexus-ad-server.html).\n * @alias module:pbjs.setTargetingForAst\n */\npbjs.setTargetingForAst = function() {\n  utils.logInfo('Invoking pbjs.setTargetingForAn', arguments);\n  if (!targeting.isApntagDefined()) {\n    utils.logError('window.apntag is not defined on the page');\n    return;\n  }\n\n  targeting.setTargetingForAst();\n\n  // emit event\n  events.emit(SET_TARGETING);\n};\n\n/**\n * Returns a bool if all the bids have returned or timed out\n * @alias module:pbjs.allBidsAvailable\n * @return {bool} all bids available\n *\n * @deprecated This function will be removed in Prebid 1.0\n * Alternative solution is in progress.\n * See https://github.com/prebid/Prebid.js/issues/1087 for more details.\n */\npbjs.allBidsAvailable = function () {\n  utils.logWarn('pbjs.allBidsAvailable will be removed in Prebid 1.0. Alternative solution is in progress. See https://github.com/prebid/Prebid.js/issues/1087 for more details.');\n  utils.logInfo('Invoking pbjs.allBidsAvailable', arguments);\n  return bidmanager.bidsBackAll();\n};\n\n/**\n * This function will render the ad (based on params) in the given iframe document passed through.\n * Note that doc SHOULD NOT be the parent document page as we can't doc.write() asynchronously\n * @param  {HTMLDocument} doc document\n * @param  {string} id bid id to locate the ad\n * @alias module:pbjs.renderAd\n */\npbjs.renderAd = function (doc, id) {\n  utils.logInfo('Invoking pbjs.renderAd', arguments);\n  utils.logMessage('Calling renderAd with adId :' + id);\n  if (doc && id) {\n    try {\n      // lookup ad by ad Id\n      const bid = pbjs._bidsReceived.find(bid => bid.adId === id);\n      if (bid) {\n        // replace macros according to openRTB with price paid = bid.cpm\n        bid.ad = utils.replaceAuctionPrice(bid.ad, bid.cpm);\n        bid.url = utils.replaceAuctionPrice(bid.url, bid.cpm);\n        // save winning bids\n        pbjs._winningBids.push(bid);\n\n        // emit 'bid won' event here\n        events.emit(BID_WON, bid);\n\n        const { height, width, ad, mediaType, adUrl: url, renderer } = bid;\n\n        if (renderer && renderer.url) {\n          renderer.render(bid);\n        } else if ((doc === document && !utils.inIframe()) || mediaType === 'video') {\n          utils.logError(`Error trying to write ad. Ad render call ad id ${id} was prevented from writing to the main document.`);\n        } else if (ad) {\n          doc.write(ad);\n          doc.close();\n          setRenderSize(doc, width, height);\n        } else if (url) {\n          const iframe = utils.createInvisibleIframe();\n          iframe.height = height;\n          iframe.width = width;\n          iframe.style.display = 'inline';\n          iframe.style.overflow = 'hidden';\n          iframe.src = url;\n\n          utils.insertElement(iframe, doc, 'body');\n          setRenderSize(doc, width, height);\n        } else {\n          utils.logError('Error trying to write ad. No ad for bid response id: ' + id);\n        }\n      } else {\n        utils.logError('Error trying to write ad. Cannot find ad by given id : ' + id);\n      }\n    } catch (e) {\n      utils.logError('Error trying to write ad Id :' + id + ' to the page:' + e.message);\n    }\n  } else {\n    utils.logError('Error trying to write ad Id :' + id + ' to the page. Missing document or adId');\n  }\n};\n\n/**\n * Remove adUnit from the pbjs configuration\n * @param  {string} adUnitCode the adUnitCode to remove\n * @alias module:pbjs.removeAdUnit\n */\npbjs.removeAdUnit = function (adUnitCode) {\n  utils.logInfo('Invoking pbjs.removeAdUnit', arguments);\n  if (adUnitCode) {\n    for (var i = 0; i < pbjs.adUnits.length; i++) {\n      if (pbjs.adUnits[i].code === adUnitCode) {\n        pbjs.adUnits.splice(i, 1);\n      }\n    }\n  }\n};\n\n/**\n * @alias module:pbjs.clearAuction\n */\npbjs.clearAuction = function() {\n  auctionRunning = false;\n  // Only automatically sync if the publisher has not chosen to \"enableOverride\"\n  let userSyncConfig = config.getConfig('userSync') || {};\n  if (!userSyncConfig.enableOverride) {\n    // Delay the auto sync by the config delay\n    syncUsers(userSyncConfig.syncDelay);\n  }\n\n  utils.logMessage('Prebid auction cleared');\n  if (bidRequestQueue.length) {\n    bidRequestQueue.shift()();\n  }\n};\n\n/**\n * @param {Object} requestOptions\n * @param {function} requestOptions.bidsBackHandler\n * @param {number} requestOptions.timeout\n * @param {Array} requestOptions.adUnits\n * @param {Array} requestOptions.adUnitCodes\n * @alias module:pbjs.requestBids\n */\npbjs.requestBids = function ({ bidsBackHandler, timeout, adUnits, adUnitCodes } = {}) {\n  events.emit('requestBids');\n  const cbTimeout = pbjs.cbTimeout = timeout || config.getConfig('bidderTimeout');\n  adUnits = adUnits || pbjs.adUnits;\n\n  utils.logInfo('Invoking pbjs.requestBids', arguments);\n\n  if (adUnitCodes && adUnitCodes.length) {\n    // if specific adUnitCodes supplied filter adUnits for those codes\n    adUnits = adUnits.filter(unit => adUnitCodes.includes(unit.code));\n  } else {\n    // otherwise derive adUnitCodes from adUnits\n    adUnitCodes = adUnits && adUnits.map(unit => unit.code);\n  }\n\n  // for video-enabled adUnits, only request bids if all bidders support video\n  const invalidVideoAdUnits = adUnits.filter(videoAdUnit).filter(hasNonVideoBidder);\n  invalidVideoAdUnits.forEach(adUnit => {\n    utils.logError(`adUnit ${adUnit.code} has 'mediaType' set to 'video' but contains a bidder that doesn't support video. No Prebid demand requests will be triggered for this adUnit.`);\n    for (let i = 0; i < adUnits.length; i++) {\n      if (adUnits[i].code === adUnit.code) { adUnits.splice(i, 1); }\n    }\n  });\n\n  // for native-enabled adUnits, only request bids for bidders that support native\n  adUnits.filter(nativeAdUnit).filter(hasNonNativeBidder).forEach(adUnit => {\n    const nonNativeBidders = adUnit.bids\n      .filter(bid => !nativeBidder(bid))\n      .map(bid => bid.bidder)\n      .join(', ');\n\n    utils.logError(`adUnit ${adUnit.code} has 'mediaType' set to 'native' but contains non-native bidder(s) ${nonNativeBidders}. No Prebid demand requests will be triggered for those bidders.`);\n    adUnit.bids = adUnit.bids.filter(nativeBidder);\n  });\n\n  if (auctionRunning) {\n    bidRequestQueue.push(() => {\n      pbjs.requestBids({ bidsBackHandler, timeout: cbTimeout, adUnits, adUnitCodes });\n    });\n    return;\n  }\n\n  auctionRunning = true;\n\n  // we will use adUnitCodes for filtering the current auction\n  pbjs._adUnitCodes = adUnitCodes;\n\n  bidmanager.externalCallbackReset();\n  clearPlacements();\n\n  if (!adUnits || adUnits.length === 0) {\n    utils.logMessage('No adUnits configured. No bids requested.');\n    if (typeof bidsBackHandler === 'function') {\n      bidmanager.addOneTimeCallback(bidsBackHandler, false);\n    }\n    bidmanager.executeCallback();\n    return;\n  }\n\n  // set timeout for all bids\n  const timedOut = true;\n  const timeoutCallback = bidmanager.executeCallback.bind(bidmanager, timedOut);\n  const timer = setTimeout(timeoutCallback, cbTimeout);\n  setAjaxTimeout(cbTimeout);\n  if (typeof bidsBackHandler === 'function') {\n    bidmanager.addOneTimeCallback(bidsBackHandler, timer);\n  }\n\n  adaptermanager.callBids({ adUnits, adUnitCodes, cbTimeout });\n  if (pbjs._bidsRequested.length === 0) {\n    bidmanager.executeCallback();\n  }\n};\n\n/**\n *\n * Add adunit(s)\n * @param {Array|Object} adUnitArr Array of adUnits or single adUnit Object.\n * @alias module:pbjs.addAdUnits\n */\npbjs.addAdUnits = function (adUnitArr) {\n  utils.logInfo('Invoking pbjs.addAdUnits', arguments);\n  if (utils.isArray(adUnitArr)) {\n    // generate transactionid for each new adUnits\n    // Append array to existing\n    adUnitArr.forEach(adUnit => adUnit.transactionId = utils.generateUUID());\n    pbjs.adUnits.push.apply(pbjs.adUnits, adUnitArr);\n  } else if (typeof adUnitArr === 'object') {\n    // Generate the transaction id for the adunit\n    adUnitArr.transactionId = utils.generateUUID();\n    pbjs.adUnits.push(adUnitArr);\n  }\n  // emit event\n  events.emit(ADD_AD_UNITS);\n};\n\n/**\n * @param {string} event the name of the event\n * @param {Function} handler a callback to set on event\n * @param {string} id an identifier in the context of the event\n * @alias module:pbjs.onEvent\n *\n * This API call allows you to register a callback to handle a Prebid.js event.\n * An optional `id` parameter provides more finely-grained event callback registration.\n * This makes it possible to register callback events for a specific item in the\n * event context. For example, `bidWon` events will accept an `id` for ad unit code.\n * `bidWon` callbacks registered with an ad unit code id will be called when a bid\n * for that ad unit code wins the auction. Without an `id` this method registers the\n * callback for every `bidWon` event.\n *\n * Currently `bidWon` is the only event that accepts an `id` parameter.\n */\npbjs.onEvent = function (event, handler, id) {\n  utils.logInfo('Invoking pbjs.onEvent', arguments);\n  if (!utils.isFn(handler)) {\n    utils.logError('The event handler provided is not a function and was not set on event \"' + event + '\".');\n    return;\n  }\n\n  if (id && !eventValidators[event].call(null, id)) {\n    utils.logError('The id provided is not valid for event \"' + event + '\" and no handler was set.');\n    return;\n  }\n\n  events.on(event, handler, id);\n};\n\n/**\n * @param {string} event the name of the event\n * @param {Function} handler a callback to remove from the event\n * @param {string} id an identifier in the context of the event (see `pbjs.onEvent`)\n * @alias module:pbjs.offEvent\n */\npbjs.offEvent = function (event, handler, id) {\n  utils.logInfo('Invoking pbjs.offEvent', arguments);\n  if (id && !eventValidators[event].call(null, id)) {\n    return;\n  }\n\n  events.off(event, handler, id);\n};\n\n/**\n * Add a callback event\n * @param {string} eventStr event to attach callback to Options: \"allRequestedBidsBack\" | \"adUnitBidsBack\"\n * @param {Function} func  function to execute. Parameters passed into the function: (bidResObj), [adUnitCode]);\n * @alias module:pbjs.addCallback\n * @returns {string} id for callback\n *\n * @deprecated This function will be removed in Prebid 1.0\n * Please use onEvent instead.\n */\npbjs.addCallback = function (eventStr, func) {\n  utils.logWarn('pbjs.addCallback will be removed in Prebid 1.0. Please use onEvent instead');\n  utils.logInfo('Invoking pbjs.addCallback', arguments);\n  var id = null;\n  if (!eventStr || !func || typeof func !== 'function') {\n    utils.logError('error registering callback. Check method signature');\n    return id;\n  }\n\n  id = utils.getUniqueIdentifierStr;\n  bidmanager.addCallback(id, func, eventStr);\n  return id;\n};\n\n/**\n * Remove a callback event\n * //@param {string} cbId id of the callback to remove\n * @alias module:pbjs.removeCallback\n * @returns {string} id for callback\n *\n * @deprecated This function will be removed in Prebid 1.0\n * Please use offEvent instead.\n */\npbjs.removeCallback = function (/* cbId */) {\n  // todo\n  utils.logWarn('pbjs.removeCallback will be removed in Prebid 1.0. Please use offEvent instead.');\n  return null;\n};\n\n/**\n * Wrapper to register bidderAdapter externally (adaptermanager.registerBidAdapter())\n * @param  {Function} bidderAdaptor [description]\n * @param  {string} bidderCode [description]\n * @alias module:pbjs.registerBidAdapter\n */\npbjs.registerBidAdapter = function (bidderAdaptor, bidderCode) {\n  utils.logInfo('Invoking pbjs.registerBidAdapter', arguments);\n  try {\n    adaptermanager.registerBidAdapter(bidderAdaptor(), bidderCode);\n  } catch (e) {\n    utils.logError('Error registering bidder adapter : ' + e.message);\n  }\n};\n\n/**\n * Wrapper to register analyticsAdapter externally (adaptermanager.registerAnalyticsAdapter())\n * @param  {Object} options [description]\n * @alias module:pbjs.registerAnalyticsAdapter\n */\npbjs.registerAnalyticsAdapter = function (options) {\n  utils.logInfo('Invoking pbjs.registerAnalyticsAdapter', arguments);\n  try {\n    adaptermanager.registerAnalyticsAdapter(options);\n  } catch (e) {\n    utils.logError('Error registering analytics adapter : ' + e.message);\n  }\n};\n\n/**\n * @alias module:pbjs.bidsAvailableForAdapter\n*/\npbjs.bidsAvailableForAdapter = function (bidderCode) {\n  utils.logInfo('Invoking pbjs.bidsAvailableForAdapter', arguments);\n\n  pbjs._bidsRequested.find(bidderRequest => bidderRequest.bidderCode === bidderCode).bids\n    .map(bid => {\n      return Object.assign(bid, bidfactory.createBid(1), {\n        bidderCode,\n        adUnitCode: bid.placementCode\n      });\n    })\n    .map(bid => pbjs._bidsReceived.push(bid));\n};\n\n/**\n * Wrapper to bidfactory.createBid()\n * @param  {string} statusCode [description]\n * @alias module:pbjs.createBid\n * @return {Object} bidResponse [description]\n */\npbjs.createBid = function (statusCode) {\n  utils.logInfo('Invoking pbjs.createBid', arguments);\n  return bidfactory.createBid(statusCode);\n};\n\n/**\n * Wrapper to bidmanager.addBidResponse\n * @param {string} adUnitCode [description]\n * @param {Object} bid [description]\n * @alias module:pbjs.addBidResponse\n * @deprecated This function will be removed in Prebid 1.0\n * Each bidder will be passed a reference to addBidResponse function in callBids as an argument.\n * See https://github.com/prebid/Prebid.js/issues/1087 for more details.\n */\npbjs.addBidResponse = function (adUnitCode, bid) {\n  utils.logWarn('pbjs.addBidResponse will be removed in Prebid 1.0. Each bidder will be passed a reference to addBidResponse function in callBids as an argument. See https://github.com/prebid/Prebid.js/issues/1087 for more details.');\n  utils.logInfo('Invoking pbjs.addBidResponse', arguments);\n  bidmanager.addBidResponse(adUnitCode, bid);\n};\n\n/**\n * Wrapper to adloader.loadScript\n * @param  {string} tagSrc [description]\n * @param  {Function} callback [description]\n * @alias module:pbjs.loadScript\n */\npbjs.loadScript = function (tagSrc, callback, useCache) {\n  utils.logInfo('Invoking pbjs.loadScript', arguments);\n  loadScript(tagSrc, callback, useCache);\n};\n\n/**\n * Enable sending analytics data to the analytics provider of your\n * choice.\n *\n * For usage, see [Integrate with the Prebid Analytics\n * API](http://prebid.org/dev-docs/integrate-with-the-prebid-analytics-api.html).\n *\n * For a list of analytics adapters, see [Analytics for\n * Prebid](http://prebid.org/overview/analytics.html).\n * @param  {Object} config\n * @param {string} config.provider The name of the provider, e.g., `\"ga\"` for Google Analytics.\n * @param {Object} config.options The options for this particular analytics adapter.  This will likely vary between adapters.\n * @alias module:pbjs.enableAnalytics\n */\npbjs.enableAnalytics = function (config) {\n  if (config && !utils.isEmpty(config)) {\n    utils.logInfo('Invoking pbjs.enableAnalytics for: ', config);\n    adaptermanager.enableAnalytics(config);\n  } else {\n    utils.logError('pbjs.enableAnalytics should be called with option {}');\n  }\n};\n\n/**\n * @alias module:pbjs.aliasBidder\n */\npbjs.aliasBidder = function (bidderCode, alias) {\n  utils.logInfo('Invoking pbjs.aliasBidder', arguments);\n  if (bidderCode && alias) {\n    adaptermanager.aliasBidAdapter(bidderCode, alias);\n  } else {\n    utils.logError('bidderCode and alias must be passed as arguments', 'pbjs.aliasBidder');\n  }\n};\n\n/**\n * Sets a default price granularity scheme.\n * @param {string|Object} granularity - the granularity scheme.\n * @alias module:pbjs.setPriceGranularity\n * @deprecated - use pbjs.setConfig({ priceGranularity: <granularity> })\n * \"low\": $0.50 increments, capped at $5 CPM\n * \"medium\": $0.10 increments, capped at $20 CPM (the default)\n * \"high\": $0.01 increments, capped at $20 CPM\n * \"auto\": Applies a sliding scale to determine granularity\n * \"dense\": Like \"auto\", but the bid price granularity uses smaller increments, especially at lower CPMs\n *\n * Alternatively a custom object can be specified:\n * { \"buckets\" : [{\"min\" : 0,\"max\" : 20,\"increment\" : 0.1,\"cap\" : true}]};\n * See http://prebid.org/dev-docs/publisher-api-reference.html#module_pbjs.setPriceGranularity for more details\n */\npbjs.setPriceGranularity = function (granularity) {\n  utils.logWarn('pbjs.setPriceGranularity will be removed in Prebid 1.0. Use pbjs.setConfig({ priceGranularity: <granularity> }) instead.')\n  utils.logInfo('Invoking pbjs.setPriceGranularity', arguments);\n  config.setConfig({ priceGranularity: granularity });\n};\n\n/**\n * @alias module:pbjs.enableSendAllBids\n * @deprecated - use pbjs.setConfig({ enableSendAllBids: <true|false> })\n*/\npbjs.enableSendAllBids = function () {\n  config.setConfig({ enableSendAllBids: true });\n};\n\n/**\n * @alias module:pbjs.getAllWinningBids\n * The bid response object returned by an external bidder adapter during the auction.\n * @typedef {Object} AdapterBidResponse\n * @property {string} pbAg Auto granularity price bucket; CPM <= 5 ? increment = 0.05 : CPM > 5 && CPM <= 10 ? increment = 0.10 : CPM > 10 && CPM <= 20 ? increment = 0.50 : CPM > 20 ? priceCap = 20.00.  Example: `\"0.80\"`.\n * @property {string} pbCg Custom price bucket.  For example setup, see {@link setPriceGranularity}.  Example: `\"0.84\"`.\n * @property {string} pbDg Dense granularity price bucket; CPM <= 3 ? increment = 0.01 : CPM > 3 && CPM <= 8 ? increment = 0.05 : CPM > 8 && CPM <= 20 ? increment = 0.50 : CPM > 20? priceCap = 20.00.  Example: `\"0.84\"`.\n * @property {string} pbLg Low granularity price bucket; $0.50 increment, capped at $5, floored to two decimal places.  Example: `\"0.50\"`.\n * @property {string} pbMg Medium granularity price bucket; $0.10 increment, capped at $20, floored to two decimal places.  Example: `\"0.80\"`.\n * @property {string} pbHg High granularity price bucket; $0.01 increment, capped at $20, floored to two decimal places.  Example: `\"0.84\"`.\n *\n * @property {string} bidder The string name of the bidder.  This *may* be the same as the `bidderCode`.  For For a list of all bidders and their codes, see [Bidders' Params](http://prebid.org/dev-docs/bidders.html).\n * @property {string} bidderCode The unique string that identifies this bidder.  For a list of all bidders and their codes, see [Bidders' Params](http://prebid.org/dev-docs/bidders.html).\n *\n * @property {string} requestId The [UUID](https://en.wikipedia.org/wiki/Universally_unique_identifier) representing the bid request.\n * @property {number} requestTimestamp The time at which the bid request was sent out, expressed in milliseconds.\n * @property {number} responseTimestamp The time at which the bid response was received, expressed in milliseconds.\n * @property {number} timeToRespond How long it took for the bidder to respond with this bid, expressed in milliseconds.\n *\n * @property {string} size The size of the ad creative, expressed in `\"AxB\"` format, where A and B are numbers of pixels.  Example: `\"320x50\"`.\n * @property {string} width The width of the ad creative in pixels.  Example: `\"320\"`.\n * @property {string} height The height of the ad creative in pixels.  Example: `\"50\"`.\n *\n * @property {string} ad The actual ad creative content, often HTML with CSS, JavaScript, and/or links to additional content.  Example: `\"<div id='beacon_-YQbipJtdxmMCgEPHExLhmqzEm' style='position: absolute; left: 0px; top: 0px; visibility: hidden;'><img src='http://aplus-...'/></div><iframe src=\\\"http://aax-us-east.amazon-adsystem.com/e/is/8dcfcd...\" width=\\\"728\\\" height=\\\"90\\\" frameborder=\\\"0\\\" ...></iframe>\",`.\n * @property {number} ad_id The ad ID of the creative, as understood by the bidder's system.  Used by the line item's [creative in the ad server](http://prebid.org/adops/send-all-bids-adops.html#step-3-add-a-creative).\n * @property {string} adUnitCode The code used to uniquely identify the ad unit on the publisher's page.\n *\n * @property {string} statusMessage The status of the bid.  Allowed values: `\"Bid available\"` or `\"Bid returned empty or error response\"`.\n * @property {number} cpm The exact bid price from the bidder, expressed to the thousandths place.  Example: `\"0.849\"`.\n *\n * @property {Object} adserverTargeting An object whose values represent the ad server's targeting on the bid.\n * @property {string} adserverTargeting.hb_adid The ad ID of the creative, as understood by the ad server.\n * @property {string} adserverTargeting.hb_pb The price paid to show the creative, as logged in the ad server.\n * @property {string} adserverTargeting.hb_bidder The winning bidder whose ad creative will be served by the ad server.\n*/\n\n/**\n * Get all of the bids that have won their respective auctions.  Useful for [troubleshooting your integration](http://prebid.org/dev-docs/prebid-troubleshooting-guide.html).\n * @return {Array<AdapterBidResponse>} A list of bids that have won their respective auctions.\n*/\npbjs.getAllWinningBids = function () {\n  return pbjs._winningBids;\n};\n\n/**\n * Build master video tag from publishers adserver tag\n * @param {string} adserverTag default url\n * @param {Object} options options for video tag\n * @alias module:pbjs.buildMasterVideoTagFromAdserverTag\n * @deprecated Include the dfpVideoSupport module in your build, and use the pbjs.adservers.dfp.buildVideoAdUrl function instead.\n * This function will be removed in Prebid 1.0.\n */\npbjs.buildMasterVideoTagFromAdserverTag = function (adserverTag, options) {\n  utils.logWarn('pbjs.buildMasterVideoTagFromAdserverTag will be removed in Prebid 1.0. Include the dfpVideoSupport module in your build, and use the pbjs.adservers.dfp.buildVideoAdUrl function instead');\n  utils.logInfo('Invoking pbjs.buildMasterVideoTagFromAdserverTag', arguments);\n  var urlComponents = parseURL(adserverTag);\n\n  // return original adserverTag if no bids received\n  if (pbjs._bidsReceived.length === 0) {\n    return adserverTag;\n  }\n\n  var masterTag = '';\n  if (options.adserver.toLowerCase() === 'dfp') {\n    var dfpAdserverObj = adserver.dfpAdserver(options, urlComponents);\n    if (!dfpAdserverObj.verifyAdserverTag()) {\n      utils.logError('Invalid adserverTag, required google params are missing in query string');\n    }\n    dfpAdserverObj.appendQueryParams();\n    masterTag = formatURL(dfpAdserverObj.urlComponents);\n  } else {\n    utils.logError('Only DFP adserver is supported');\n    return;\n  }\n  return masterTag;\n};\n\n/**\n * Set the order bidders are called in. Valid values are:\n *\n * \"fixed\": Bidders will be called in the order in which they were defined within the adUnit.bids array.\n * \"random\": Bidders will be called in random order.\n *\n * If never called, Prebid will use \"random\" as the default.\n *\n * @param {string} order One of the valid orders, described above.\n * @alias module:pbjs.setBidderSequence\n * @deprecated - use pbjs.setConfig({ bidderSequence: <order> })\n */\npbjs.setBidderSequence = adaptermanager.setBidderSequence;\n\n/**\n * Get array of highest cpm bids for all adUnits, or highest cpm bid\n * object for the given adUnit\n * @param {string} adUnitCode - optional ad unit code\n * @alias module:pbjs.getHighestCpmBids\n * @return {Array} array containing highest cpm bid object(s)\n */\npbjs.getHighestCpmBids = function (adUnitCode) {\n  return targeting.getWinningBids(adUnitCode);\n};\n\n/**\n * Set config for server to server header bidding\n * @deprecated - use pbjs.setConfig({ s2sConfig: <options> })\n * @typedef {Object} options - required\n * @property {boolean} enabled enables S2S bidding\n * @property {string[]} bidders bidders to request S2S\n *  === optional params below ===\n * @property {string} [endpoint] endpoint to contact\n * @property {number} [timeout] timeout for S2S bidders - should be lower than `pbjs.requestBids({timeout})`\n * @property {string} [adapter] adapter code to use for S2S\n * @property {string} [syncEndpoint] endpoint URL for syncing cookies\n * @property {boolean} [cookieSet] enables cookieSet functionality\n * @alias module:pbjs.setS2SConfig\n */\npbjs.setS2SConfig = function(options) {\n  if (!utils.contains(Object.keys(options), 'accountId')) {\n    utils.logError('accountId missing in Server to Server config');\n    return;\n  }\n\n  if (!utils.contains(Object.keys(options), 'bidders')) {\n    utils.logError('bidders missing in Server to Server config');\n    return;\n  }\n\n  const config = Object.assign({\n    enabled: false,\n    endpoint: CONSTANTS.S2S.DEFAULT_ENDPOINT,\n    timeout: 1000,\n    maxBids: 1,\n    adapter: CONSTANTS.S2S.ADAPTER,\n    syncEndpoint: CONSTANTS.S2S.SYNC_ENDPOINT,\n    cookieSet: true,\n    bidders: []\n  }, options);\n  adaptermanager.setS2SConfig(config);\n};\n\n/**\n * Get Prebid config options\n * @param {Object} options\n * @alias module:pbjs.getConfig\n */\npbjs.getConfig = config.getConfig;\n\n/**\n * Set Prebid config options.\n * (Added in version 0.27.0).\n *\n * `setConfig` is designed to allow for advanced configuration while\n * reducing the surface area of the public API.  For more information\n * about the move to `setConfig` (and the resulting deprecations of\n * some other public methods), see [the Prebid 1.0 public API\n * proposal](https://gist.github.com/mkendall07/51ee5f6b9f2df01a89162cf6de7fe5b6).\n *\n * #### Troubleshooting your configuration\n *\n * If you call `pbjs.setConfig` without an object, e.g.,\n *\n * `pbjs.setConfig('debug', 'true'))`\n *\n * then Prebid.js will print an error to the console that says:\n *\n * ```\n * ERROR: setConfig options must be an object\n * ```\n *\n * If you don't see that message, you can assume the config object is valid.\n *\n * @param {Object} options Global Prebid configuration object. Must be JSON - no JavaScript functions are allowed.\n * @param {string} options.bidderSequence The order in which bidders are called.  Example: `pbjs.setConfig({ bidderSequence: \"fixed\" })`.  Allowed values: `\"fixed\"` (order defined in `adUnit.bids` array on page), `\"random\"`.\n * @param {boolean} options.debug Turn debug logging on/off. Example: `pbjs.setConfig({ debug: true })`.\n * @param {string} options.priceGranularity The bid price granularity to use.  Example: `pbjs.setConfig({ priceGranularity: \"medium\" })`. Allowed values: `\"low\"` ($0.50), `\"medium\"` ($0.10), `\"high\"` ($0.01), `\"auto\"` (sliding scale), `\"dense\"` (like `\"auto\"`, with smaller increments at lower CPMs), or a custom price bucket object, e.g., `{ \"buckets\" : [{\"min\" : 0,\"max\" : 20,\"increment\" : 0.1,\"cap\" : true}]}`.\n * @param {boolean} options.enableSendAllBids Turn \"send all bids\" mode on/off.  Example: `pbjs.setConfig({ enableSendAllBids: true })`.\n * @param {number} options.bidderTimeout Set a global bidder timeout, in milliseconds.  Example: `pbjs.setConfig({ bidderTimeout: 3000 })`.  Note that it's still possible for a bid to get into the auction that responds after this timeout. This is due to how [`setTimeout`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout) works in JS: it queues the callback in the event loop in an approximate location that should execute after this time but it is not guaranteed.  For more information about the asynchronous event loop and `setTimeout`, see [How JavaScript Timers Work](https://johnresig.com/blog/how-javascript-timers-work/).\n * @param {string} options.publisherDomain The publisher's domain where Prebid is running, for cross-domain iFrame communication.  Example: `pbjs.setConfig({ publisherDomain: \"https://www.theverge.com\" })`.\n * @param {number} options.cookieSyncDelay A delay (in milliseconds) for requesting cookie sync to stay out of the critical path of page load.  Example: `pbjs.setConfig({ cookieSyncDelay: 100 })`.\n * @param {Object} options.s2sConfig The configuration object for [server-to-server header bidding](http://prebid.org/dev-docs/get-started-with-prebid-server.html).  Example:\n * @alias module:pbjs.setConfig\n * ```\n * pbjs.setConfig({\n *     s2sConfig: {\n *         accountId: '1',\n *         enabled: true,\n *         bidders: ['appnexus', 'pubmatic'],\n *         timeout: 1000,\n *         adapter: 'prebidServer',\n *         endpoint: 'https://prebid.adnxs.com/pbs/v1/auction'\n *     }\n * })\n * ```\n */\npbjs.setConfig = config.setConfig;\n\npbjs.que.push(() => listenMessagesFromCreative());\n\n/**\n * This queue lets users load Prebid asynchronously, but run functions the same way regardless of whether it gets loaded\n * before or after their script executes. For example, given the code:\n *\n * <script src=\"url/to/Prebid.js\" async></script>\n * <script>\n *   var pbjs = pbjs || {};\n *   pbjs.cmd = pbjs.cmd || [];\n *   pbjs.cmd.push(functionToExecuteOncePrebidLoads);\n * </script>\n *\n * If the page's script runs before prebid loads, then their function gets added to the queue, and executed\n * by prebid once it's done loading. If it runs after prebid loads, then this monkey-patch causes their\n * function to execute immediately.\n *\n * @memberof pbjs\n * @param  {function} command A function which takes no arguments. This is guaranteed to run exactly once, and only after\n *                            the Prebid script has been fully loaded.\n * @alias module:pbjs.cmd.push\n */\npbjs.cmd.push = function(command) {\n  if (typeof command === 'function') {\n    try {\n      command.call();\n    } catch (e) {\n      utils.logError('Error processing command :' + e.message);\n    }\n  } else {\n    utils.logError('Commands written into pbjs.cmd.push must be wrapped in a function');\n  }\n};\n\npbjs.que.push = pbjs.cmd.push;\n\nfunction processQueue(queue) {\n  queue.forEach(function(cmd) {\n    if (typeof cmd.called === 'undefined') {\n      try {\n        cmd.call();\n        cmd.called = true;\n      } catch (e) {\n        utils.logError('Error processing command :', 'prebid.js', e);\n      }\n    }\n  });\n}\n\n/**\n * @alias module:pbjs.processQueue\n */\npbjs.processQueue = function() {\n  processQueue(pbjs.que);\n  processQueue(pbjs.cmd);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/prebid.js","/** @module polyfill\nMisc polyfills\n*/\nrequire('core-js/fn/array/find');\nrequire('core-js/fn/array/find-index');\nrequire('core-js/fn/array/includes');\nrequire('core-js/fn/object/assign');\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger\nNumber.isInteger = Number.isInteger || function(value) {\n  return typeof value === 'number' &&\n    isFinite(value) &&\n    Math.floor(value) === value;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/polyfill.js","require('../../modules/es6.array.find');\nmodule.exports = require('../../modules/_core').Array.find;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/fn/array/find.js\n// module id = 290\n// module chunks = 110","'use strict';\n// 22.1.3.8 Array.prototype.find(predicate, thisArg = undefined)\nvar $export = require('./_export');\nvar $find = require('./_array-methods')(5);\nvar KEY = 'find';\nvar forced = true;\n// Shouldn't skip holes\nif (KEY in []) Array(1)[KEY](function () { forced = false; });\n$export($export.P + $export.F * forced, 'Array', {\n  find: function find(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\nrequire('./_add-to-unscopables')(KEY);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/es6.array.find.js\n// module id = 291\n// module chunks = 110","var anObject = require('./_an-object');\nvar IE8_DOM_DEFINE = require('./_ie8-dom-define');\nvar toPrimitive = require('./_to-primitive');\nvar dP = Object.defineProperty;\n\nexports.f = require('./_descriptors') ? Object.defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPrimitive(P, true);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return dP(O, P, Attributes);\n  } catch (e) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported!');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_object-dp.js\n// module id = 292\n// module chunks = 110","var isObject = require('./_is-object');\nmodule.exports = function (it) {\n  if (!isObject(it)) throw TypeError(it + ' is not an object!');\n  return it;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_an-object.js\n// module id = 293\n// module chunks = 110","module.exports = !require('./_descriptors') && !require('./_fails')(function () {\n  return Object.defineProperty(require('./_dom-create')('div'), 'a', { get: function () { return 7; } }).a != 7;\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_ie8-dom-define.js\n// module id = 294\n// module chunks = 110","var isObject = require('./_is-object');\nvar document = require('./_global').document;\n// typeof document.createElement is 'object' in old IE\nvar is = isObject(document) && isObject(document.createElement);\nmodule.exports = function (it) {\n  return is ? document.createElement(it) : {};\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_dom-create.js\n// module id = 295\n// module chunks = 110","// 7.1.1 ToPrimitive(input [, PreferredType])\nvar isObject = require('./_is-object');\n// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n// and the second argument - flag - preferred type is a string\nmodule.exports = function (it, S) {\n  if (!isObject(it)) return it;\n  var fn, val;\n  if (S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;\n  if (typeof (fn = it.valueOf) == 'function' && !isObject(val = fn.call(it))) return val;\n  if (!S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_to-primitive.js\n// module id = 296\n// module chunks = 110","module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_property-desc.js\n// module id = 297\n// module chunks = 110","var global = require('./_global');\nvar hide = require('./_hide');\nvar has = require('./_has');\nvar SRC = require('./_uid')('src');\nvar TO_STRING = 'toString';\nvar $toString = Function[TO_STRING];\nvar TPL = ('' + $toString).split(TO_STRING);\n\nrequire('./_core').inspectSource = function (it) {\n  return $toString.call(it);\n};\n\n(module.exports = function (O, key, val, safe) {\n  var isFunction = typeof val == 'function';\n  if (isFunction) has(val, 'name') || hide(val, 'name', key);\n  if (O[key] === val) return;\n  if (isFunction) has(val, SRC) || hide(val, SRC, O[key] ? '' + O[key] : TPL.join(String(key)));\n  if (O === global) {\n    O[key] = val;\n  } else if (!safe) {\n    delete O[key];\n    hide(O, key, val);\n  } else if (O[key]) {\n    O[key] = val;\n  } else {\n    hide(O, key, val);\n  }\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, TO_STRING, function toString() {\n  return typeof this == 'function' && this[SRC] || $toString.call(this);\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_redefine.js\n// module id = 298\n// module chunks = 110","module.exports = function (it) {\n  if (typeof it != 'function') throw TypeError(it + ' is not a function!');\n  return it;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_a-function.js\n// module id = 299\n// module chunks = 110","// 9.4.2.3 ArraySpeciesCreate(originalArray, length)\nvar speciesConstructor = require('./_array-species-constructor');\n\nmodule.exports = function (original, length) {\n  return new (speciesConstructor(original))(length);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_array-species-create.js\n// module id = 300\n// module chunks = 110","var isObject = require('./_is-object');\nvar isArray = require('./_is-array');\nvar SPECIES = require('./_wks')('species');\n\nmodule.exports = function (original) {\n  var C;\n  if (isArray(original)) {\n    C = original.constructor;\n    // cross-realm fallback\n    if (typeof C == 'function' && (C === Array || isArray(C.prototype))) C = undefined;\n    if (isObject(C)) {\n      C = C[SPECIES];\n      if (C === null) C = undefined;\n    }\n  } return C === undefined ? Array : C;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_array-species-constructor.js\n// module id = 301\n// module chunks = 110","// 7.2.2 IsArray(argument)\nvar cof = require('./_cof');\nmodule.exports = Array.isArray || function isArray(arg) {\n  return cof(arg) == 'Array';\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_is-array.js\n// module id = 302\n// module chunks = 110","require('../../modules/es6.array.find-index');\nmodule.exports = require('../../modules/_core').Array.findIndex;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/fn/array/find-index.js\n// module id = 303\n// module chunks = 110","'use strict';\n// 22.1.3.9 Array.prototype.findIndex(predicate, thisArg = undefined)\nvar $export = require('./_export');\nvar $find = require('./_array-methods')(6);\nvar KEY = 'findIndex';\nvar forced = true;\n// Shouldn't skip holes\nif (KEY in []) Array(1)[KEY](function () { forced = false; });\n$export($export.P + $export.F * forced, 'Array', {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\nrequire('./_add-to-unscopables')(KEY);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/es6.array.find-index.js\n// module id = 304\n// module chunks = 110","require('../../modules/es7.array.includes');\nmodule.exports = require('../../modules/_core').Array.includes;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/fn/array/includes.js\n// module id = 305\n// module chunks = 110","'use strict';\n// https://github.com/tc39/Array.prototype.includes\nvar $export = require('./_export');\nvar $includes = require('./_array-includes')(true);\n\n$export($export.P, 'Array', {\n  includes: function includes(el /* , fromIndex = 0 */) {\n    return $includes(this, el, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\nrequire('./_add-to-unscopables')('includes');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/es7.array.includes.js\n// module id = 306\n// module chunks = 110","var toInteger = require('./_to-integer');\nvar max = Math.max;\nvar min = Math.min;\nmodule.exports = function (index, length) {\n  index = toInteger(index);\n  return index < 0 ? max(index + length, 0) : min(index, length);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_to-absolute-index.js\n// module id = 307\n// module chunks = 110","require('../../modules/es6.object.assign');\nmodule.exports = require('../../modules/_core').Object.assign;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/fn/object/assign.js\n// module id = 308\n// module chunks = 110","// 19.1.3.1 Object.assign(target, source)\nvar $export = require('./_export');\n\n$export($export.S + $export.F, 'Object', { assign: require('./_object-assign') });\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/es6.object.assign.js\n// module id = 309\n// module chunks = 110","'use strict';\n// 19.1.2.1 Object.assign(target, source, ...)\nvar getKeys = require('./_object-keys');\nvar gOPS = require('./_object-gops');\nvar pIE = require('./_object-pie');\nvar toObject = require('./_to-object');\nvar IObject = require('./_iobject');\nvar $assign = Object.assign;\n\n// should work with symbols and should have deterministic property order (V8 bug)\nmodule.exports = !$assign || require('./_fails')(function () {\n  var A = {};\n  var B = {};\n  // eslint-disable-next-line no-undef\n  var S = Symbol();\n  var K = 'abcdefghijklmnopqrst';\n  A[S] = 7;\n  K.split('').forEach(function (k) { B[k] = k; });\n  return $assign({}, A)[S] != 7 || Object.keys($assign({}, B)).join('') != K;\n}) ? function assign(target, source) { // eslint-disable-line no-unused-vars\n  var T = toObject(target);\n  var aLen = arguments.length;\n  var index = 1;\n  var getSymbols = gOPS.f;\n  var isEnum = pIE.f;\n  while (aLen > index) {\n    var S = IObject(arguments[index++]);\n    var keys = getSymbols ? getKeys(S).concat(getSymbols(S)) : getKeys(S);\n    var length = keys.length;\n    var j = 0;\n    var key;\n    while (length > j) if (isEnum.call(S, key = keys[j++])) T[key] = S[key];\n  } return T;\n} : $assign;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_object-assign.js\n// module id = 310\n// module chunks = 110","// 19.1.2.14 / 15.2.3.14 Object.keys(O)\nvar $keys = require('./_object-keys-internal');\nvar enumBugKeys = require('./_enum-bug-keys');\n\nmodule.exports = Object.keys || function keys(O) {\n  return $keys(O, enumBugKeys);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_object-keys.js\n// module id = 311\n// module chunks = 110","var has = require('./_has');\nvar toIObject = require('./_to-iobject');\nvar arrayIndexOf = require('./_array-includes')(false);\nvar IE_PROTO = require('./_shared-key')('IE_PROTO');\n\nmodule.exports = function (object, names) {\n  var O = toIObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) if (key != IE_PROTO) has(O, key) && result.push(key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (has(O, key = names[i++])) {\n    ~arrayIndexOf(result, key) || result.push(key);\n  }\n  return result;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_object-keys-internal.js\n// module id = 312\n// module chunks = 110","var shared = require('./_shared')('keys');\nvar uid = require('./_uid');\nmodule.exports = function (key) {\n  return shared[key] || (shared[key] = uid(key));\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_shared-key.js\n// module id = 313\n// module chunks = 110","// IE 8- don't enum bug keys\nmodule.exports = (\n  'constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf'\n).split(',');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_enum-bug-keys.js\n// module id = 314\n// module chunks = 110","exports.f = Object.getOwnPropertySymbols;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_object-gops.js\n// module id = 315\n// module chunks = 110","exports.f = {}.propertyIsEnumerable;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/modules/_object-pie.js\n// module id = 316\n// module chunks = 110","/* Secure Creatives\n  Provides support for rendering creatives into cross domain iframes such as SafeFrame to prevent\n   access to a publisher page from creative payloads.\n */\n\nimport events from './events';\nimport { fireNativeTrackers } from './native';\nimport { EVENTS } from './constants';\n\nconst BID_WON = EVENTS.BID_WON;\n\nexport function listenMessagesFromCreative() {\n  addEventListener('message', receiveMessage, false);\n}\n\nfunction receiveMessage(ev) {\n  var key = ev.message ? 'message' : 'data';\n  var data = {};\n  try {\n    data = JSON.parse(ev[key]);\n  } catch (e) {\n    return;\n  }\n\n  if (data.adId) {\n    const adObject = pbjs._bidsReceived.find(function (bid) {\n      return bid.adId === data.adId;\n    });\n\n    if (data.message === 'Prebid Request') {\n      sendAdToCreative(adObject, data.adServerDomain, ev.source);\n\n      // save winning bids\n      pbjs._winningBids.push(adObject);\n\n      events.emit(BID_WON, adObject);\n    }\n\n    // handle this script from native template in an ad server\n    // window.parent.postMessage(JSON.stringify({\n    //   message: 'Prebid Native',\n    //   adId: '%%PATTERN:hb_adid%%'\n    // }), '*');\n    if (data.message === 'Prebid Native') {\n      fireNativeTrackers(data, adObject);\n      pbjs._winningBids.push(adObject);\n      events.emit(BID_WON, adObject);\n    }\n  }\n}\n\nfunction sendAdToCreative(adObject, remoteDomain, source) {\n  const { adId, ad, adUrl, width, height } = adObject;\n\n  if (adId) {\n    resizeRemoteCreative(adObject);\n    source.postMessage(JSON.stringify({\n      message: 'Prebid Response',\n      ad,\n      adUrl,\n      adId,\n      width,\n      height\n    }), remoteDomain);\n  }\n}\n\nfunction resizeRemoteCreative({ adUnitCode, width, height }) {\n  const iframe = document.getElementById(window.googletag.pubads()\n    .getSlots().find(slot => {\n      return slot.getAdUnitPath() === adUnitCode ||\n        slot.getSlotElementId() === adUnitCode;\n    }).getSlotElementId()).querySelector('iframe');\n\n  iframe.width = '' + width;\n  iframe.height = '' + height;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/secureCreatives.js","import {formatQS} from './url';\nimport {getWinningBids} from './targeting';\n\n// Adserver parent class\nconst AdServer = function(attr) {\n  this.name = attr.adserver;\n  this.code = attr.code;\n  this.getWinningBidByCode = function() {\n    return getWinningBids(this.code)[0];\n  };\n};\n\n// DFP ad server\nexports.dfpAdserver = function (options, urlComponents) {\n  var adserver = new AdServer(options);\n  adserver.urlComponents = urlComponents;\n\n  var dfpReqParams = {\n    'env': 'vp',\n    'gdfp_req': '1',\n    'impl': 's',\n    'unviewed_position_start': '1'\n  };\n\n  var dfpParamsWithVariableValue = ['output', 'iu', 'sz', 'url', 'correlator', 'description_url', 'hl'];\n\n  var getCustomParams = function(targeting) {\n    return encodeURIComponent(formatQS(targeting));\n  };\n\n  adserver.appendQueryParams = function() {\n    var bid = adserver.getWinningBidByCode();\n    if (bid) {\n      this.urlComponents.search.description_url = encodeURIComponent(bid.descriptionUrl);\n      this.urlComponents.search.cust_params = getCustomParams(bid.adserverTargeting);\n      this.urlComponents.search.correlator = Date.now();\n    }\n  };\n\n  adserver.verifyAdserverTag = function() {\n    for (var key in dfpReqParams) {\n      if (!this.urlComponents.search.hasOwnProperty(key) || this.urlComponents.search[key] !== dfpReqParams[key]) {\n        return false;\n      }\n    }\n    for (var i in dfpParamsWithVariableValue) {\n      if (!this.urlComponents.search.hasOwnProperty(dfpParamsWithVariableValue[i])) {\n        return false;\n      }\n    }\n    return true;\n  };\n\n  return adserver;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/adserver.js","/**\n * @file AudienceNetwork adapter.\n */\nimport { registerBidder } from 'src/adapters/bidderFactory';\nimport { config } from 'src/config';\nimport { formatQS } from 'src/url';\nimport { getTopWindowUrl } from 'src/utils';\n\nconst code = 'audienceNetwork';\nconst currency = 'USD';\nconst method = 'GET';\nconst url = 'https://an.facebook.com/v2/placementbid.json';\nconst supportedMediaTypes = ['video'];\nconst netRevenue = true;\nconst hb_bidder = 'fan';\n\n/**\n * Does this bid request contain valid parameters?\n * @param {Object} bid\n * @returns {Boolean}\n */\nconst isBidRequestValid = bid =>\n  typeof bid.params === 'object' &&\n  typeof bid.params.placementId === 'string' &&\n  bid.params.placementId.length > 0 &&\n  Array.isArray(bid.sizes) && bid.sizes.length > 0 &&\n  (isVideo(bid.params.format) || bid.sizes.map(flattenSize).some(isValidSize));\n\n/**\n * Flattens a 2-element [W, H] array as a 'WxH' string,\n * otherwise passes value through.\n * @param {Array|String} size\n * @returns {String}\n */\nconst flattenSize = size =>\n  (Array.isArray(size) && size.length === 2) ? `${size[0]}x${size[1]}` : size;\n\n/**\n * Is this a valid slot size?\n * @param {String} size\n * @returns {Boolean}\n */\nconst isValidSize = size => ['300x250', '320x50'].includes(size);\n\n/**\n * Is this a video format?\n * @param {String} format\n * @returns {Boolean}\n */\nconst isVideo = format => format === 'video';\n\n/**\n * Which SDK version should be used for this format?\n * @param {String} format\n * @returns {String}\n */\nconst sdkVersion = format => isVideo(format) ? '' : '5.5.web';\n\n/**\n * Does the search part of the URL contain \"anhb_testmode\"\n * and therefore indicate testmode should be used?\n * @returns {String} \"true\" or \"false\"\n */\nconst isTestmode = () => Boolean(\n  window && window.location &&\n  typeof window.location.search === 'string' &&\n  window.location.search.indexOf('anhb_testmode') !== -1\n).toString();\n\n/**\n * Generate ad HTML for injection into an iframe\n * @param {String} placementId\n * @param {String} format\n * @param {String} bidId\n * @returns {String} HTML\n */\nconst createAdHtml = (placementId, format, bidId) => {\n  const nativeStyle = format === 'native' ? '<script>window.onload=function(){if(parent){var o=document.getElementsByTagName(\"head\")[0];var s=parent.document.getElementsByTagName(\"style\");for(var i=0;i<s.length;i++)o.appendChild(s[i].cloneNode(true));}}</script>' : '';\n  const nativeContainer = format === 'native' ? '<div class=\"thirdPartyRoot\"><a class=\"fbAdLink\"><div class=\"fbAdMedia thirdPartyMediaClass\"></div><div class=\"fbAdSubtitle thirdPartySubtitleClass\"></div><div class=\"fbDefaultNativeAdWrapper\"><div class=\"fbAdCallToAction thirdPartyCallToActionClass\"></div><div class=\"fbAdTitle thirdPartyTitleClass\"></div></div></a></div>' : '';\n  return `<html><head>${nativeStyle}</head><body><div style=\"display:none;position:relative;\">\n<script type='text/javascript'>var data = {placementid:'${placementId}',format:'${format}',bidid:'${bidId}',onAdLoaded:function(e){console.log('Audience Network [${placementId}] ad loaded');e.style.display = 'block';},onAdError:function(c,m){console.log('Audience Network [${placementId}] error (' + c + ') ' + m);}};\n(function(a,b,c){var d='https://www.facebook.com',e='https://connect.facebook.net/en_US/fbadnw55.js',f={iframeLoaded:true,xhrLoaded:true},g=a.data,h=function(){if(Date.now){return Date.now();}else return +new Date();},i=function(aa){var ba=d+'/audience_network/client_event',ca={cb:h(),event_name:'ADNW_ADERROR',ad_pivot_type:'audience_network_mobile_web',sdk_version:'5.5.web',app_id:g.placementid.split('_')[0],publisher_id:g.placementid.split('_')[1],error_message:aa},da=[];for(var ea in ca)da.push(encodeURIComponent(ea)+'='+encodeURIComponent(ca[ea]));var fa=ba+'?'+da.join('&'),ga=new XMLHttpRequest();ga.open('GET',fa,true);ga.send();if(g.onAdError)g.onAdError('1000','Internal error.');},j=function(){if(b.currentScript){return b.currentScript;}else{var aa=b.getElementsByTagName('script');return aa[aa.length-1];}},k=function(aa){try{return aa.document.referrer;}catch(ba){}return '';},l=function(){var aa=a,ba=[aa];try{while(aa!==aa.parent&&aa.parent.document)ba.push(aa=aa.parent);}catch(ca){}return ba.reverse();},m=function(){var aa=l();for(var ba=0;ba<aa.length;ba++){var ca=aa[ba],da=ca.ADNW||{};ca.ADNW=da;if(!ca.ADNW)continue;return da.v55=da.v55||{ads:[],window:ca};}throw new Error('no_writable_global');},n=function(aa){var ba=aa.indexOf('/',aa.indexOf('://')+3);if(ba===-1)return aa;return aa.substring(0,ba);},o=function(aa){return aa.location.href||k(aa);},p=function(aa){if(aa.sdkLoaded)return;var ba=aa.window.document,ca=ba.createElement('iframe');ca.name='fbadnw';ca.style.display='none';ba.body.appendChild(ca);var da=ca.contentDocument.createElement('script');da.src=e;da.async=true;ca.contentDocument.body.appendChild(da);aa.sdkLoaded=true;},q=function(aa){var ba=/^https?:\\\\/\\\\/www\\\\.google(\\\\.com?)?\\\\.\\\\w{2,3}$/;return !!aa.match(ba);},r=function(aa){return !!aa.match(/cdn\\\\.ampproject\\\\.org$/);},s=function(){var aa=c.ancestorOrigins||[],ba=aa[aa.length-1]||c.origin,ca=aa[aa.length-2]||c.origin;if(q(ba)&&r(ca)){return n(ca);}else return n(ba);},t=function(aa){try{return JSON.parse(aa);}catch(ba){i(ba.message);throw ba;}},u=function(aa,ba,ca){if(!aa.iframe){var da=ca.createElement('iframe');da.src=d+'/audiencenetwork/iframe/';da.style.display='none';ca.body.appendChild(da);aa.iframe=da;aa.iframeAppendedTime=h();aa.iframeData={};}ba.iframe=aa.iframe;ba.iframeData=aa.iframeData;ba.tagJsIframeAppendedTime=aa.iframeAppendedTime||0;},v=function(aa){var ba=d+'/audiencenetwork/xhr/?sdk=5.5.web';for(var ca in aa)if(typeof aa[ca]!=='function')ba+='&'+ca+'='+encodeURIComponent(aa[ca]);var da=new XMLHttpRequest();da.open('GET',ba,true);da.withCredentials=true;da.onreadystatechange=function(){if(da.readyState===4){var ea=t(da.response);aa.events.push({name:'xhrLoaded',source:aa.iframe.contentWindow,data:ea,postMessageTimestamp:h(),receivedTimestamp:h()});}};da.send();},w=function(aa,ba){var ca=d+'/audiencenetwork/xhriframe/?sdk=5.5.web';for(var da in ba)if(typeof ba[da]!=='function')ca+='&'+da+'='+encodeURIComponent(ba[da]);var ea=b.createElement('iframe');ea.src=ca;ea.style.display='none';b.body.appendChild(ea);ba.iframe=ea;ba.iframeData={};ba.tagJsIframeAppendedTime=h();},x=function(aa){var ba=function(event){try{var da=event.data;if(da.name in f)aa.events.push({name:da.name,source:event.source,data:da.data});}catch(ea){}},ca=aa.iframe.contentWindow.parent;ca.addEventListener('message',ba,false);},y=function(aa){if(aa.context&&aa.context.sourceUrl)return true;try{return !!JSON.parse(decodeURI(aa.name)).ampcontextVersion;}catch(ba){return false;}},z=function(aa){var ba=h(),ca=l()[0],da=j().parentElement,ea=ca!=a.top,fa=ca.$sf&&ca.$sf.ext,ga=o(ca),ha=m();p(ha);var ia={amp:y(ca),events:[],tagJsInitTime:ba,rootElement:da,iframe:null,tagJsIframeAppendedTime:ha.iframeAppendedTime||0,url:ga,domain:s(),channel:n(o(ca)),width:screen.width,height:screen.height,pixelratio:a.devicePixelRatio,placementindex:ha.ads.length,crossdomain:ea,safeframe:!!fa,placementid:g.placementid,format:g.format||'300x250',testmode:!!g.testmode,onAdLoaded:g.onAdLoaded,onAdError:g.onAdError};if(g.bidid)ia.bidid=g.bidid;if(ea){w(ha,ia);}else{u(ha,ia,ca.document);v(ia);}; x(ia);ia.rootElement.dataset.placementid=ia.placementid;ha.ads.push(ia);};try{z();}catch(aa){i(aa.message||aa);throw aa;}})(window,document,location);\n</script>\n${nativeContainer}</div></body></html>`;\n};\n\n/**\n * Convert each bid request to a single URL to fetch those bids.\n * @param {Array} bids - list of bids\n * @param {String} bids[].placementCode - Prebid placement identifier\n * @param {Object} bids[].params\n * @param {String} bids[].params.placementId - Audience Network placement identifier\n * @param {String} bids[].params.format - Optional format, one of 'video', 'native' or 'fullwidth' if set\n * @param {Array} bids[].sizes - list of desired advert sizes\n * @param {Array} bids[].sizes[] - Size arrays [h,w]: should include one of [300, 250], [320, 50]: first matched size is used\n * @returns {Array<Object>} List of URLs to fetch, plus formats and sizes for later use with interpretResponse\n */\nconst buildRequests = bids => {\n  // Build lists of placementids, adformats, sizes and SDK versions\n  const placementids = [];\n  const adformats = [];\n  const sizes = [];\n  const sdk = [];\n  const requestIds = [];\n\n  bids.forEach(bid => bid.sizes\n    .map(flattenSize)\n    .filter(size => isValidSize(size) || isVideo(bid.params.format))\n    .slice(0, 1)\n    .forEach(size => {\n      placementids.push(bid.params.placementId);\n      adformats.push(bid.params.format || size);\n      sizes.push(size);\n      sdk.push(sdkVersion(bid.params.format));\n      requestIds.push(bid.bidId);\n    })\n  );\n\n  // Build URL\n  const testmode = isTestmode();\n  const pageurl = getTopWindowUrl();\n  const search = {\n    placementids,\n    adformats,\n    testmode,\n    pageurl,\n    sdk\n  };\n  const video = adformats.findIndex(isVideo);\n  if (video !== -1) {\n    [search.playerwidth, search.playerheight] = sizes[video].split('x').map(Number)\n  }\n  const data = formatQS(search);\n\n  return [{ adformats, data, method, requestIds, sizes, url }];\n};\n\n/**\n * Convert a server response to a bid response.\n * @param {Object} response - object representing the response\n * @param {Object} response.body - response body, already converted from JSON\n * @param {Object} bidRequests - the original bid requests\n * @param {Array} bidRequest.adformats - list of formats for the original bid requests\n * @param {Array} bidRequest.sizes - list of sizes fot the original bid requests\n * @returns {Array<Object>} A list of bid response objects\n */\nconst interpretResponse = ({ body }, { adformats, requestIds, sizes }) => {\n  const ttl = Number(config.getConfig().bidderTimeout);\n\n  return body.errors && body.errors.length\n    ? []\n    : Object.keys(body.bids)\n      // extract Array of bid responses\n      .map(placementId => body.bids[placementId])\n      // flatten\n      .reduce((a, b) => a.concat(b), [])\n      // transform to bidResponse\n      .map((bid, i) => {\n        const {\n          bid_id: fb_bidid,\n          placement_id: creativeId,\n          bid_price_cents: cpm\n        } = bid;\n\n        const format = adformats[i];\n        const [width, height] = sizes[i];\n        const ad = createAdHtml(creativeId, format, fb_bidid);\n        const requestId = requestIds[i];\n\n        const bidResponse = {\n          // Prebid attributes\n          requestId,\n          cpm: cpm / 100,\n          width,\n          height,\n          ad,\n          ttl,\n          creativeId,\n          netRevenue,\n          currency,\n          // Audience Network attributes\n          hb_bidder,\n          fb_bidid,\n          fb_format: format,\n          fb_placementid: creativeId\n        };\n        // Video attributes\n        if (isVideo(format)) {\n          const pageurl = getTopWindowUrl();\n          bidResponse.mediaType = 'video';\n          bidResponse.vastUrl = `https://an.facebook.com/v1/instream/vast.xml?placementid=${creativeId}&pageurl=${encodeURIComponent(pageurl)}&playerwidth=${width}&playerheight=${height}&bidid=${fb_bidid}`;\n        }\n        return bidResponse;\n      });\n};\n\nexport const spec = {\n  code,\n  supportedMediaTypes,\n  isBidRequestValid,\n  buildRequests,\n  interpretResponse\n};\n\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/audienceNetworkBidAdapter.js"]}