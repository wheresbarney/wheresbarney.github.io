<!DOCTYPE html>
<html>
  <head>
    <script src="javascript/cookie.js"></script>
  </head>
  <body style='background-color: white'>
    <div id='server' style='font-weight: 600'></div>
    <button id='intern'>intern</button>
    <button id='connect'>prod</button>
    <button id='sb'>sandbox:</button><input id='sbname'></input>
    <input style='transform: scale(2)' type='checkbox' id='testmode'>Test Mode</div>
    <div id='nofill' style='display:none; color: red; font-size:20px'></div>
    <hr>
    <input style='transform: scale(2)' type='checkbox' id='native_check'>native
    <p></p>
    <div id='native_check_div'></div>
    <input style='transform: scale(2)' type='checkbox' id='mrect_check'>mrect
    <p></p>
    <div id='mrect_check_div'></div>
    <input style='transform: scale(2)' type='checkbox' id='banner_check'>banner
    <p></p>
    <div id='banner_check_div'></div>
    <script>var inDapIF = false;</script>
    <script src="//www.googletagservices.com/tag/js/gpt.js"></script>
    <script>
      var boxes = ['native_check', 'mrect_check', 'banner_check'];

      var codes = {};

      codes['native_check'] =
        '<div class="fb-ad" data-format="native" data-testmode="%%TEST_MOD%%" data-placementid="97972641212_10153121319441213"data-nativeadid="ad_root"></div> ' +
        '<div id="ad_root" style="width:300px; height:400px;position:relative"> ' +
        '  <a class="fbAdLink"> ' +
        '      <div class="fbAdMedia" style="width:100%; height:200px;"> ' +
        '      </div> ' +
        '      <div class="fbAdIcon" style="width:48px; height:48px;float:left"></div> ' +
        '      <div class="fbAdTitle"></div> ' +
        '      <div class="fbAdBody"></div> ' +
        '  </a> ' +
        '</div> ';

      codes['mrect_check'] = '<fb:ad placementid="97972641212_10153177743496213" format="300x250" testmode="%%TEST_MOD%%"></fb:ad>';
      codes['banner_check'] = '<fb:ad placementid="97972641212_10153177743496213" format="320x50" testmode="%%TEST_MOD%%"></fb:ad>';

      document.getElementById('intern').addEventListener('click', function () {
        Cookies.set('server', 'intern');
        window.location.reload();
      });

      document.getElementById('connect').addEventListener('click', function () {
        Cookies.set('server', '!CONNECT!');
        window.location.reload();
      });

      document.getElementById('sb').addEventListener('click', function () {
        var sandbox = document.getElementById('sbname').value;
        Cookies.set('server', sandbox);
        Cookies.set('sandbox', sandbox);
        window.location.reload();
      });

      document.getElementById('testmode').addEventListener('change', function () {
        Cookies.set('testmode', document.getElementById('testmode').checked ? 'yes' : 'no');
        window.location.reload();
      });

      (function(d, s, id) {
        var sb = Cookies.get('sandbox');
        if (!sb) {
          sb = 'tonypan.sb';
        }
        Cookies.set('sandbox', sb);

        var server = Cookies.get('server');
        if (!server) {
          server = 'intern';
        }
        Cookies.set('server', server);

        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        if (server === '!CONNECT!') {
            js.src = "//connect.facebook.net/en_US/sdk/xfbml.ad.js#xfbml=1&version=v2.5&appId=97972641212";
        } else {
            js.src = '//www.' + server + '.facebook.com/assets.php/en_US/sdk/xfbml.ad.js#xfbml=1&version=v2.5&appId=97972641212';
        }
        fjs.parentNode.insertBefore(js, fjs);

        window.SCRIPT_URL = js.src;
      }(document, 'script', 'facebook-jssdk'));

      document.addEventListener("DOMContentLoaded", function() {
        var sb = Cookies.get('sandbox');
        document.getElementById('sbname').value = sb;

        document.getElementById('server').innerText = 'Script from: ' + window.SCRIPT_URL;

        var testmode = Cookies.get('testmode') === 'yes';
        document.getElementById('testmode').checked = testmode;

        for (var i = 0; i < boxes.length; i++) {
          var name = boxes[i];
          var checked = Cookies.get(name) === 'yes';

          document.getElementById(name).checked = checked;

          var inner_html = checked ? codes[name] : 'Nothing';
          inner_html = inner_html.replace('%%TEST_MOD%%', testmode);
          document.getElementById(name + '_div').innerHTML = inner_html;

          document.getElementById(name).addEventListener('change', function () {
            for (var i = 0; i < boxes.length; i++) {
              var name = boxes[i];
              Cookies.set(name, document.getElementById(name).checked ? 'yes' : 'no');
            }

            window.location.reload();
          });
        }
      });

      window.fbAsyncInit = function() {
        FB.Event.subscribe(
          'ad.error',
          function(errorCode, errorMessage, placementId) {
            var element = document.getElementById('nofill');
            var html = element.innerHTML;
            html += '<div>' + errorMessage + "&nbsp;" + errorCode + '</div>';
            element.innerHTML = html;
            element.style.display = 'block';

            googletag.pubads().definePassback('/124141061/tony-ad-1', [300, 250]).display();
          }
        );
      };

    </script>
  </body>
</html>
